<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>地区选择</title>

    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/zftal-ui.css" rel="stylesheet">
    <link href="../../js/plugins/areaSelection/area-selection.css" rel="stylesheet">

    <!--[if lt IE 9]>
    <script src="../../js/html5shiv.min.js"></script>
    <script src="../../js/respond.min.js"></script>
    <![endif]-->
</head>
<body class="area-s margin-tb10">
<div class="container">
    <form class="form-horizontal" role="form">
        <div class="form-group">
            <label for="userName" class="col-sm-offset-2 col-sm-2 control-label">姓名</label>
            <div class="col-sm-6">
                <input type="text" class="form-control" id="userName" placeholder="姓名">
            </div>
        </div>
        <div class="form-group">
            <label for="studentID" class="col-sm-offset-2 col-sm-2 control-label">学号</label>
            <div class="col-sm-6">
                <input type="text" class="form-control" id="studentID" placeholder="学号">
            </div>
        </div>
        <div class="form-group">
            <label for="sp" class="col-sm-offset-2 col-sm-2 control-label">生源地</label>
            <div class="col-sm-6">
                <div class="input-group-input">
                    <input type="text" class="form-control" id="sp" placeholder="省/市/县区">
                    <span class="glyphicon glyphicon-remove input-group-input-remove"></span>
                </div>
            </div>
        </div>

        <div class="form-group">
            <div class="col-sm-offset-4 col-sm-6">
                <div class="alert alert-warning alert-dismissible" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <strong>警告：</strong> 此演示界面因数据原因，并没有使用插件，正式使用时，请使用插件plugins/areaSelection/area-selection.js。
                </div>
            </div>
        </div>



        <div class="form-group">
            <div class="col-sm-offset-4 col-sm-6">
                <button type="submit" class="btn btn-default">保存</button>
            </div>
        </div>
    </form>

</div>

<div class="area-selection">
    <button type="button" class="close"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
    <!--<div class="area-selection-search-box">
        <div class="form-inline">
            <div class="form-group">
                <label class="sr-only" for="key_word">搜索</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="key_word" placeholder="输入关键字">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button">搜索</button>
                    </span>
                </div>
            </div>
        </div>
    </div>-->
    <div class="area-selection-box">
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#province" role="tab">省份</a></li>
            <li role="presentation"><a href="#city" role="tab">城市</a></li>
            <li role="presentation"><a href="#county" role="tab">县区 <span class="badge">4</span></a></li>
        </ul>
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade in active" id="province">
                <ul class="tag-list" data-type="province">
                    <!--<li><a href="#city" role="tab" data-bs-toggle="tab" class="transition-common">北京市</a></li>
                    <li><a href="#city" role="tab" data-bs-toggle="tab" class="transition-common">浙江省</a></li>
                    <li><a href="#city" role="tab" data-bs-toggle="tab" class="transition-common">浙江省</a></li>
                    <li><a href="#city" role="tab" data-bs-toggle="tab" class="transition-common">浙江省</a></li>
                    <li><a href="#city" role="tab" data-bs-toggle="tab" class="transition-common">浙江省</a></li>-->
                </ul>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="city">
                <ul class="tag-list" data-type="city">
                    <!--
                    <li><a href="#county" role="tab" data-bs-toggle="tab" class="transition-common">杭州市</a></li>
                    <li><a href="#county" role="tab" data-bs-toggle="tab" class="transition-common">嘉兴市</a></li>
                    <li><a href="#county" role="tab" data-bs-toggle="tab" class="transition-common">丽水市</a></li>
                    <li><a href="#county" role="tab" data-bs-toggle="tab" class="transition-common">嘉兴市</a></li>
                    <li><a href="#county" role="tab" data-bs-toggle="tab" data-islast="true" class="transition-common">最后市</a></li>
                    <li><a href="#county" role="tab" data-bs-toggle="tab" class="transition-common">嘉兴市</a></li>
                    <li><a href="#county" role="tab" data-bs-toggle="tab" class="transition-common">嘉兴市</a></li>
                    <li><a href="#county" role="tab" data-bs-toggle="tab" class="transition-common">嘉兴市</a></li>
                    <li><a href="#county" role="tab" data-bs-toggle="tab" class="transition-common">嘉兴市</a></li>
                    -->
                </ul>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="county">
                <ul class="tag-list" data-type="county">
                    <!--<li><a href="#" class="transition-common">富阳市</a></li>-->
                    <!--<li><a href="#" class="transition-common">桐庐县</a></li>-->
                    <!--<li><a href="#" class="transition-common">滨江区</a></li>-->
                    <!--<li><a href="#" class="transition-common">西湖区</a></li>-->
                    <!--<li><a href="#" class="transition-common">萧山区</a></li>-->
                    <!--<li><a href="#" class="transition-common">上城区</a></li>-->
                    <!--<li><a href="#" class="transition-common">余杭区</a></li>-->
                    <!--<li><a href="#" class="transition-common">江干区</a></li>-->
                </ul>
            </div>
        </div>
    </div>



</div>

<script src="../../js/jquery-1.11.0.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<!--<script src="../../js/plugins/areaSelection/area-selection.js"></script>-->
<script type="text/javascript">
    $(document).ready(function () {
        $('#sp').css({'cursor':'pointer'});
        $('#sp').focus(function () {
            initAreaSelection('#sp');

        });
//        $('#sp').blur(function () {
//            $('.area-selection').hide().css({'top':0,'left':0});
//        });
        /*以下增加仿IE10输入框清空功能*/
        var inputTimer;
        $('.input-group-input .form-control').on('keyup focus',function () {
            clearTimeout(inputTimer);
            var $this = $(this);
            if($this.val() != ''){
                $this.siblings('.input-group-input-remove').show();
                $this.siblings('.input-group-input-remove').click(function () {
//                    console.log($this.val());
                    $this.val('');
                    initAreaSelection('#sp');
                });
            }
        }).blur(function () {
            var $this = $(this);
            inputTimer = setTimeout(function () {
//                console.log('blur');
                $this.siblings('.input-group-input-remove').off('click');
                $this.siblings('.input-group-input-remove').hide();
            },150);
            //$(this).siblings('.input-group-input-remove').hide();
        });
        /*以上增加仿IE10输入框清空功能*/
    });

    /*测试数组，可以自行定义*/
//    var sf1 = {type: 'province', data: ['北京市', '浙江省', '浙江省', '浙江省']};
    var sf1 = ['北京市', '浙江省', '浙江省', '浙江省'];
    var sf2 = ['北京市', '浙江省'];
//    var s1 = {type: 'city', data: ['杭州市', '嘉兴市', '丽水市', '嘉兴市', '嘉兴市', '嘉兴市', '嘉兴市']};
    var s1 = ['杭州市', '嘉兴市', '丽水市', '嘉兴市', '最后一级', '嘉兴市', '嘉兴市'];
    var s2 = ['丽水市', '嘉兴市'];
    var q1 = ['富阳市', '桐庐县', '滨江区', '西湖区', '萧山区', '上城区', '余杭区', '江干区'];
    var q2 = ['滨江区', '西湖区', '萧山区', '上城区', '余杭区', '江干区'];
    var search_timer;
    function initAreaSelection(selector) {

        var closeBox = function () {
            $('.area-selection').hide().css({'top':0,'left':0});
        };
        var initLi = function (arr, type, tag_list) {
//            console.log(type);
            var $t = $('<li><a href="" role="tab" data-bs-toggle="tab" class="transition-common"></a></li>');
            var $tl = tag_list.empty();
            for(var i in arr){
                var $tt = $t.clone();
//                console.log($tt);
                $tt.find('a').attr('href','#'+type).text(arr[i]);
                if(arr[i] == '最后一级'){ // 这里判断是否是最后一级，请自行调整
                    $tt.find('a').attr('data-islast','true');
                }
                $tl.append($tt);
            }
            on_a($tl.find('li>a'));
        };
        var on_a = function (a) { // 绑定a
            $(a).off().click(function (e) {
                e.preventDefault();
//                $('.area-selection .area-selection-box .tag-list').empty(); // 清空数据
                $('.area-selection .area-selection-box .nav>li>a').removeAttr('data-bs-toggle');
                $('.area-selection .area-selection-box .nav>li>a>.badge').remove();

                $(this).parent('li').removeClass('active');
                $(this).closest('.tag-list').find('li>a').removeClass('cur');
                $(this).addClass('cur');

                var islast = $(this).data('islast');
                var retStr = ''; // 返回的字符串，请自行调整
                if ($(this).closest('.tag-list').data('type') == 'province' && islast != 'true' && islast != true) {
//                    console.log('province~~~');
                    initLi(s1,'county',$('.area-selection .area-selection-box .tag-list[data-type="city"]')); // 添加 市
                }else if($(this).closest('.tag-list').data('type') == 'city' && islast != 'true' && islast != true){
//                    console.log('city~~~');
                    initLi(q1,'county',$('.area-selection .area-selection-box .tag-list[data-type="county"]')); // 添加 县
                }else if ($(this).closest('.tag-list').data('type') == 'county' || islast == 'true' || islast == true) { // 如果点击的是地区，或者最后一级
//                    console.log('county~~~');
                    $(this).closest('.tab-content').find('.tag-list>li>a.cur').each(function () {
//                        retStr += $(this).text() + '/';
                        retStr += $(this).text();
                    });
//                    $(selector).val(retStr.substr(0, retStr.length - 1));
                    $(selector).val(retStr);
                    closeBox();
                }

                var $navli = $('.area-selection .area-selection-box .nav>li');
                if ($navli.find('a[href="' + $(this).attr('href') + '"]').length > 0) {
                    $navli.removeClass('active');
                    $navli.find('a[href="' + $(this).attr('href') + '"]').parent('li').addClass('active');
                }
                $navli.find('a[href="#'+$(this).closest('.tag-list').data('type')+'"]').closest('li').prevAll('li').find('a').attr('data-bs-toggle','tab');
                $navli.find('a[href="#'+$(this).closest('.tag-list').data('type')+'"]').attr('data-bs-toggle','tab');
            });
        };
        $('.area-selection .area-selection-box .nav>li>a').removeAttr('data-bs-toggle').click(function (e) {
            e.preventDefault();
        });
        $('.area-selection .area-selection-box .nav>li>a>.badge').remove();

        $('.area-selection .close').off().click(function () {
            closeBox();
        });

        var initSearchBox = function (ts) {
            var $ts = $(ts);
            var $t = $('<span class="badge"></span>');
            $('.area-selection .area-selection-box .tag-list').empty(); // 清空数据
            $('.area-selection .area-selection-box .nav>li>a>.badge').remove();

            initLi(sf2,'city',$('.area-selection .area-selection-box .tag-list[data-type="province"]'));
            $('.area-selection .area-selection-box .nav>li>a[href="#province"]').append($t.clone().text(sf2.length));

            initLi(s2,'county',$('.area-selection .area-selection-box .tag-list[data-type="city"]'));
            $('.area-selection .area-selection-box .nav>li>a[href="#city"]').append($t.clone().text(s2.length));

            initLi(q2,'county',$('.area-selection .area-selection-box .tag-list[data-type="county"]'));
            $('.area-selection .area-selection-box .nav>li>a[href="#county"]').append($t.clone().text(q2.length));

            $('.area-selection .area-selection-box .nav>li>a').attr('data-bs-toggle','tab');
        };
//        var search_timer;
        $(selector).keyup(function () {
//            console.log($(this).val());
            clearTimeout(search_timer); // 清除计时器
            var ts = this;
            if($(ts).val() == ''){
                initAreaSelection(selector);
                return false;
            }
            search_timer = setTimeout(function () {
                initSearchBox(ts);
            },500);
        });


        $('.area-selection .area-selection-box .tag-list').empty(); // 清空数据
//        $('.area-selection .area-selection-box .tag-list[data-type="province"]').append(initLi(sf1,'province',this));
        initLi(sf1,'city',$('.area-selection .area-selection-box .tag-list[data-type="province"]'));

//        var firstType =  $('.area-selection .area-selection-box .tag-list>li>a:first').closest('.tag-list').date('type');
        $('.area-selection .area-selection-box .nav>li').removeClass('active');
        $('.area-selection .area-selection-box .nav>li:first').addClass('active');
        $('.area-selection .area-selection-box .tab-pane').removeClass('active').removeClass('in');
        $('.area-selection .area-selection-box .tab-pane:first').addClass('active').addClass('in');

        var eh = $(selector).outerHeight();
        var ew = $(selector).outerWidth();
        $('.area-selection').offset($(selector).offset());
        $('.area-selection').css({
            'top':function () {
                return parseFloat($(this).css('top')) + eh;
            },
            'width':ew
        }).slideDown(200);


    }
</script>
</body>
</html>
