(function(a){a.filehandle=function(f,c){var h=this;if(f){c=a.extend(true,{},a.filehandle.defaults,((typeof c=="object"&&c)?c:{}));if(f){var b=0;var e=0;var g=true;var d=a.filehandle.messages;a.each(f||[],function(k,j){if(a.fileMatch(c.fileType,j.name,j.type)){e+=(j.fileSize||j.size);b+=1}else{g=false;c.handleInvalidType.call(h,j,a.filehandle.format(d.needFileType,c.fileType));return false}});if(g){if(b>c.maxCount){c.handleOverMaxCount.call(h,a.filehandle.format(d.overMaxCount,c.maxCount));return false}if(e>a.capacity(c.maxTotal)){c.handleOverTotal.call(h,a.filehandle.format(d.overMaxTotal,c.maxTotal));return false}a.each(f||[],function(k,j){if((j.fileSize||j.size)>a.capacity(c.maxSize)){return c.handleOverSize.call(h,j,a.filehandle.format(d.overMaxSize,c.maxSize));return false}else{c.handleFile.call(h,j,a.filehandle.format(d.successTip,[b,a.capacity(e,"KB")]),{selectedCount:b,total:e})}})}}}};a.filehandle.format=function(b,c){if(arguments.length==1){return function(){var d=a.makeArray(arguments);d.unshift(b);return b.apply(this,d)}}if(arguments.length>2&&c.constructor!=Array){c=a.makeArray(arguments).slice(1)}if(c.constructor!=Array){c=[c]}a.each(c,function(d,e){b=b.replace(new RegExp("\\{"+d+"\\}","g"),e)});return b};a.filehandle.defaults={fileType:"*.*",maxSize:"10M",maxTotal:"100MB",maxCount:30,handleInvalidType:function(b,c){},handleOverMaxCount:function(b){},handleOverTotal:function(b){},handleOverSize:function(b,c){},handleFile:function(c,d,b){}}}(jQuery));
