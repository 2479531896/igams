<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.matridx.igams.storehouse.dao.post.ICkxxDao" >
	<select id="getItemInfoByZtQgsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		qggl.djh,
		to_char( qggl.sqrq, 'YYYY-MM-dd' ) sqrq,
		qggl.jlbh,
		jc_xmbm.csmc AS xmbmmc,
		jc_xmdl.csmc AS xmdlmc,
		jg_sqbm.jgmc AS sqbmmc,
		wlgl.wlbm,
		wlgl.wlmc,
		wlgl.wllb,
		wllb.csmc AS lbmc,
		wlgl.gg,
		wlgl.jldw,
		wlgl.ychh,
		COALESCE(qgmx.sl,0)-COALESCE (qgqxmx.qxsl,0) as sl,
		COALESCE ( qgmx.jg, 0 ) jg,
		qggl.sqly
		FROM
		igams_qgmx qgmx
		LEFT OUTER JOIN igams_qggl qggl ON qgmx.qgid = qggl.qgid and qggl.scbj ='0'
		LEFT JOIN matridx_jcsj jc_xmbm ON jc_xmbm.csid = qggl.xmbm
		LEFT JOIN matridx_jcsj jc_xmdl ON jc_xmdl.csid = qggl.xmdl
		LEFT JOIN matridx_jgxx jg_sqbm ON jg_sqbm.jgid = qggl.sqbm
		left join igams_qgqxmx qgqxmx on qgqxmx.qgmxid=qgmx.qgmxid and qgqxmx.scbj ='0'
		left join igams_wlgl wlgl on wlgl.wlid=qgmx.wlid and wlgl.scbj ='0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		where qgmx.scbj = '0' and qggl.zt != '80' and  qgmx.wlid is not null and wllb.csmc = #{lbmc}
		<if test="startTime != null and startTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	</select>

	<select id="getItemInfoByZtHtcgzsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		htgl.htnbbh,
		qggl.djh,
		xtyh.zsxm sqrmc,
		gys.gysmc,
		to_char(htgl.cjrq, 'yyyy-mm-dd') cjrq,
		jgxx.jgmc sqbmmc,
		htgl.sl as suil,
		biz.csmc bizmc,
		fkfs.csmc fkfsmc,
		fkf.csmc fkfmc,
		wlgl.wlbm,
		wlgl.wlmc,
		wllb.csmc AS lbmc,
		wlgl.gg,
		wlgl.jldw,
		wlgl.ychh,
		COALESCE(htmx.sl,0) as sl,
		htmx.wsdj,
		to_char( htmx.jhdhrq, 'yyyy-mm-dd') jhdhrq,
		htmx.hjje
		FROM
		igams_htgl htgl
		LEFT JOIN igams_htmx htmx ON htgl.htid = htmx.htid
		AND htmx.scbj = '0'
		LEFT JOIN igams_qgmx qgmx on qgmx.qgmxid = htmx.qgmxid and qgmx.scbj = '0'
		LEFT JOIN igams_qggl qggl on qggl.qgid = qgmx.qgid and qggl.scbj='0'
		left join matridx_xtyh xtyh on xtyh.yhid=htgl.fzr
		LEFT JOIN matridx_jgxx jgxx ON htgl.sqbm = jgxx.jgid
		left join matridx_jcsj biz on biz.csid=htgl.biz
		left join matridx_jcsj fkfs on fkfs.csid = htgl.fkfs
		left join matridx_jcsj fkf on fkf.csid = htgl.fkf
		left join igams_gysxx gys on gys.gysid=htgl.gys and gys.scbj!='1'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = htmx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		WHERE
		htgl.scbj = '0'
		AND htgl.zt != '80' and wllb.csmc = #{lbmc}
		<if test="startTime != null and startTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	</select>

	<select id="getItemInfoByZtHtwdhsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		htgl.htnbbh,
		qggl.djh,
		xtyh.zsxm sqrmc,
		gys.gysmc,
		to_char(htgl.cjrq, 'yyyy-mm-dd') cjrq,
		jgxx.jgmc sqbmmc,
		htgl.sl as suil,
		biz.csmc bizmc,
		fkfs.csmc fkfsmc,
		fkf.csmc fkfmc,
		wlgl.wlbm,
		wlgl.wlmc,
		wllb.csmc AS lbmc,
		wlgl.gg,
		wlgl.jldw,
		wlgl.ychh,
		(COALESCE(htmx.sl,0) - COALESCE(htmx.dhsl,0)) as sl,
		htmx.wsdj,
		to_char( htmx.jhdhrq, 'yyyy-mm-dd') jhdhrq,
		htmx.hjje
		FROM
		igams_htgl htgl
		LEFT JOIN igams_htmx htmx ON htgl.htid = htmx.htid
		AND htmx.scbj = '0'
		LEFT JOIN igams_qgmx qgmx on qgmx.qgmxid = htmx.qgmxid and qgmx.scbj = '0'
		LEFT JOIN igams_qggl qggl on qggl.qgid = qgmx.qgid and qggl.scbj='0'
		left join matridx_xtyh xtyh on xtyh.yhid=htgl.fzr
		LEFT JOIN matridx_jgxx jgxx ON htgl.sqbm = jgxx.jgid
		left join matridx_jcsj biz on biz.csid=htgl.biz
		left join matridx_jcsj fkfs on fkfs.csid = htgl.fkfs
		left join matridx_jcsj fkf on fkf.csid = htgl.fkf
		left join igams_gysxx gys on gys.gysid=htgl.gys and gys.scbj!='1'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = htmx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		WHERE
		htgl.scbj = '0'
		AND htgl.zt = '80'and wllb.csmc = #{lbmc}
		<if test="startTime != null and startTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	</select>

	<select id="getItemInfoByWlCkhwKcl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
			wlgl.wlbm,
			wlgl.wlmc,
			wllb.csmc AS lbmc,
			wlgl.gg,
			wlgl.jldw,
			wlgl.ychh,
			hwxx.scph,
			hwxx.zsh,
			hwxx.scrq,
			hwxx.yxq,
			kw.ckmc as kwmc,
			ckxx.ckmc,
			COALESCE ( hwxx.kcl, 0 ) kcl,
			qggl.djh,
			to_char( qggl.sqrq, 'yyyy-mm-dd') sqrq,
			xtyh.zsxm sqrmc,
			jgxx.jgmc sqbmmc,
			htgl.htnbbh,
			to_char(htgl.cjrq, 'yyyy-mm-dd') cjrq,
			dhxx.dhdh,
			to_char( dhxx.dhrq, 'yyyy-mm-dd' ) dhrq,
			dhjy.jydh,
			to_char( dhjy.jyrq, 'yyyy-mm-dd' ) jyrq,
			rkgl.rkdh,
			to_char( rkgl.rkrq, 'yyyy-mm-dd' ) rkrq
		FROM
			igams_hwxx hwxx
			LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
			AND wlgl.scbj = '0'
			LEFT JOIN igams_ckhwxx ckhwxx ON wlgl.wlid = ckhwxx.wlid
			LEFT JOIN igams_qgmx qgmx on qgmx.qgmxid = hwxx.qgmxid and qgmx.scbj = '0'
			LEFT JOIN igams_qggl qggl on qggl.qgid = qgmx.qgid and qggl.scbj='0'
			left join matridx_xtyh xtyh on xtyh.yhid=qggl.sqr
			LEFT JOIN matridx_jgxx jgxx ON qggl.sqbm = jgxx.jgid
			LEFT JOIN igams_htmx htmx ON hwxx.htmxid = htmx.htmxid AND htmx.scbj = '0'
			LEFT JOIN igams_htgl htgl ON htgl.htid = htmx.htid AND htgl.scbj = '0'
			LEFT JOIN igams_dhxx dhxx ON hwxx.dhid = dhxx.dhid and hwxx.scbj ='0'
			left join igams_dhjy dhjy on dhjy.dhjyid=hwxx.dhjyid and dhjy.scbj ='0'
			LEFT JOIN igams_rkgl rkgl ON rkgl.rkid = hwxx.rkid
			AND rkgl.scbj = '0'
			left join igams_ckxx kw on kw.ckid = hwxx.kwbh
			left join igams_ckxx ckxx on ckxx.ckid=hwxx.ckid and ckxx.scbj!='1'
			LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
			WHERE
			hwxx.scbj ='0' and wllb.csmc = #{lbmc}
	</select>

	<select id="getItemInfoByWlCkKcl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
			wlgl.wlbm,
			wlgl.wlmc,
			wllb.csmc AS lbmc,
			wlgl.gg,
			wlgl.jldw,
			wlgl.ychh,
			hwxx.scph,
			hwxx.zsh,
			hwxx.scrq,
			hwxx.yxq,
			kw.ckmc as kwmc,
			ckxx.ckmc,
			hwxx.kcl,
			qggl.djh,
			to_char( qggl.sqrq, 'yyyy-mm-dd') sqrq,
			xtyh.zsxm sqrmc,
			jgxx.jgmc sqbmmc,
			htgl.htnbbh,
			to_char(htgl.cjrq, 'yyyy-mm-dd') cjrq,
			dhxx.dhdh,
			to_char( dhxx.dhrq, 'yyyy-mm-dd' ) dhrq,
			dhjy.jydh,
			to_char( dhjy.jyrq, 'yyyy-mm-dd' ) jyrq,
			rkgl.rkdh,
			to_char( rkgl.rkrq, 'yyyy-mm-dd' ) rkrq
		FROM
			igams_ckxx ckxx
			RIGHT JOIN igams_hwxx hwxx ON hwxx.ckid = ckxx.ckid
				AND hwxx.zt = '99'
				AND hwxx.scbj = '0'
				AND ( COALESCE ( hwxx.kcl, 0 ) - COALESCE ( hwxx.yds, 0 ) ) != 0
			LEFT JOIN igams_qgmx qgmx on qgmx.qgmxid = hwxx.qgmxid and qgmx.scbj = '0'
			LEFT JOIN igams_qggl qggl on qggl.qgid = qgmx.qgid and qggl.scbj='0'
			left join matridx_xtyh xtyh on xtyh.yhid=qggl.sqr
			LEFT JOIN matridx_jgxx jgxx ON qggl.sqbm = jgxx.jgid
			LEFT JOIN igams_htmx htmx ON hwxx.htmxid = htmx.htmxid AND htmx.scbj = '0'
			LEFT JOIN igams_htgl htgl ON htgl.htid = htmx.htid AND htgl.scbj = '0'
			LEFT JOIN igams_dhxx dhxx ON hwxx.dhid = dhxx.dhid and hwxx.scbj ='0'
			left join igams_dhjy dhjy on dhjy.dhjyid=hwxx.dhjyid and dhjy.scbj ='0'
			LEFT JOIN igams_rkgl rkgl ON rkgl.rkid = hwxx.rkid
			AND rkgl.scbj = '0'
			left join igams_ckxx kw on kw.ckid = hwxx.kwbh
			LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
			AND wlgl.scbj = '0'
			LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		WHERE
			hwxx.hwid IS NOT NULL
			AND ckxx.ckmc = #{ckmc} and wllb.csmc = #{lbmc}
	</select>
	<!-- 分页查询 -->
	<select id="getPagedDtoList" parameterType="CkxxDto" resultType="CkxxDto">
		select ck.ckid,ck.fckid,ck.ckdm,ck.ckmc,ck.cklb,ck.bz,ck.lrry,ck.xgry,ck.xgsj,fck.ckmc as fckmc,xtyh.zsxm as lrrymc,cklb.csmc as cklbmc,ck.ckqxlx,
		to_char(ck.lrsj,'yyyy-MM-dd hh24:mi') as lrsj
		from igams_ckxx ck
		left join igams_ckxx fck on fck.ckid=ck.fckid
		left join matridx_xtyh xtyh on xtyh.yhid=ck.lrry
		left join matridx_jcsj cklb on cklb.csid=ck.cklb
		<where>
			ck.scbj!='1'
			<if test="ckmc!=null and ckmc!=''">
				and ck.ckmc like '%'||#{ckmc}||'%'
			</if>
			<if test="fckmc!=null and fckmc!=''">
				and fck.ckmc like '%'||#{fckmc}||'%'
			</if>
			<if test = "cklbs != null and cklbs.length > 0 "  >
				and ck.cklb in
				<foreach collection="cklbs" separator="," open="(" close=")" item="item" index="index">
					#{item}
				</foreach>
			</if>
			<if test = "ckfls != null and ckfls.length > 0 "  >
				and ck.ckqxlx in
				<foreach collection="ckfls" separator="," open="(" close=")" item="item" index="index">
					#{item}
				</foreach>
			</if>
		</where>
	</select>
	<insert id="insert" parameterType="CkxxDto" >
		insert into igams_ckxx(
			ckid,lrry,lrsj,scbj
		<if test="fckid!=null and fckid!=''">
			,fckid
		</if>
		<if test="ckdm!=null and ckdm!=''">
			,ckdm
		</if>
		<if test="ckmc!=null and ckmc!=''">
			,ckmc
		</if>
		<if test="cklb!=null and cklb!=''">
			,cklb
		</if>
		<if test="ckqxlx!=null and ckqxlx!=''">
			,ckqxlx
		</if>
		<if test="bz !=null and bz!=''">
			,bz
		</if>
		)values(
			#{ckid},#{lrry},LOCALTIMESTAMP,'0'
		<if test="fckid!=null and fckid!=''">
			,#{fckid}
		</if>
		<if test="ckdm!=null and ckdm!=''">
			,#{ckdm}
		</if>
		<if test="ckmc!=null and ckmc!=''">
			,#{ckmc}
		</if>
		<if test="cklb!=null and cklb!=''">
			,#{cklb}
		</if>
		<if test="ckqxlx!=null and ckqxlx!=''">
			,#{ckqxlx}
		</if>
		<if test="bz !=null and bz!=''">
			,#{bz}
		</if>
		)
	</insert>
	<!-- 根据id查询单个 -->
	<select id="getDtoById" parameterType="String" resultType="CkxxDto">
		select ck.ckid,ck.fckid,ck.ckdm,ck.ckmc,ck.cklb,ck.bz,ck.lrry,ck.lrsj,ck.xgry,ck.xgsj,xtyh.zsxm as lrrymc,ck.ckqxlx
		from igams_ckxx ck
		left join matridx_xtyh xtyh on xtyh.yhid=ck.lrry
		<where>
			ck.scbj !='1' and ck.ckid=#{ckid}  
		</where>
	</select>
	<!-- 修改仓库信息 -->
	<update id="update" parameterType="CkxxDto">
		update igams_ckxx set
		<if test="fckid!=null and fckid!=''">
			fckid=#{fckid},
		</if>
		<if test="ckdm!=null and ckdm!=''">
			ckdm=#{ckdm},
		</if>
		<if test="ckmc!=null and ckmc!=''">
			ckmc=#{ckmc},
		</if>
		<if test="cklb!=null and cklb!=''">
			cklb=#{cklb},
		</if>
		<if test="bz !=null and bz!=''">
			bz=#{bz},
		</if>
			xgry=#{xgry},xgsj=LOCALTIMESTAMP,ckqxlx=#{ckqxlx}
		<where>
			ckid=#{ckid}
		</where>
	</update>
	<!-- 查询所有仓库 -->
	<select id="getDtoList" parameterType="CkxxDto" resultType="CkxxDto">
		select ck.ckid,ck.fckid,ck.ckdm,ck.ckmc,ck.cklb,ck.bz,ck.lrry,ck.lrsj,ck.xgry,ck.xgsj,jcsj.csdm as cklbdm
		from igams_ckxx ck
		left join matridx_jcsj jcsj on jcsj.csid=ck.cklb
		<where> 
			ck.scbj!='1'
			<if test="ckid!=null and ckid!=''">  
				and ck.ckid !=#{ckid}
			</if>
			<if test="fckflg=='1'.toString()">
				and ck.fckid is null
			</if>
			<if test="fckid !=null and fckid!=''">
				and ck.fckid =#{fckid}
			</if>
			<if test="cklb !=null and cklb!=''">
				and ck.cklb =#{cklb}
			</if>
			<if test="cklbdm !=null and cklbdm !=''">
				and jcsj.csdm =#{cklbdm}
			</if>
			<if test="(xzbj != null and xzbj != '' and xzbj == '1'.toString()) and (jsid != null and jsid != '') ">
				and ck.ckid in (select ckjgxx.ckid from matridx_jsdwqx jsdwqx
				left join igams_ckjgxx ckjgxx on ckjgxx.jgid = jsdwqx.jgid
				where jsdwqx.jsid =#{jsid} and ckjgxx.ckid is not null)
			</if>
		</where>
	</select>
	<select id="getDto" parameterType="CkxxDto" resultType="CkxxDto">
		select ck.ckid,ck.fckid,ck.ckdm,ck.ckmc,ck.cklb,ck.bz,ck.lrry,ck.xgry,ck.xgsj,ck.lrsj,fck.ckmc as fckmc,xtyh.zsxm as lrrymc,cklb.csmc as cklbmc
		,to_char(ck.lrsj,'yyyy-mm-dd hh24:mi:ss') as f_lrsj
		from igams_ckxx ck
		left join igams_ckxx fck on fck.ckid=ck.fckid
		left join matridx_xtyh xtyh on xtyh.yhid=ck.lrry
		left join matridx_jcsj cklb on cklb.csid=ck.cklb
		<where>
			ck.scbj!='1'
			<if test="ckid!=null and ckid!=''">
				and ck.ckid =#{ckid}
			</if>
			<if test="fckid!=null and fckid !=''">
				and ck.fckid =#{fckid}
			</if>
			<if test="ckmc!=null and ckmc !=''">
				and ck.ckmc=#{ckmc}  
			</if>
			<if test="ckdm!=null and ckdm !=''">
				and ck.ckdm=#{ckdm}  
			</if>
		</where>
	</select>
	<delete id="delete" parameterType="CkxxDto">
		update igams_ckxx set scry=#{scry},scsj=LOCALTIMESTAMP,scbj='1'   
  	 	<where>
	  	 	<if test="ckid !=null and ckid!=''">
	  	 		or ckid=#{ckid} 
	  	 	</if>
	  	 	<if test="ids !=null and ids.size() !=''">
	  	 	 	or ckid in
	  	 	 		<foreach collection="ids" open="(" close=")" separator="," item="item" >
	  	 	 		 	#{item} 
	  	 	 		</foreach>
	  	 	</if>
		</where>
	</delete>
	<delete id="deletezck" parameterType="CkxxDto">
		update igams_ckxx set scry=#{scry},scsj=LOCALTIMESTAMP,scbj='1'   
  	 	<where>
	  	 	<if test="ckid !=null and ckid!=''">
	  	 		or fckid=#{ckid} 
	  	 	</if>
	  	 	<if test="ids !=null and ids.size() !=''">
	  	 	 	or fckid in
  	 	 		<foreach collection="ids" open="(" close=")" separator="," item="item" >
  	 	 		 	#{item} 
  	 	 		</foreach>
	  	 	</if>
		</where>
	</delete>
	
	<select id="checkFck" parameterType="String" resultType="CkxxDto">
		select  ck.ckid,ck.fckid,ck.ckdm,ck.ckmc,ck.cklb,ck.bz,ck.lrry,ck.lrsj,ck.xgry,ck.xgsj
		from igams_ckxx ck
		where ck.scbj!='1'
		and ck.fckid=#{fckid}
	</select>

	<select id="getDtoByCkdm" parameterType="String" resultType="CkxxDto">
		select  ck.ckid,ck.fckid,ck.ckdm,ck.ckmc,ck.cklb,ck.bz,ck.lrry,ck.lrsj,ck.xgry,ck.xgsj,ck.ckqxlx
		from igams_ckxx ck
		where ck.scbj!='1'
		and ck.ckdm=#{ckdm}
	</select>
	
		<!-- 查询所有库位 -->
	<select id="getKwDtoList" parameterType="CkxxDto" resultType="CkxxDto">
		select ck.ckid,ck.fckid,ck.ckdm,ck.ckmc,ck.cklb,ck.bz,ck.lrry,ck.lrsj,ck.xgry,ck.xgsj
		from igams_ckxx ck
		<where> 
			ck.scbj!='1' and ck.fckid =#{fckid} and cklb=#{cklb}			
		</where>
	</select>
	<!-- 查询子仓库 -->
	<select id="getKwDtoListByFckid" parameterType="CkxxDto" resultType="CkxxDto">
		select ck.ckid,ck.fckid,ck.ckdm,ck.ckmc,ck.cklb,ck.bz,ck.lrry,ck.lrsj,ck.xgry,ck.xgsj
		from igams_ckxx ck
		<where>
			ck.scbj!='1' and ck.fckid =#{fckid}
		</where>
	</select>

	<!-- 根据id查询单个 -->
	<select id="getCRkslByBm" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT COALESCE
	( tb.jgmc, tc.jgmc ) jgmc,
	COALESCE(tc.dhsl,0) AS dhsl,
	COALESCE(tb.cksl,0) AS cksl
FROM
	(
	SELECT
		jgxx.jgmc AS jgmc,
		SUM ( COALESCE ( hwllmx.slsl, 0 ) ) AS cksl
	FROM
		igams_llgl llgl
		JOIN igams_hwllmx hwllmx ON hwllmx.llid = llgl.llid
		AND hwllmx.scbj = '0'
		AND hwllmx.slsl
		IS NOT NULL LEFT JOIN matridx_jgxx jgxx ON llgl.sqbm = jgxx.jgid
	WHERE
		llgl.scbj = '0'
		<if test="startTime != null and startTime != ''">
			and to_char(llgl.sqrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(llgl.sqrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	GROUP BY
		( jgxx.jgmc )
	) tb
	FULL JOIN (
	SELECT
		jgxx.jgmc AS jgmc,
		SUM ( COALESCE ( hwxx.dhsl, 0 ) - COALESCE ( cythsl, 0 ) - COALESCE ( zjthsl, 0 ) ) AS dhsl
	FROM
		igams_dhxx dhxx
		LEFT JOIN igams_hwxx hwxx ON hwxx.dhid = dhxx.dhid
		AND hwxx.scbj = '0'
		LEFT JOIN matridx_jgxx jgxx ON dhxx.bm = jgxx.jgid
	WHERE
		dhxx.scbj = '0'
		<if test="startTime != null and startTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	GROUP BY
	( jgxx.jgmc )
	) tc ON tb.jgmc = tc.jgmc
	</select>

	<!-- 更具部门查种类分类入库数量 -->
	<select id="getDtoZlRksl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		tb.lbmc,
		COUNT ( 0 ) AS zl,
		SUM ( dhsl ) AS sl
		FROM
		(
		SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		SUM ( COALESCE ( hwxx.dhsl, 0 ) - COALESCE ( cythsl, 0 ) - COALESCE ( zjthsl, 0 ) ) AS dhsl
		FROM
		igams_dhxx dhxx
		RIGHT JOIN igams_hwxx hwxx ON hwxx.dhid = dhxx.dhid
		AND hwxx.scbj = '0'
		RIGHT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		LEFT JOIN matridx_jgxx jgxx ON dhxx.bm = jgxx.jgid
		WHERE
		dhxx.scbj = '0'
		<if test="jgmc != null and jgmc != ''">
			and jgxx.jgmc = #{jgmc}
		</if>
		<if test="startTime != null and startTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY
		( wllb.csmc, wlgl.wlid )
		) tb
		GROUP BY
		tb.lbmc
	</select>


	<!-- 更具部门查种类分类出库数量 -->
	<select id="getDtoZlCksl" parameterType="CkxxDto" resultType="CkxxDto">
SELECT
	tb.lbmc,
	COUNT ( 0 ) AS zl,
	SUM ( cksl ) AS sl
FROM
	(
	SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		SUM ( COALESCE ( hwllmx.slsl, 0 ) ) AS cksl
	FROM
		igams_llgl llgl
		LEFT JOIN igams_hwllmx hwllmx ON hwllmx.llid = llgl.llid
		AND hwllmx.scbj = '0'
		AND hwllmx.slsl
		IS NOT NULL
		LEFT JOIN igams_hwxx hwxx ON hwllmx.hwid = hwxx.hwid
		AND hwxx.scbj = '0'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		LEFT JOIN matridx_jgxx jgxx ON llgl.sqbm = jgxx.jgid
	WHERE
		llgl.scbj = '0'
		<if test="jgmc != null and jgmc != ''">
			and jgxx.jgmc = #{jgmc}
		</if>
		<if test="startTime != null and startTime != ''">
			and to_char(llgl.sqrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(llgl.sqrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	GROUP BY
		wllb.csmc,
		wlgl.wlid
	) tb
GROUP BY
	tb.lbmc
	</select>

	<!-- 更具部门查种类分类出库数量 -->
	<select id="getMxDtoByWllb" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		wlgl.wlbm,
		wlgl.wlmc,
		wlgl.gg,
		wlgl.ychh,
		wlgl.jldw,
		hwxx.scph,
		hwxx.zsh,
		COALESCE ( hwxx.kcl, 0 ) - COALESCE ( hwxx.yds, 0 ) AS kcl,
		COALESCE ( hwxx.dhsl, 0 ) - COALESCE ( hwxx.cythsl, 0 ) - COALESCE ( hwxx.zjthsl, 0 ) AS dhsl,
		COALESCE ( hwllmx.slsl, 0 ) cksl,
		hwxx.scrq,
		hwxx.yxq,
		qggl.djh,
		jc_xmdl.csmc AS xmdlmc,
		htgl.htnbbh
		FROM
		igams_dhxx dhxx
		LEFT JOIN igams_hwxx hwxx ON hwxx.dhid = dhxx.dhid
		AND hwxx.scbj = '0'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN igams_hwllmx hwllmx ON hwllmx.hwid = hwxx.hwid
		AND hwllmx.scbj = '0'
		LEFT JOIN igams_qgmx qgmx ON qgmx.qgmxid = hwxx.qgmxid
		AND qgmx.scbj = '0'
		LEFT JOIN igams_qggl qggl ON qggl.qgid = qgmx.qgid
		AND qggl.scbj = '0'
		LEFT JOIN igams_htmx htmx ON htmx.htmxid = hwxx.htmxid
		AND htmx.scbj = '0'
		LEFT JOIN igams_htgl htgl ON htgl.htid = htmx.htid
		AND htgl.scbj = '0'
		LEFT JOIN matridx_jcsj jc_xmdl ON jc_xmdl.csid = qggl.xmdl
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		LEFT JOIN matridx_jgxx jgxx ON dhxx.bm = jgxx.jgid
		WHERE
		dhxx.scbj = '0'
		<if test="jgmc != null and jgmc != ''">
			and jgxx.jgmc = #{jgmc}
		</if>
		<if test="lbmc != null and jgmc != ''">
			and wllb.csmc = #{lbmc}
		</if>
		<if test="startTime != null and startTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	</select>

	<select id="getItemInfo" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		wlgl.wlbm,
		wlgl.wlmc,
		wllb.csmc AS lbmc,
		wlgl.gg,
		wlgl.ychh,
		wlgl.jldw,
		hwxx.scph,
		hwxx.zsh,
		COALESCE ( hwxx.kcl, 0 ) kcl,
		( COALESCE ( hwxx.dhsl, 0 ) - COALESCE ( cythsl, 0 ) - COALESCE ( zjthsl, 0 ) ) AS dhsl,
		COALESCE ( hwllmx.slsl, 0 ) cksl,
		hwxx.scrq,
		hwxx.yxq,
		qggl.djh,
		jcsj_xmdl.csmc AS xmdlmc,
		htgl.htnbbh,
		jgxx.jgmc
		FROM
		igams_dhxx dhxx
		LEFT JOIN igams_hwxx hwxx ON dhxx.dhid = hwxx.dhid
		AND hwxx.scbj = '0'
		LEFT JOIN igams_qgmx qgmx ON hwxx.qgmxid = qgmx.qgmxid
		AND qgmx.scbj = '0'
		LEFT JOIN igams_qggl qggl ON qggl.qgid = qgmx.qgid
		AND qggl.scbj = '0'
		LEFT JOIN matridx_jcsj jcsj_xmdl ON jcsj_xmdl.csid = qggl.xmdl
		LEFT JOIN igams_wlgl wlgl ON hwxx.wlid = wlgl.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN igams_htmx htmx ON htmx.htmxid = hwxx.htmxid
		AND htmx.scbj = '0'
		LEFT JOIN igams_htgl htgl ON htgl.htid = htmx.htid
		AND htgl.scbj = '0'
		LEFT JOIN igams_hwllmx hwllmx ON hwllmx.hwid = hwxx.hwid
		AND hwllmx.scbj = '0'
		LEFT JOIN igams_llgl llgl ON llgl.llid = hwllmx.llid
		AND llgl.scbj = '0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		<if test="lx != null and lx != '' and lx == '入库数量'.toString()">
			LEFT JOIN matridx_jgxx jgxx ON dhxx.bm = jgxx.jgid
		</if>
		<if test="lx != null and lx != '' and lx == '出库数量'.toString()">
			LEFT JOIN matridx_jgxx jgxx  ON llgl.sqbm = jgxx.jgid
		</if>
		where dhxx.scbj = '0' and wllb.csmc = #{lbmc}
		<if test="jgmc != null and jgmc != ''">
			and jgxx.jgmc = #{jgmc}
		</if>
		<if test="lx != null and lx != '' and lx == '入库数量'.toString()">
			<if test="startTime != null and startTime != ''">
				and to_char(dhxx.dhrq,'YYYY-MM-dd') &gt;= #{startTime}
			</if>
			<if test="endTime != null and endTime != ''">
				and to_char(dhxx.dhrq,'YYYY-MM-dd') &lt;= #{endTime}
			</if>
		</if>
		<if test="lx != null and lx != '' and lx == '出库数量'.toString()">
			<if test="startTime != null and startTime != ''">
				and to_char(llgl.sqrq,'YYYY-MM-dd') &gt;= #{startTime}
			</if>
			<if test="endTime != null and endTime != ''">
				and to_char(llgl.sqrq,'YYYY-MM-dd') &lt;= #{endTime}
			</if>
		</if>
	</select>

	<select id="getdepotStatusLcInfo" parameterType="CkxxDto" resultType="CkxxDto">
		select '请购数量' as lc,
			(select sum(COALESCE(qgmx.sl,0)-COALESCE (qgqxmx.qxsl,0))
			FROM
			igams_qgmx qgmx
			LEFT OUTER JOIN igams_qggl qggl ON qgmx.qgid = qggl.qgid and qggl.scbj ='0'
			left join igams_qgqxmx qgqxmx on qgqxmx.qgmxid=qgmx.qgmxid and qgqxmx.scbj ='0'
			where qgmx.scbj = '0' and qggl.zt = '80'  and  qgmx.wlid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		) as wlsl,
			( select count(0) from (select wlgl.wllb
			FROM
			igams_qgmx qgmx
			LEFT OUTER JOIN igams_qggl qggl ON qgmx.qgid = qggl.qgid and qggl.scbj ='0'
			left join igams_qgqxmx qgqxmx on qgqxmx.qgmxid=qgmx.qgmxid and qgqxmx.scbj ='0'
			left join igams_wlgl wlgl on wlgl.wlid=qgmx.wlid and wlgl.scbj ='0'
			where qgmx.scbj = '0' and qggl.zt = '80'  and  qgmx.wlid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			GROUP BY wlgl.wllb) tb
		) as wlzl
		UNION ALL
		select '采购入库' as lc,
			(select sum((COALESCE(hwxx.dhsl,0)-COALESCE(cythsl,0)-COALESCE(zjthsl,0)))
			FROM
			igams_dhxx dhxx
			LEFT JOIN igams_hwxx hwxx ON hwxx.dhid = dhxx.dhid and hwxx.scbj ='0'
			left join matridx_jcsj rklb on rklb.csid=dhxx.rklb
			where dhxx.scbj = '0' and dhxx.zt = '80'
		<if test="startTime != null and startTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			and rklb.csmc = '采购入库'
		) as wlsl,
				( select count(0) from (select wlgl.wllb
			FROM
			igams_dhxx dhxx
			LEFT JOIN igams_hwxx hwxx ON hwxx.dhid = dhxx.dhid and hwxx.scbj ='0'
			left join matridx_jcsj rklb on rklb.csid=dhxx.rklb
			left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
			where dhxx.scbj = '0' and dhxx.zt = '80'
		<if test="startTime != null and startTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			and rklb.csmc = '采购入库'
			GROUP BY wlgl.wllb) tb
			) as wlzl
		UNION ALL
		select '成品入库' as lc,
			(select sum((COALESCE(hwxx.dhsl,0)-COALESCE(cythsl,0)-COALESCE(zjthsl,0)))
			FROM
			igams_dhxx dhxx
			LEFT JOIN igams_hwxx hwxx ON hwxx.dhid = dhxx.dhid and hwxx.scbj ='0'
			left join matridx_jcsj rklb on rklb.csid=dhxx.rklb
			where dhxx.scbj = '0' and dhxx.zt = '80'
		<if test="startTime != null and startTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			and rklb.csmc = '成品入库'
		) as wlsl,
				( select count(0) from (select wlgl.wllb
			FROM
			igams_dhxx dhxx
			LEFT JOIN igams_hwxx hwxx ON hwxx.dhid = dhxx.dhid and hwxx.scbj ='0'
			left join matridx_jcsj rklb on rklb.csid=dhxx.rklb
			left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
			where dhxx.scbj = '0' and dhxx.zt = '80'
		<if test="startTime != null and startTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			and rklb.csmc = '成品入库'
			GROUP BY wlgl.wllb) tb
		) as wlzl
		UNION ALL
		select '其它入库' as lc,
			(select sum((COALESCE(hwxx.dhsl,0)-COALESCE(cythsl,0)-COALESCE(zjthsl,0)))
			FROM
			igams_dhxx dhxx
			LEFT JOIN igams_hwxx hwxx ON hwxx.dhid = dhxx.dhid and hwxx.scbj ='0'
			left join matridx_jcsj rklb on rklb.csid=dhxx.rklb
			where dhxx.scbj = '0' and dhxx.zt = '80'
		<if test="startTime != null and startTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			and rklb.csmc = '其它入库'
		) as wlsl,
				( select count(0) from (select wlgl.wllb
			FROM
			igams_dhxx dhxx
			LEFT JOIN igams_hwxx hwxx ON hwxx.dhid = dhxx.dhid and hwxx.scbj ='0'
			left join matridx_jcsj rklb on rklb.csid=dhxx.rklb
			left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
			where dhxx.scbj = '0' and dhxx.zt = '80'
		<if test="startTime != null and startTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			and rklb.csmc = '其它入库'
			GROUP BY wlgl.wllb) tb
		) as wlzl
		UNION ALL
		select '质检数量' as lc,
			(select sum((COALESCE(hwxx.dhsl,0)-COALESCE(cythsl,0)))
			FROM
			igams_dhjy dhjy
			left join igams_hwxx hwxx on dhjy.dhjyid=hwxx.dhjyid and hwxx.scbj ='0'
			where dhjy.scbj = '0' and dhjy.zt = '80'  and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		) as wlsl,
				( select count(0) from (select wlgl.wllb
			FROM
			igams_dhjy dhjy
			left join igams_hwxx hwxx on dhjy.dhjyid=hwxx.dhjyid and hwxx.scbj ='0'
			left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
			where dhjy.scbj = '0' and dhjy.zt = '80'  and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			GROUP BY wlgl.wllb) tb
		) as wlzl
		UNION ALL
		select '质检不合格数' as lc,
			(select sum(COALESCE(zjthsl,0)-COALESCE(yclsl,0))
			FROM
			igams_dhjy dhjy
			left join igams_hwxx hwxx on dhjy.dhjyid=hwxx.dhjyid and hwxx.scbj ='0'
			where dhjy.scbj = '0' and dhjy.zt = '80'  and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		) as wlsl,
				( select count(0) from (select wlgl.wllb
			FROM
			igams_dhjy dhjy
			left join igams_hwxx hwxx on dhjy.dhjyid=hwxx.dhjyid and hwxx.scbj ='0'
			left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
			where dhjy.scbj = '0' and dhjy.zt = '80'  and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			GROUP BY wlgl.wllb) tb
		) as wlzl
		UNION ALL
		select '领料出库' as lc,
			(select sum(COALESCE(slsl,0))
			FROM
			igams_llgl llgl
			left join igams_hwllmx hwllmx on hwllmx.llid=llgl.llid and hwllmx.scbj ='0'
			where llgl.scbj = '0' and llgl.ckzt = '80' and llgl.zt = '80' and hwllmx.llid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(llgl.ckrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(llgl.ckrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		) as wlsl,
				( select count(0) from (select wlgl.wllb
			FROM
			igams_llgl llgl
			left join igams_hwllmx hwllmx on hwllmx.llid=llgl.llid and hwllmx.scbj ='0'
			LEFT JOIN igams_hwxx hwxx ON hwllmx.hwid = hwxx.hwid
			AND hwxx.scbj = '0'
			LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
			AND wlgl.scbj = '0'
			where llgl.scbj = '0' and llgl.zt = '80' and hwllmx.llid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(llgl.ckrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(llgl.ckrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			GROUP BY wlgl.wllb) tb
		) as wlzl
		UNION ALL
		select '借用数量' as lc,
			(select sum(COALESCE(jcjymx.jysl,0))
			FROM
			igams_jcjygl jcjygl
			left join igams_jcjymx jcjymx on jcjymx.jcjyid=jcjygl.jcjyid and jcjymx.scbj ='0'
			left join igams_hwxx hwxx on jcjymx.hwid=hwxx.hwid and hwxx.scbj ='0'
			where jcjygl.scbj = '0' and jcjygl.zt = '80' and jcjymx.jcjyid is not null and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(jcjygl.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(jcjygl.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		) as wlsl,
				( select count(0) from (select wlgl.wllb
			FROM
			igams_jcjygl jcjygl
			left join igams_jcjymx jcjymx on jcjymx.jcjyid=jcjygl.jcjyid and jcjymx.scbj ='0'
			left join igams_hwxx hwxx on jcjymx.hwid=hwxx.hwid and hwxx.scbj ='0'
			left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
			where jcjygl.scbj = '0' and jcjygl.zt = '80' and jcjymx.jcjyid is not null and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(jcjygl.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(jcjygl.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			GROUP BY wlgl.wllb) tb
		) as wlzl
		UNION ALL
		select '归还数量' as lc,
			(select sum(COALESCE(jcghmx.ghsl,0))
			FROM
			igams_jcghgl jcghgl
			left join igams_jcghmx jcghmx on jcghmx.jcghid=jcghgl.jcghid and jcghmx.scbj ='0'
		left join igams_hwxx hwxx on jcghmx.hwid=hwxx.hwid and hwxx.scbj ='0'
			where jcghgl.scbj = '0' and jcghgl.zt = '80' and jcghgl.jcghid is not null and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(jcghgl.ghrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(jcghgl.ghrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			) as wlsl,
				( select count(0) from (select wlgl.wllb
			FROM
			igams_jcghgl jcghgl
			left join igams_jcghmx jcghmx on jcghmx.jcghid=jcghgl.jcghid and jcghmx.scbj ='0'
			left join igams_hwxx hwxx on jcghmx.hwid=hwxx.hwid and hwxx.scbj ='0'
			left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
			where jcghgl.scbj = '0' and jcghgl.zt = '80' and jcghgl.jcghid is not null and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(jcghgl.ghrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(jcghgl.ghrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			GROUP BY wlgl.wllb) tb
		) as wlzl
		UNION ALL
		select '发货数量' as lc,
			(select sum(COALESCE(fhsl,0))
			FROM
			igams_fhgl fhgl
			left join igams_fhmx fhmx on fhmx.fhid=fhgl.fhid and fhmx.scbj ='0'
			left join igams_hwxx hwxx on fhmx.hwid=hwxx.hwid and hwxx.scbj ='0'
			where fhgl.scbj = '0' and fhgl.zt = '80' and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			and fhgl.sfbj = '1'
		) as wlsl,
				( select count(0) from (select wlgl.wllb
			FROM
			igams_fhgl fhgl
			left join igams_fhmx fhmx on fhmx.fhid=fhgl.fhid and fhmx.scbj ='0'
			left join igams_hwxx hwxx on fhmx.hwid=hwxx.hwid and hwxx.scbj ='0'
			left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
			where fhgl.scbj = '0' and fhgl.zt = '80' and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			and fhgl.sfbj = '1'
			GROUP BY wlgl.wllb) tb
		) as wlzl
		UNION ALL
		select '退货数量' as lc,
			(select sum(COALESCE(fhsl,0))
			FROM
			igams_fhgl fhgl
			left join igams_fhmx fhmx on fhmx.fhid=fhgl.fhid and fhmx.scbj ='0'
			left join igams_hwxx hwxx on fhmx.hwid=hwxx.hwid and hwxx.scbj ='0'
			where fhgl.scbj = '0' and fhgl.zt = '80' and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			and fhgl.sfbj = '0'
		) as wlsl,
				( select count(0) from (select wlgl.wllb
			FROM
			igams_fhgl fhgl
			left join igams_fhmx fhmx on fhmx.fhid=fhgl.fhid and fhmx.scbj ='0'
			left join igams_hwxx hwxx on fhmx.hwid=hwxx.hwid and hwxx.scbj ='0'
			left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
			where fhgl.scbj = '0' and fhgl.zt = '80' and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			and fhgl.sfbj = '0'
			GROUP BY wlgl.wllb) tb
		) as wlzl
	</select>

	<!-- 更具流程查种类分类入库数量 -->
	<select id="getDtoZlLcQgsl" parameterType="CkxxDto" resultType="CkxxDto">
	SELECT
    tb.lbmc,
    COUNT ( 0 ) AS zl,
    SUM ( wlsl ) AS sl
	FROM
    ( select
        wllb.csmc AS lbmc,
        wlgl.wlid, sum(COALESCE(qgmx.sl,0)-COALESCE (qgqxmx.qxsl,0)) as wlsl
			FROM
			igams_qgmx qgmx
			LEFT OUTER JOIN igams_qggl qggl ON qgmx.qgid = qggl.qgid and qggl.scbj ='0'
			left join igams_qgqxmx qgqxmx on qgqxmx.qgmxid=qgmx.qgmxid and qgqxmx.scbj ='0'
			left join igams_wlgl wlgl on wlgl.wlid=qgmx.wlid and wlgl.scbj ='0'
			LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
			where qgmx.scbj = '0' and qggl.zt = '80' and  qgmx.wlid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
			GROUP BY
       wllb.csmc, wlgl.wlid  ) tb
	GROUP BY
    tb.lbmc
	</select>

	<!-- 更具流程查种类分类入库数量 -->
	<select id="getDtoZlLcDhsl" parameterType="CkxxDto" resultType="CkxxDto">
	SELECT
	tb.lbmc,
	COUNT ( 0 ) AS zl,
	SUM ( wlsl ) AS sl
	FROM
	(
	SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		SUM ( ( COALESCE ( hwxx.dhsl, 0 ) - COALESCE ( cythsl, 0 ) - COALESCE ( zjthsl, 0 ) ) ) AS wlsl
	FROM
		igams_dhxx dhxx
		LEFT JOIN igams_hwxx hwxx ON hwxx.dhid = dhxx.dhid
		AND hwxx.scbj = '0'
		LEFT JOIN matridx_jcsj rklb ON rklb.csid = dhxx.rklb
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
	WHERE
		dhxx.scbj = '0'
		AND dhxx.zt = '80' AND rklb.csmc = #{lx}
		<if test="startTime != null and startTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>

	GROUP BY
		wllb.csmc,
		wlgl.wlid
	) tb
	GROUP BY
	tb.lbmc
	</select>

	<select id="getDtoZlLcZjhgsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		tb.lbmc,
		COUNT ( 0 ) AS zl,
		SUM ( wlsl ) AS sl
		FROM
		(
		SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		sum((COALESCE(hwxx.dhsl,0)-COALESCE(cythsl,0))) AS wlsl
		FROM
		igams_dhjy dhjy
		left join igams_hwxx hwxx on dhjy.dhjyid=hwxx.dhjyid and hwxx.scbj ='0'
		left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		where dhjy.scbj = '0' and dhjy.zt = '80' and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY
		wllb.csmc,
		wlgl.wlid
		) tb
		GROUP BY
		tb.lbmc
	</select>

	<select id="getDtoZlLcZjbhgsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		tb.lbmc,
		COUNT ( 0 ) AS zl,
		SUM ( wlsl ) AS sl
		FROM
		(
		SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		sum(COALESCE(zjthsl,0)-COALESCE(yclsl,0)) AS wlsl
		FROM
		igams_dhjy dhjy
		left join igams_hwxx hwxx on dhjy.dhjyid=hwxx.dhjyid and hwxx.scbj ='0'
		left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		where dhjy.scbj = '0' and dhjy.zt = '80' and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY
		wllb.csmc,
		wlgl.wlid
		) tb
		GROUP BY
		tb.lbmc
	</select>

	<select id="getDtoZlLcLlck" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		tb.lbmc,
		COUNT ( 0 ) AS zl,
		SUM ( wlsl ) AS sl
		FROM
		(
		SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		sum(COALESCE(slsl,0)) AS wlsl
		FROM
		igams_llgl llgl
		left join igams_hwllmx hwllmx on hwllmx.llid=llgl.llid and hwllmx.scbj ='0'
		LEFT JOIN igams_hwxx hwxx ON hwllmx.hwid = hwxx.hwid
		AND hwxx.scbj = '0'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		where llgl.scbj = '0'  and llgl.ckzt = '80' and llgl.zt = '80' and hwllmx.llid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(llgl.ckrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(llgl.ckrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY
		wllb.csmc,
		wlgl.wlid
		) tb
		GROUP BY
		tb.lbmc
	</select>

	<select id="getDtoZlLcJysl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		tb.lbmc,
		COUNT ( 0 ) AS zl,
		SUM ( wlsl ) AS sl
		FROM
		(
		SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		sum(COALESCE(jcjymx.jysl,0)) AS wlsl
		FROM
		igams_jcjygl jcjygl
		left join igams_jcjymx jcjymx on jcjymx.jcjyid=jcjygl.jcjyid and jcjymx.scbj ='0'
		left join igams_hwxx hwxx on jcjymx.hwid=hwxx.hwid and hwxx.scbj ='0'
		left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		where jcjygl.scbj = '0' and jcjygl.zt = '80' and jcjymx.jcjyid is not null and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(jcjygl.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(jcjygl.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY
		wllb.csmc,
		wlgl.wlid
		) tb
		GROUP BY
		tb.lbmc
	</select>

	<select id="getDtoZlLcGhsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		tb.lbmc,
		COUNT ( 0 ) AS zl,
		SUM ( wlsl ) AS sl
		FROM
		(
		SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		sum(COALESCE(jcghmx.ghsl,0)) AS wlsl
		FROM
		igams_jcghgl jcghgl
		left join igams_jcghmx jcghmx on jcghmx.jcghid=jcghgl.jcghid and jcghmx.scbj ='0'
		left join igams_hwxx hwxx on jcghmx.hwid=hwxx.hwid and hwxx.scbj ='0'
		left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		where jcghgl.scbj = '0' and jcghgl.zt = '80' and jcghmx.jcghid is not null and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(jcghgl.ghrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(jcghgl.ghrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY
		wllb.csmc,
		wlgl.wlid
		) tb
		GROUP BY
		tb.lbmc
	</select>

	<select id="getDtoZlLcSfsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		tb.lbmc,
		COUNT ( 0 ) AS zl,
		SUM ( wlsl ) AS sl
		FROM
		(
		SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		sum(COALESCE(fhsl,0)) AS wlsl
		FROM
		igams_fhgl fhgl
		left join igams_fhmx fhmx on fhmx.fhid=fhgl.fhid and fhmx.scbj ='0'
		left join igams_hwxx hwxx on fhmx.hwid=hwxx.hwid and hwxx.scbj ='0'
		left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		where fhgl.scbj = '0' and fhgl.zt = '80' and fhgl.sfbj = #{sfbj} and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY
		wllb.csmc,
		wlgl.wlid
		) tb
		GROUP BY
		tb.lbmc
	</select>


	<select id="getdepotStatusZtInfo" parameterType="CkxxDto" resultType="CkxxDto">
		select '请购中' as lc,
		(select sum(COALESCE(qgmx.sl,0)-COALESCE (qgqxmx.qxsl,0))
		FROM
		igams_qgmx qgmx
		LEFT OUTER JOIN igams_qggl qggl ON qgmx.qgid = qggl.qgid and qggl.scbj ='0'
		left join igams_qgqxmx qgqxmx on qgqxmx.qgmxid=qgmx.qgmxid and qgqxmx.scbj ='0'
		where qgmx.scbj = '0' and qggl.zt != '80'  and  qgmx.wlid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		) as wlsl,
		( select count(0) from (select wlgl.wllb
		FROM
		igams_qgmx qgmx
		LEFT OUTER JOIN igams_qggl qggl ON qgmx.qgid = qggl.qgid and qggl.scbj ='0'
		left join igams_qgqxmx qgqxmx on qgqxmx.qgmxid=qgmx.qgmxid and qgqxmx.scbj ='0'
		left join igams_wlgl wlgl on wlgl.wlid=qgmx.wlid and wlgl.scbj ='0'
		where qgmx.scbj = '0' and qggl.zt != '80'  and  qgmx.wlid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY wlgl.wllb) tb
		) as wlzl
		UNION ALL
		select '采购中' as lc,
		(select sum(COALESCE(htmx.sl,0))
		FROM
		igams_htgl htgl
		LEFT JOIN igams_htmx htmx ON htgl.htid = htmx.htid and htmx.scbj = '0'
		where htgl.scbj = '0' and htgl.zt != '80'
		<if test="startTime != null and startTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		) as wlsl,
		( select count(0) from (select wlgl.wllb
		FROM
		igams_htgl htgl
		LEFT JOIN igams_htmx htmx ON htgl.htid = htmx.htid and htmx.scbj = '0'
		left join igams_wlgl wlgl on wlgl.wlid=htmx.wlid and wlgl.scbj ='0'
		where htgl.scbj = '0' and htgl.zt != '80'
		<if test="startTime != null and startTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY wlgl.wllb) tb
		) as wlzl
		UNION ALL
		select '未到货' as lc,
		(select sum(COALESCE(htmx.sl,0) - COALESCE(htmx.dhsl,0))
		FROM
		igams_htgl htgl
		LEFT JOIN igams_htmx htmx ON htgl.htid = htmx.htid and htmx.scbj = '0'
		where htgl.scbj = '0' and htgl.zt = '80'
		<if test="startTime != null and startTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		) as wlsl,
		( select count(0) from (select wlgl.wllb
		FROM
		igams_htgl htgl
		LEFT JOIN igams_htmx htmx ON htgl.htid = htmx.htid and htmx.scbj = '0'
		left join igams_wlgl wlgl on wlgl.wlid=htmx.wlid and wlgl.scbj ='0'
		where htgl.scbj = '0' and htgl.zt = '80'
		<if test="startTime != null and startTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY wlgl.wllb) tb
		) as wlzl
		UNION ALL
		select '质检中' as lc,
		(select sum((COALESCE(hwxx.dhsl,0)-COALESCE(cythsl,0)))
		FROM
		igams_dhjy dhjy
		left join igams_hwxx hwxx on dhjy.dhjyid=hwxx.dhjyid and hwxx.scbj ='0'
		where dhjy.scbj = '0' and dhjy.zt != '80'  and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		) as wlsl,
		( select count(0) from (select wlgl.wllb
		FROM
		igams_dhjy dhjy
		left join igams_hwxx hwxx on dhjy.dhjyid=hwxx.dhjyid and hwxx.scbj ='0'
		left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
		where dhjy.scbj = '0' and dhjy.zt != '80'  and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY wlgl.wllb) tb
		) as wlzl
		UNION ALL
		select '待处理' as lc,
		(select sum(COALESCE(zjthsl,0)-COALESCE(yclsl,0))
		FROM
		igams_dhjy dhjy
		left join igams_hwxx hwxx on dhjy.dhjyid=hwxx.dhjyid and hwxx.scbj ='0' and COALESCE(zjthsl,0)-COALESCE(yclsl,0) != 0
		where dhjy.scbj = '0' and dhjy.zt = '80'  and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		) as wlsl,
		( select count(0) from (select wlgl.wllb
		FROM
		igams_dhjy dhjy
		left join igams_hwxx hwxx on dhjy.dhjyid=hwxx.dhjyid and hwxx.scbj ='0'and COALESCE(zjthsl,0)-COALESCE(yclsl,0) != 0
		left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
		where dhjy.scbj = '0' and dhjy.zt = '80'  and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY wlgl.wllb) tb
		) as wlzl
	</select>


	<select id="getDtoZlZtQgzsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		tb.lbmc,
		COUNT ( 0 ) AS zl,
		SUM ( wlsl ) AS sl
		FROM
		(
		select
		wllb.csmc AS lbmc,
		wlgl.wlid, sum(COALESCE(qgmx.sl,0)-COALESCE (qgqxmx.qxsl,0)) as wlsl
		FROM
		igams_qgmx qgmx
		LEFT OUTER JOIN igams_qggl qggl ON qgmx.qgid = qggl.qgid and qggl.scbj ='0'
		left join igams_qgqxmx qgqxmx on qgqxmx.qgmxid=qgmx.qgmxid and qgqxmx.scbj ='0'
		left join igams_wlgl wlgl on wlgl.wlid=qgmx.wlid and wlgl.scbj ='0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		where qgmx.scbj = '0' and qggl.zt != '80' and  qgmx.wlid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY
		wllb.csmc, wlgl.wlid  ) tb
		GROUP BY
		tb.lbmc
	</select>


	<select id="getDtoZlZtHtcgzsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		tb.lbmc,
		COUNT ( 0 ) AS zl,
		SUM ( wlsl ) AS sl
		FROM
		(
		SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		SUM ( COALESCE ( htmx.sl, 0 ) ) AS wlsl
		FROM
		igams_htgl htgl
		LEFT JOIN igams_htmx htmx ON htgl.htid = htmx.htid
		AND htmx.scbj = '0'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = htmx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		WHERE
		htgl.scbj = '0'
		AND htgl.zt != '80'
		<if test="startTime != null and startTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY
		wllb.csmc,
		wlgl.wlid
		) tb
		GROUP BY
		tb.lbmc
	</select>


	<select id="getDtoZlZtHtwdhsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		tb.lbmc,
		COUNT ( 0 ) AS zl,
		SUM ( wlsl ) AS sl
		FROM
		(
		SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		SUM ( COALESCE ( htmx.sl, 0 ) - COALESCE ( htmx.dhsl, 0 ) ) AS wlsl
		FROM
		igams_htgl htgl
		LEFT JOIN igams_htmx htmx ON htgl.htid = htmx.htid
		AND htmx.scbj = '0'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = htmx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		WHERE
		htgl.scbj = '0'
		AND htgl.zt = '80'
		<if test="startTime != null and startTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(htgl.lrsj,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY
		wllb.csmc,
		wlgl.wlid
		) tb
		GROUP BY
		tb.lbmc
	</select>

	<select id="getCkkcl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		ckxx.ckmc lc,
		tc.wlsl,
		COUNT ( tb.wllb ) AS wlzl
		FROM
		igams_ckxx ckxx
		RIGHT JOIN (
		SELECT
			ckxx.ckmc,
			SUM ( COALESCE ( hwxx.kcl, 0 ) ) AS wlsl
		FROM
			igams_ckxx ckxx
			RIGHT JOIN igams_hwxx hwxx ON hwxx.ckid = ckxx.ckid
			AND hwxx.zt = '99'
			AND hwxx.scbj = '0'
			AND COALESCE ( hwxx.kcl, 0 ) != 0
		WHERE
			ckxx.scbj = '0'
		GROUP BY
			ckxx.ckmc
		) tc ON tc.ckmc = ckxx.ckmc
		LEFT JOIN (
		SELECT
			ckxx.ckmc,
			wlgl.wllb
		FROM
			igams_ckxx ckxx
			LEFT JOIN igams_hwxx hwxx ON hwxx.ckid = ckxx.ckid
			AND hwxx.zt = '99'
			AND hwxx.scbj = '0'
			AND COALESCE ( hwxx.kcl, 0 ) != 0
			LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
			AND wlgl.scbj = '0'
		WHERE
			hwxx.hwid IS NOT NULL
		GROUP BY
			ckxx.ckmc,
			wlgl.wllb
		) tb ON tb.ckmc = ckxx.ckmc
		WHERE
		ckxx.scbj = '0'
		GROUP BY
		ckxx.ckmc,
		tc.wlsl
	</select>

	<select id="getDtoWlCkKcl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
			tb.lbmc,
			COUNT ( 0 ) AS zl,
			SUM ( wlsl ) AS sl
		FROM
			(
			SELECT
				wllb.csmc AS lbmc,
				wlgl.wlid,
				SUM ( COALESCE ( hwxx.kcl, 0 ) )  AS wlsl
			FROM
				igams_ckxx ckxx
				RIGHT JOIN igams_hwxx hwxx ON hwxx.ckid = ckxx.ckid
					AND hwxx.zt = '99'
					AND hwxx.scbj = '0'
					AND ( COALESCE ( hwxx.kcl, 0 ) - COALESCE ( hwxx.yds, 0 ) ) != 0
				LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
				AND wlgl.scbj = '0'
				LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
			WHERE
				hwxx.hwid IS NOT NULL
				AND ckmc = #{ckmc}
			GROUP BY
				wllb.csmc,
				wlgl.wlid
			) tb
			GROUP BY
				tb.lbmc
	</select>

	<select id="getItemInfoByLcLlsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		wlgl.wlbm,
		wlgl.wlmc,
		jc_wllb.csmc AS lbmc,
		wlgl.gg,
		wlgl.jldw,
		wlgl.ychh,
		hwxx.scph,
		hwxx.zsh,
		COALESCE ( hwllmx.slsl, 0 ) sl,
		llgl.lldh,
		to_char( llgl.ckrq, 'YYYY-MM-dd' ) ckrq,
		hwxx.scrq,
		hwxx.yxq,
		ck_kwbh.ckmc AS kwmc,
		ckxx.ckmc,
		jgxx.jgmc AS sqbmmc,
		llry.zsxm llr,
		flry.zsxm flr,
		ckgl.ckdh
		FROM
		igams_llgl llgl
		LEFT JOIN igams_hwllmx hwllmx ON hwllmx.llid = llgl.llid
		AND hwllmx.scbj = '0'
		LEFT JOIN igams_ckgl ckgl ON hwllmx.ckid = ckgl.ckid
		AND ckgl.scbj = '0'
		LEFT JOIN igams_hwxx hwxx ON hwllmx.hwid = hwxx.hwid
		AND hwxx.scbj = '0'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN matridx_jcsj jc_wllb ON jc_wllb.csid = wlgl.wllb
		LEFT JOIN igams_ckxx ck_kwbh ON ck_kwbh.ckid = hwxx.kwbh
		AND ck_kwbh.scbj = '0'
		LEFT JOIN igams_ckxx ckxx ON ckxx.ckid = hwxx.ckid
		AND ckxx.scbj = '0'
		LEFT JOIN matridx_jgxx jgxx ON jgxx.jgid = llgl.sqbm
		LEFT JOIN matridx_xtyh llry ON llry.yhid = llgl.llr
		LEFT JOIN matridx_xtyh flry ON flry.yhid = llgl.flry
		WHERE
		llgl.scbj = '0'
		AND llgl.zt = '80'
		and llgl.ckzt = '80'
		AND hwllmx.llid IS NOT NULL
		AND jc_wllb.csmc = #{lbmc}
		<if test="startTime != null and startTime != ''">
			and to_char(llgl.ckrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(llgl.ckrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	</select>

	<select id="getItemInfoByFhsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		xtyh.zsxm AS sqr,
		jgxx.jgmc as sqbmmc,
		fhgl.fhdh,
		xsgl.oaxsdh,
		wlgl.wlbm,
		wlgl.wlmc,
		jc_wllb.csmc AS lbmc,
		wlgl.gg,
		wlgl.jldw,
		wlgl.ychh,
		hwxx.scph,
		hwxx.zsh,
		hwxx.scrq,
		hwxx.yxq,
		ck_kwbh.ckmc AS kwmc,
		ckxx.ckmc,
		COALESCE(hwxx.kcl,0)-COALESCE(hwxx.yds,0) AS kcl,
		COALESCE(ckmx.cksl,0) as cksl
		FROM
		igams_khgl khgl
		RIGHT JOIN igams_fhgl fhgl ON fhgl.kh = khgl.khid
		AND fhgl.zt = '80'
		AND fhgl.scbj = '0'
		LEFT JOIN igams_fhmx fhmx ON fhmx.fhid = fhgl.fhid
		AND fhmx.scbj = '0'
		LEFT JOIN igams_ckgl ckgl ON ckgl.ckid = fhmx.ckid
		AND ckgl.scbj = '0'
		LEFT JOIN igams_ckmx ckmx ON ckmx.ckid = ckgl.ckid
		AND ckmx.scbj = '0'
		LEFT JOIN igams_hwxx hwxx ON fhmx.hwid = hwxx.hwid
		AND hwxx.scbj = '0'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN matridx_jcsj jc_wllb ON jc_wllb.csid = wlgl.wllb
		LEFT JOIN igams_ckxx ck_kwbh ON ck_kwbh.ckid = hwxx.kwbh
		AND ck_kwbh.scbj = '0'
		LEFT JOIN igams_ckxx ckxx ON ckxx.ckid = hwxx.ckid
		AND ckxx.scbj = '0'
		LEFT JOIN igams_xsgl xsgl ON xsgl.xsid = fhgl.ddh
		AND xsgl.scbj = '0'
		LEFT JOIN matridx_jgxx jgxx ON jgxx.jgid = fhgl.xsbm
		LEFT JOIN
		matridx_xtyh xtyh
		ON xtyh.yhid = fhgl.jsr
		WHERE
		hwxx.hwid IS NOT NULL
		AND jc_wllb.csmc = #{lbmc}
		AND khmc = #{khmc}
		<if test="startTime != null and startTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	</select>


	<select id="getItemInfoByJysl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		xtyh.zsxm AS sqr,
		jgxx.jgmc AS sqbmmc,
		jcjygl.jydh,
		wlgl.wlbm,
		wlgl.wlmc,
		jc_wllb.csmc AS lbmc,
		wlgl.gg,
		wlgl.jldw,
		wlgl.ychh,
		hwxx.scph,
		hwxx.zsh,
		hwxx.scrq,
		hwxx.yxq,
		ck_kwbh.ckmc AS kwmc,
		ckxx.ckmc,
		COALESCE (jcjymx.jysl,0) jysl,
		COALESCE ( hwxx.kcl, 0 ) - COALESCE ( hwxx.yds, 0 ) AS kcl
		FROM
		igams_khgl khgl
		RIGHT JOIN igams_jcjygl jcjygl ON jcjygl.dwid = khgl.khid
		AND jcjygl.zt = '80'
		AND jcjygl.scbj = '0'
		LEFT JOIN igams_jcjymx jcjymx ON jcjymx.jcjyid = jcjygl.jcjyid
		AND jcjymx.scbj = '0'
		LEFT JOIN igams_hwxx hwxx ON jcjymx.hwid = hwxx.hwid
		AND hwxx.scbj = '0'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN matridx_jcsj jc_wllb ON jc_wllb.csid = wlgl.wllb
		LEFT JOIN igams_ckxx ck_kwbh ON ck_kwbh.ckid = hwxx.kwbh
		AND ck_kwbh.scbj = '0'
		LEFT JOIN igams_ckxx ckxx ON ckxx.ckid = hwxx.ckid
		AND ckxx.scbj = '0'
		LEFT JOIN matridx_jgxx jgxx ON jgxx.jgid = jcjygl.bm
		LEFT JOIN matridx_xtyh xtyh ON xtyh.yhid = jcjygl.lrry
		WHERE
		hwxx.hwid IS NOT NULL
		AND jc_wllb.csmc = #{lbmc}
		AND khmc = #{khmc}
		<if test="startTime != null and startTime != ''">
			and to_char(jcjygl.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(jcjygl.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	</select>


	<select id="getItemInfoByLcCpsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		rkgl.rkdh,
		hwxx.u8rkdh,
		to_char(dhxx.dhrq,'YYYY-MM-dd') dhrq,
		wlgl.wlbm,
		wlgl.wlmc,
		jc_wllb.csmc AS lbmc,
		wlgl.gg,
		wlgl.jldw,
		wlgl.ychh,
		hwxx.scph,
		hwxx.zsh,
		hwxx.scrq,
		hwxx.yxq,
		( COALESCE ( hwxx.dhsl, 0 ) - COALESCE ( cythsl, 0 ) - COALESCE ( zjthsl, 0 ) ) sl,
		ck_kwbh.ckmc AS kwmc,
		ckxx.ckmc
		FROM
		igams_dhxx dhxx
		LEFT JOIN igams_hwxx hwxx ON hwxx.dhid = dhxx.dhid
		AND hwxx.scbj = '0'
		LEFT JOIN igams_rkgl rkgl ON rkgl.rkid = hwxx.rkid
		AND hwxx.scbj = '0'
		LEFT JOIN matridx_jcsj rklb ON rklb.csid = dhxx.rklb
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN igams_ckxx ck_kwbh ON ck_kwbh.ckid = hwxx.kwbh
		AND ck_kwbh.scbj = '0'
		LEFT JOIN igams_ckxx ckxx ON ckxx.ckid = hwxx.ckid
		AND ckxx.scbj = '0'
		LEFT JOIN matridx_jcsj jc_wllb ON jc_wllb.csid = wlgl.wllb
		WHERE
		dhxx.scbj = '0'
		AND dhxx.zt = '80'
		AND rklb.csmc = #{lx}
		AND jc_wllb.csmc = #{lbmc}
		<if test="startTime != null and startTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	</select>


	<select id="getDtoWlCkhwKcl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
			tb.lbmc lc,
			COUNT ( 0 ) AS wlzl,
			SUM ( wlsl ) AS wlsl
		FROM
			(
			SELECT
				wllb.csmc AS lbmc,
				SUM ( COALESCE ( hwxx.kcl, 0 ) ) AS wlsl
			FROM
			igams_hwxx hwxx
			LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
			AND wlgl.scbj = '0'
			LEFT JOIN igams_ckhwxx ckhwxx ON wlgl.wlid = ckhwxx.wlid
			LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
			where hwxx.scbj='0'
			GROUP BY
				wllb.csmc
			) tb
		GROUP BY
			tb.lbmc
	</select>

	<select id="getDtoZlZtzjzsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		tb.lbmc,
		COUNT ( 0 ) AS zl,
		SUM ( wlsl ) AS sl
		FROM
		(
		SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		sum((COALESCE(hwxx.dhsl,0)-COALESCE(cythsl,0))) AS wlsl
		FROM
		igams_dhjy dhjy
		left join igams_hwxx hwxx on dhjy.dhjyid=hwxx.dhjyid and hwxx.scbj ='0'
		left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj ='0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		where dhjy.scbj = '0' and dhjy.zt != '80'  and hwxx.hwid is not null
		<if test="startTime != null and startTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY
		wllb.csmc,
		wlgl.wlid
		) tb
		GROUP BY
		tb.lbmc
	</select>


	<select id="getKhJysl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		khgl.khmc lc,
		tc.wlsl,
		COUNT ( tb.wllb ) AS wlzl
		FROM
		igams_khgl khgl
		RIGHT JOIN (
		SELECT
		khgl.khmc,
		SUM ( COALESCE (jcjymx.jysl,0) ) AS wlsl
		FROM
		igams_khgl khgl
		RIGHT JOIN igams_jcjygl jcjygl ON jcjygl.dwid = khgl.khid
		AND jcjygl.zt = '80'
		AND jcjygl.scbj = '0'
		LEFT JOIN igams_jcjymx jcjymx ON jcjymx.jcjyid = jcjygl.jcjyid and jcjymx.scbj = '0'
		WHERE khgl.scbj ='0'
		<if test="startTime != null and startTime != ''">
			and to_char(jcjygl.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(jcjygl.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY
		khgl.khmc
		) tc ON tc.khmc = khgl.khmc
		LEFT JOIN (
		SELECT
		khgl.khmc,
		wlgl.wllb
		FROM
		igams_khgl khgl
		LEFT JOIN igams_jcjygl jcjygl ON jcjygl.dwid = khgl.khid
		AND jcjygl.zt = '80'
		AND jcjygl.scbj = '0'
		LEFT JOIN igams_jcjymx jcjymx ON jcjymx.jcjyid = jcjygl.jcjyid and jcjymx.scbj = '0'
		LEFT JOIN igams_hwxx hwxx ON jcjymx.hwid = hwxx.hwid
		AND hwxx.scbj = '0'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
		AND wlgl.scbj = '0'
		WHERE
		hwxx.hwid IS NOT NULL
		<if test="startTime != null and startTime != ''">
			and to_char(jcjygl.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(jcjygl.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY
		khgl.khmc,
		wlgl.wllb
		) tb ON tb.khmc = khgl.khmc
		WHERE
		khgl.scbj = '0'
		GROUP BY
		khgl.khmc,
		tc.wlsl
	</select>


	<select id="getDtoZlKhjy" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
	tb.lbmc,
	COUNT ( 0 ) AS zl,
	SUM ( wlsl ) AS sl
FROM
	(
	SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		SUM (  COALESCE (jcjymx.jysl,0) ) AS wlsl
	FROM
		igams_khgl khgl
		RIGHT JOIN igams_jcjygl jcjygl ON jcjygl.dwid = khgl.khid
		AND jcjygl.zt = '80'
		AND jcjygl.scbj = '0'
		LEFT JOIN igams_jcjymx jcjymx ON jcjymx.jcjyid = jcjygl.jcjyid and jcjymx.scbj = '0'
		LEFT JOIN igams_hwxx hwxx ON jcjymx.hwid = hwxx.hwid
		AND hwxx.scbj = '0'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
	WHERE
		hwxx.hwid IS NOT NULL
		AND khmc = #{khmc}
		<if test="startTime != null and startTime != ''">
			and to_char(jcjygl.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(jcjygl.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	GROUP BY
		wllb.csmc,
		wlgl.wlid
	) tb
	GROUP BY
		tb.lbmc
	</select>

	<select id="getDtoZlKhfh" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		tb.lbmc,
		COUNT ( 0 ) AS zl,
		SUM ( wlsl ) AS sl
		FROM
		(
		SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		SUM ( fhmx.fhsl ) AS wlsl
		FROM
		igams_khgl khgl
		RIGHT JOIN igams_fhgl fhgl ON fhgl.kh = khgl.khid
		AND fhgl.zt = '80'
		AND fhgl.scbj = '0'
		LEFT JOIN igams_fhmx fhmx ON fhmx.fhid = fhgl.fhid and fhmx.scbj = '0'
		LEFT JOIN igams_hwxx hwxx ON fhmx.hwid = hwxx.hwid
		AND hwxx.scbj = '0'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		WHERE
		hwxx.hwid IS NOT NULL
		AND khmc = #{khmc}
		<if test="startTime != null and startTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY
		wllb.csmc,
		wlgl.wlid
		) tb
		GROUP BY
		tb.lbmc
	</select>

	<select id="getDtoZlZtzjdclsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		tb.lbmc,
		COUNT ( 0 ) AS zl,
		SUM ( wlsl ) AS sl
		FROM
		(
		SELECT
		wllb.csmc AS lbmc,
		wlgl.wlid,
		sum(COALESCE(zjthsl,0)-COALESCE(yclsl,0)) AS wlsl
		FROM
		igams_dhjy dhjy
		LEFT JOIN igams_hwxx hwxx ON dhjy.dhjyid = hwxx.dhjyid
		AND hwxx.scbj = '0'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
		AND wlgl.scbj = '0'
		LEFT JOIN matridx_jcsj wllb ON wllb.csid = wlgl.wllb
		WHERE
		dhjy.scbj = '0'
		AND dhjy.zt = '80'
		AND hwxx.hwid IS NOT NULL
		and COALESCE(zjthsl,0)-COALESCE(yclsl,0) != 0
		<if test="startTime != null and startTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhjy.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
		GROUP BY
		wllb.csmc,
		wlgl.wlid
		) tb
		GROUP BY
		tb.lbmc
	</select>

	<select id="getItemInfoByLcQgsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		qggl.djh,
		to_char( qggl.sqrq, 'YYYY-MM-dd' ) sqrq,
		qggl.jlbh,
		jc_xmbm.csmc AS xmbmmc,
		jc_xmdl.csmc AS xmdlmc,
		jg_sqbm.jgmc AS sqbmmc,
		wlgl.wlbm,
		wlgl.wlmc,
		wlgl.wllb,
		jc_wllb.csmc AS lbmc,
		wlgl.gg,
		wlgl.jldw,
		wlgl.ychh,
		COALESCE ( qgmx.sl, 0 ) sl,
		COALESCE ( qgmx.jg, 0 ) jg,
		qggl.sqly
		FROM
		igams_qggl qggl
		LEFT JOIN matridx_jcsj jc_xmbm ON jc_xmbm.csid = qggl.xmbm
		LEFT JOIN matridx_jcsj jc_xmdl ON jc_xmdl.csid = qggl.xmdl
		LEFT JOIN matridx_jgxx jg_sqbm ON jg_sqbm.jgid = qggl.sqbm
		LEFT JOIN igams_qgmx qgmx ON qggl.qgid = qgmx.qgid
		AND qgmx.scbj = '0'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = qgmx.wlid
		LEFT JOIN matridx_jcsj jc_wllb ON jc_wllb.csid = wlgl.wllb
		where qggl.zt = '80' and qggl.scbj = '0' and jc_wllb.csmc = #{lbmc}
		<if test="startTime != null and startTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(qggl.sqrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	</select>
	<!--采购入库显示字段，入库单号，U8单号，请购单号，合同单号，到货日期，物料编码，物料名称，物料类别，规格，货号，单位，生产批号，追溯号，生产日期，有效期，数量，仓库，货位；-->
	<select id="getItemInfoByLcCgrk" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT rkgl.rkdh,hwxx.u8rkdh,qggl.djh,htgl.htnbbh,dhxx.dhrq,wlgl.wlbm,wlgl.wlmc,jcsj.csmc wllbmc,wlgl.gg,wlgl.ychh,wlgl.jldw,hwxx.scph,hwxx.zsh,hwxx.scrq,hwxx.yxq, ( COALESCE ( hwxx.dhsl, 0 ) - COALESCE ( cythsl, 0 ) - COALESCE ( zjthsl, 0 ) ) sl,ckxxck.ckmc,ckxxkw.ckmc kwmc
		FROM
		igams_dhxx dhxx
		LEFT JOIN igams_hwxx hwxx ON hwxx.dhid = dhxx.dhid and hwxx.scbj = '0'
		LEFT JOIN igams_qgmx qgmx on qgmx.qgmxid = hwxx.qgmxid and qgmx.scbj = '0'
		LEFT JOIN igams_qggl qggl on qggl.qgid = qgmx.qgid and qggl.scbj='0'
		left join igams_rkgl rkgl on rkgl.rkid = hwxx.rkid and rkgl.scbj='0'
		LEFT JOIN igams_htmx htmx ON htmx.htmxid = hwxx.htmxid AND htmx.scbj = '0'
		LEFT JOIN igams_htgl htgl on htgl.htid = htmx.htid and htgl.scbj = '0'
		LEFT JOIN igams_wlgl wlgl on wlgl.wlid = hwxx.wlid and wlgl.scbj='0'
		left join matridx_jcsj jcsj on jcsj.csid = wlgl.wllb and jcsj.scbj='0'
		LEFT JOIN igams_ckxx ckxxck on ckxxck.ckid = hwxx.ckid and ckxxck.scbj='0'
		LEFT JOIN igams_ckxx ckxxkw on ckxxkw.ckid = hwxx.kwbh and ckxxkw.scbj='0'
		LEFT JOIN matridx_jcsj rklb ON rklb.csid = dhxx.rklb
		where dhxx.zt = '80' and dhxx.scbj = '0' and jcsj.csmc = #{lbmc} AND rklb.csmc = #{lx}
		<if test="startTime != null and startTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	</select>

    <!--质检数量显示字段，检验单号，到货单号，U8到货单号，检验日期，检验结果，物料编码，物料名称，物料类别，规格，单位，货号，生产批号，追溯号， 质检数量，取样量，借用数量，不合格数量；-->
    <select id="getItemInfoByLcZjsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
		dhjy.jydh,dhxx.dhdh,hwxx.u8rkdh,dhjy.jyrq,jcsjjy.csmc jyjgmc,wlgl.wlbm,wlgl.wlmc,jcsj.csmc wllbmc,wlgl.gg,wlgl.jldw,wlgl.ychh,hwxx.scph,hwxx.zsh,
		( COALESCE ( hwxx.dhsl, 0 ) - COALESCE ( cythsl, 0 ) ) zjsl,
		COALESCE ( hwxx.qyl, 0 ) qyl,COALESCE ( hwxx.jysl, 0 ) jysl,(COALESCE(zjthsl,0)-COALESCE(yclsl,0)) bhgsl
		FROM
		igams_dhjy dhjy
		LEFT JOIN igams_hwxx hwxx on dhjy.dhjyid = hwxx.dhjyid
		LEFT JOIN igams_qgmx qgmx on qgmx.qgmxid = hwxx.qgmxid
		LEFT JOIN igams_qggl qggl on qggl.qgid = qgmx.qgid
		LEFT JOIN igams_dhxx dhxx on hwxx.dhid = dhxx.dhid
		left join igams_wlgl wlgl on wlgl.wlid = hwxx.wlid
		left join matridx_jcsj jcsj on jcsj.csid = wlgl.wllb
		left join matridx_jcsj jcsjjy on jcsjjy.csid = dhjy.jyjg
        where
		<if test="lx == '质检不合格数' or lx == '质检数量'">
			dhjy.zt = '80'
		</if>
		<if test="lx == '质检中' ">
			dhjy.zt != '80'
		</if>
		<if test="lx == '待处理' ">
			dhjy.zt = '80'  and COALESCE(zjthsl,0)-COALESCE(yclsl,0) != 0
		</if>
		and dhjy.scbj = '0'
		and jcsj.csmc = #{lbmc}
        <if test="startTime != null and startTime != ''">
            and to_char(dhjy.jyrq,'YYYY-MM-dd') &gt;= #{startTime}
        </if>
        <if test="endTime != null and endTime != ''">
            and to_char(dhjy.jyrq,'YYYY-MM-dd') &lt;= #{endTime}
        </if>
    </select>

    <select id="getKhfhsl" parameterType="CkxxDto" resultType="CkxxDto">
		SELECT
	khgl.khmc lc,
	tc.wlsl,
	COUNT ( tb.wllb ) AS wlzl
	FROM
	igams_khgl khgl
	RIGHT JOIN (
	SELECT
		khgl.khmc,
		SUM ( fhmx.fhsl ) AS wlsl
	FROM
		igams_khgl khgl
		RIGHT JOIN igams_fhgl fhgl ON fhgl.kh = khgl.khid
		AND fhgl.zt = '80'
		AND fhgl.scbj = '0'
		LEFT JOIN igams_fhmx fhmx ON fhmx.fhid = fhgl.fhid and fhmx.scbj = '0'
	WHERE khgl.scbj ='0'
		<if test="startTime != null and startTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	GROUP BY
		khgl.khmc
	) tc ON tc.khmc = khgl.khmc
	LEFT JOIN (
	SELECT
		khgl.khmc,
		wlgl.wllb
	FROM
		igams_khgl khgl
		LEFT JOIN igams_fhgl fhgl ON fhgl.kh = khgl.khid
		AND fhgl.zt = '80'
		AND fhgl.scbj = '0'
		LEFT JOIN igams_fhmx fhmx ON fhmx.fhid = fhgl.fhid and fhmx.scbj = '0'
		LEFT JOIN igams_hwxx hwxx ON fhmx.hwid = hwxx.hwid
		AND hwxx.scbj = '0'
		LEFT JOIN igams_wlgl wlgl ON wlgl.wlid = hwxx.wlid
		AND wlgl.scbj = '0'
	WHERE
		hwxx.hwid IS NOT NULL
		<if test="startTime != null and startTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(fhgl.djrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	GROUP BY
		khgl.khmc,
		wlgl.wllb
	) tb ON tb.khmc = khgl.khmc
	WHERE
	khgl.scbj = '0'
	GROUP BY
	khgl.khmc,
	tc.wlsl
	</select>
	<sql id="INFO_TERMS">
		FROM igams_dhxx dhxx
		LEFT JOIN igams_hwxx hwxx ON dhxx.dhid = hwxx.dhid
		LEFT JOIN igams_dhjy dhjy ON dhjy.dhjyid = hwxx.dhjyid AND dhjy.scbj = '0' AND dhjy.zt = '80'
		LEFT JOIN igams_sczlmx sczlmx ON sczlmx.sczlmxid = hwxx.sczlmxid AND sczlmx.zt = '80' AND sczlmx.scbj = '0'
		LEFT JOIN igams_sczlgl sczlgl ON sczlmx.sczlid = sczlgl.sczlid AND sczlgl.zt = '80' AND sczlgl.scbj = '0'
		LEFT JOIN matridx_jcsj cplx ON cplx.csid = sczlgl.cplx
		LEFT JOIN igams_cpxqjh cpxqjh ON cpxqjh.cpxqid = sczlmx.cpxqid AND cpxqjh.zt = '80' AND cpxqjh.scbj = '0'
		WHERE dhxx.zt = '80' AND dhxx.scbj = '0' AND sczlgl.sczlid IS NOT NULL AND sczlmx.sczlmxid IS NOT NULL
		AND cplx.csdm = #{csdm}
		<if test="startTime != null and startTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &gt;= #{startTime}
		</if>
		<if test="endTime != null and endTime != ''">
			and to_char(dhxx.dhrq,'YYYY-MM-dd') &lt;= #{endTime}
		</if>
	</sql>

	<sql id="TERMS">
		FROM
		matridx_shxx shxx
		LEFT OUTER JOIN matridx_spgw gw ON shxx.gwid = gw.gwid
		LEFT OUTER JOIN matridx_xtsh xtsh ON xtsh.shid = shxx.shid
		WHERE
		( shxx.sftg = '1' OR shxx.sftg IS NULL )
		AND shxx.ywid IN
	</sql>

	<sql id="INFO">
		select gw.gwmc,COALESCE ( shxx.lcxh, '0' ) AS lcxh,CAST(CEILING ( AVG ( EXTRACT ( epoch FROM shxx.shsj ) ) ) as INTEGER) AS avg_day,xtsh.shlb,
	</sql>

	<select id="getScLcInfoList" parameterType="CkxxDto" resultType="CkxxDto">
		(<include refid="INFO"></include>
		'SC' AS lx
		<include refid="TERMS"></include>
		 (
		select  sczlmx.sczlmxid
		<include refid="INFO_TERMS"></include>
		group by sczlmx.sczlmxid
		)
		GROUP BY shxx.lcxh,gw.gwmc,xtsh.shlb ORDER BY lcxh ASC)
		UNION ALL(
		<include refid="INFO"></include>
		'CP' AS lx
		<include refid="TERMS"></include>
		(
		select  cpxqjh.cpxqid
		<include refid="INFO_TERMS"></include>
		group by cpxqjh.cpxqid
		)
		GROUP BY shxx.lcxh,gw.gwmc,xtsh.shlb ORDER BY lcxh ASC)
		UNION ALL (
		<include refid="INFO"></include>
		'DH' AS lx
		<include refid="TERMS"></include>
		(
		select  dhxx.dhid
		<include refid="INFO_TERMS"></include>
		group by dhxx.dhid
		)
		GROUP BY shxx.lcxh,gw.gwmc,xtsh.shlb ORDER BY lcxh ASC)
		UNION ALL (
		<include refid="INFO"></include>
		'ZJ' AS lx
		<include refid="TERMS"></include>
		(
		select  dhjy.dhjyid
		<include refid="INFO_TERMS"></include>
		group by dhjy.dhjyid
		)
		GROUP BY shxx.lcxh,gw.gwmc,xtsh.shlb ORDER BY lcxh ASC)
	</select>
</mapper>
