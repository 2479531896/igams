<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.matridx.igams.production.dao.post.ISbysDao" >
    <sql id="selectWhere">
        <if test="entire != null and entire != ''">
            and (
             sbys.sbbh ILIKE '%' ||#{entire}||'%'
	    or sbys.gdzcbh ILIKE '%' ||#{entire}||'%'
            or sbys.sbmc ILIKE '%' ||#{entire}||'%'
            or sbys.ggxh ILIKE '%' ||#{entire}||'%'
            or sbys.sbccbh ILIKE '%' ||#{entire}||'%'
            or sbys.xlh ILIKE '%' ||#{entire}||'%'
            or glry.zsxm ILIKE '%' ||#{entire}||'%'
            or sbys.sydd ILIKE '%' ||#{entire}||'%'
            or sbys.sccj ILIKE '%' ||#{entire}||'%'
            or sbys.sccjlxfs ILIKE '%' ||#{entire}||'%'
            or qggl.djh ILIKE '%' ||#{entire}||'%'
            or sbbmfzr.zsxm ILIKE '%' ||#{entire}||'%'
            or ysr.zsxm ILIKE '%' ||#{entire}||'%'
            )
        </if>
        <if test="sblx !=null and sblx!=''">
            and sbys.sblx=#{sblx}
        </if>
        <if test="tzzt !=null and tzzt!=''">
            and sbys.tzzt=#{tzzt}
        </if>
        <if test="sfgdzc !=null and sfgdzc!='' and sfgdzc=='1'.toString()">
            and htmx.sfgdzc=#{sfgdzc}
        </if>
        <if test="sfbmxz!=null and sfbmxz!='' and sfbmxz=='2'.toString()">
            and sbys.xsyr=#{xsyr}
        </if>
        <if test="sbbh!=null and sbbh!=''">
            and sbys.sbbh ILIKE '%' ||#{sbbh}||'%'
        </if>
        <if test="sbmc!=null and sbmc!=''">
            and sbys.sbmc ILIKE '%' ||#{sbmc}||'%'
        </if>
        <if test="gdzcbh!=null and gdzcbh!=''">
            and sbys.gdzcbh ILIKE '%' ||#{gdzcbh}||'%'
        </if>
        <if test="ggxh!=null and ggxh!=''">
            and sbys.ggxh ILIKE '%' ||#{ggxh}||'%'
        </if>
        <if test="sbccbh!=null and sbccbh!=''">
            and sbys.sbccbh ILIKE '%' ||#{sbccbh}||'%'
        </if>
        <if test="xlh!=null and xlh!=''">
            and sbys.xlh ILIKE '%' ||#{xlh}||'%'
        </if>
        <if test="glrymc!=null and glrymc!=''">
            and glry.zsxm ILIKE '%' ||#{glrymc}||'%'
        </if>
        <if test="sydd!=null and sydd!=''">
            and sbys.sydd ILIKE '%' ||#{sydd}||'%'
        </if>
        <if test="sccj!=null and sccj!=''">
            and sbys.sccj ILIKE '%' ||#{sccj}||'%'
        </if>
        <if test="sccjlxfs!=null and sccjlxfs!=''">
            and sbys.sccjlxfs ILIKE '%' ||#{sccjlxfs}||'%'
        </if>
        <if test="sbbmfzrmc!=null and sbbmfzrmc!=''">
            and sbbmfzr.zsxm ILIKE '%' ||#{sbbmfzrmc}||'%'
        </if>
        <if test="ysrmc!=null and ysrmc!=''">
            and ysr.zsxm ILIKE '%' ||#{ysrmc}||'%'
        </if>
        <if test="djh!=null and djh!=''">
            and qggl.djh ILIKE '%' ||#{djh}||'%'
        </if>
        <if test = "sblxs != null and sblxs.length > 0 "  >
            and sbys.sblx in
            <foreach collection="sblxs" separator="," open="(" close=") " item="item" index="index">
                #{item}
            </foreach>
        </if>
        <if test = "sfjls != null and sfjls.length > 0 "  >
            and sbys.sfjl in
            <foreach collection="sfjls" separator="," open="(" close=") " item="item" index="index">
                #{item}
            </foreach>
        </if>
        <if test="jlzqstart != null and jlzqstart != ''">
            and sbys.jlzq &gt;= cast (#{jlzqstart} as numeric )
        </if>
        <if test="jlzqend != null and jlzqend != ''">
            and sbys.jlzq &lt;= cast (#{jlzqend} as numeric )
        </if>
        <if test="jlrqstart != null and jlrqstart != ''">
            and to_char(sbys.jlrq,'YYYY-MM-dd') &gt;= #{jlrqstart}
        </if>
        <if test="jlrqend != null and jlrqend != ''">
            and to_char(sbys.jlrq,'YYYY-MM-dd') &lt;= #{jlrqend}
        </if>
        <if test="xcjlsjstart != null and xcjlsjstart != ''">
            and to_char(sbys.xcjlsj,'YYYY-MM-dd') &gt;= #{xcjlsjstart}
        </if>
        <if test="xcjlsjend != null and xcjlsjend != ''">
            and to_char(sbys.xcjlsj,'YYYY-MM-dd') &lt;= #{xcjlsjend}
        </if>
        <if test = "sfyzs != null and sfyzs.length > 0 "  >
            and sbys.sfyz in
            <foreach collection="sfyzs" separator="," open="(" close=") " item="item" index="index">
                #{item}
            </foreach>
        </if>
        <if test="yzzqstart != null and yzzqstart != ''">
            and sbys.yzzq &gt;= cast (#{yzzqstart} as numeric )
        </if>
        <if test="yzzqend != null and yzzqend != ''">
            and sbys.yzzq &lt;= cast (#{yzzqend} as numeric )
        </if>
        <if test="yzrqstart != null and yzrqstart != ''">
            and to_char(sbys.yzrq,'YYYY-MM-dd') &gt;= #{yzrqstart}
        </if>
        <if test="yzrqend != null and yzrqend != ''">
            and to_char(sbys.yzrq,'YYYY-MM-dd') &lt;= #{yzrqend}
        </if>
        <if test="xcyzsjstart != null and xcyzsjstart != ''">
            and to_char(sbys.xcyzsj,'YYYY-MM-dd') &gt;= #{xcyzsjstart}
        </if>
        <if test="xcyzsjend != null and xcyzsjend != ''">
            and to_char(sbys.xcyzsj,'YYYY-MM-dd') &lt;= #{xcyzsjend}
        </if>
        <if test="byzqstart != null and byzqstart != ''">
            and sbys.byzq &gt;= cast (#{byzqstart} as numeric )
        </if>
        <if test="byzqend != null and byzqend != ''">
            and sbys.byzq &lt;= cast (#{byzqend} as numeric )
        </if>
        <if test="byrqstart != null and byrqstart != ''">
            and to_char(sbys.byrq,'YYYY-MM-dd') &gt;= #{byrqstart}
        </if>
        <if test="byrqend != null and byrqend != ''">
            and to_char(sbys.byrq,'YYYY-MM-dd') &lt;= #{byrqend}
        </if>
        <if test="xcbysjstart != null and xcbysjstart != ''">
            and to_char(sbys.xcbysj,'YYYY-MM-dd') &gt;= #{xcbysjstart}
        </if>
        <if test="xcbysjend != null and xcbysjend != ''">
            and to_char(sbys.xcbysj,'YYYY-MM-dd') &lt;= #{xcbysjend}
        </if>
        <if test="qyrqstart != null and qyrqstart != ''">
            and to_char(sbys.qyrq,'YYYY-MM-dd') &gt;= #{qyrqstart}
        </if>
        <if test="qyrqend != null and qyrqend != ''">
            and to_char(sbys.qyrq,'YYYY-MM-dd') &lt;= #{qyrqend}
        </if>
        <if test = "sybms != null and sybms.length > 0 "  >
            and sbys.xsybm in
            <foreach collection="sybms" separator="," open="(" close=") " item="item" index="index">
                #{item}
            </foreach>
        </if>
        <if test = "sbzts != null and sbzts.length > 0 "  >
            and sbys.sbzt in
            <foreach collection="sbzts" separator="," open="(" close=") " item="item" index="index">
                #{item}
            </foreach>
        </if>
        <if test = "zts != null and zts.length > 0 "  >
            and sbys.shzt in
            <foreach collection="zts" separator="," open="(" close=") " item="item" index="index">
                #{item}
            </foreach>
        </if>
        <if test = "sbcss != null and sbcss.length > 0 "  >
            and sbys.sbcs in
            <foreach collection="sbcss" separator="," open="(" close=") " item="item" index="index">
                #{item}
            </foreach>
        </if>
        <if test = "yqgnyzs != null and yqgnyzs.length > 0 "  >
            and sbys.yqgnyz in
            <foreach collection="yqgnyzs" separator="," open="(" close=") " item="item" index="index">
                #{item}
            </foreach>
        </if>
        <if test = "sjcss != null and sjcss.length > 0 "  >
            and sbys.sjcs in
            <foreach collection="sjcss" separator="," open="(" close=") " item="item" index="index">
                #{item}
            </foreach>
        </if>
        <if test = "sjccs != null and sjccs.length > 0 "  >
            and sbys.sjcc in
            <foreach collection="sjccs" separator="," open="(" close=") " item="item" index="index">
                #{item}
            </foreach>
        </if>
        <if test = "sjwzxhbmxs != null and sjwzxhbmxs.length > 0 "  >
            and sbys.sjwzxhbmx in
            <foreach collection="sjwzxhbmxs" separator="," open="(" close=") " item="item" index="index">
                #{item}
            </foreach>
        </if>
        <if test = "sjclhjss != null and sjclhjss.length > 0 "  >
            and sbys.sjclhjs in
            <foreach collection="sjclhjss" separator="," open="(" close=") " item="item" index="index">
                #{item}
            </foreach>
        </if>
        <if test = "zxdnrs != null and zxdnrs.length > 0 "  >
            and sbys.zxdnr in
            <foreach collection="zxdnrs" separator="," open="(" close=") " item="item" index="index">
                #{item}
            </foreach>
        </if>
        <if test = "ysjls != null and ysjls.length > 0 "  >
            and sbys.ysjl in
            <foreach collection="ysjls" separator="," open="(" close=") " item="item" index="index">
                #{item}
            </foreach>
        </if>
        <if test="dsrwFlag !=null and dsrwFlag!='' and dsrwFlag=='sbjl'.toString()">
            and cast((select date_part('day', current_timestamp - to_char(sbys.xcjlsj,'yyyy-mm-dd hh24:mi:ss')::timestamp)) as numeric )&lt;=14
            and sbys.sbzt='01'
        </if>
        <if test="dsrwFlag !=null and dsrwFlag!='' and dsrwFlag=='sbyz'.toString()">
            and cast((select date_part('day', current_timestamp - to_char(sbys.xcyzsj,'yyyy-mm-dd hh24:mi:ss')::timestamp)) as numeric )&lt;=14
            and sbys.sbzt='01'
        </if>
        <if test="dsrwFlag !=null and dsrwFlag!='' and dsrwFlag=='sbwx'.toString()">
            and cast((select date_part('day', current_timestamp - to_char(sbys.xcbysj,'yyyy-mm-dd hh24:mi:ss')::timestamp)) as numeric )&lt;=14
            and sbys.sbzt='01'
        </if>
        <if test="dsrwGlry!=null and dsrwGlry!=''">
            and sbys.glry=#{dsrwGlry}
        </if>
        <if test="dsrwFzr!=null and dsrwFzr!=''">
            and sbys.bmsbfzr=#{dsrwFzr}
        </if>
        <if test = "pdzts != null and pdzts.length > 0 "  >
            and (sbys.pdzt in
            <foreach collection="pdzts" separator="," open="(" close=") " item="item" index="index">
                #{item}
            </foreach>
            <if test="pdzt!=null and pdzt!='' and pdzt=='0'.toString()">
                or sbys.pdzt is null
            </if>
            )
        </if>
    </sql>
    <select id="getPagedDtoList" resultType="SbysDto" parameterType="SbysDto">
        select sbys.sbysid,hwxx.hwid,sbys.gdzcbh,hwxx.dhsl,sbys.sbccbh,sbys.sydd,sbys.ysjg,sbys.ysrq,sbys.zt,sbys.bxsj,
        wlgl.wlbm,wlgl.wlmc,wlgl.scs,htgl.htnbbh,htgl.gys,gys.gysmc,gys.dh,qggl.sqr,qggl.sqbm,qggl.djh,qggl.ssyfxm,qggl.qgid,xtyh.zsxm sqrmc,jgxx.jgmc sqbmmc,jcsj.csmc ssyfxmmc,
        dhxx.dhrq,sbys.sbysdh,sbys.sfgz,htmx.sfgdzc,hwxx.scph,wlgl.wlid
        ,sbys.ysbbh,sbys.ygdzcbh,sbys.pkzt,sbys.glry,sbys.xsybm,sbys.ysr,sbys.ysdd,sbys.bz,sbys.bzqk,sbys.wgqk,sbys.jyqk,sbys.zxdnr
        ,sbys.sbcs,sbys.yqgnyz,sbys.sjcs,sbys.sjcc,sbys.sjwzxhbmx,sbys.sjclhjs,sbys.xnyz,sbys.ysjl,sbys.tzzt,sbys.byzq,sbys.xcbysj
        ,sbys.jlzq,sbys.xcjlsj,sbys.yzzq,sbys.xcyzsj,sbys.sfjl,sbys.sfyz,sbys.bmsbfzr,sbys.qwfs,sbys.qyrq,sbys.xlh,sbys.gzsj,sbys.dzwz,sbys.glry,ysr.zsxm ysrmc,glry.zsxm glrymc,sbys.sblx,sblx.csmc sblxmc
        from igams_hwxx hwxx
        left join igams_sbys sbys on hwxx.sbysid=sbys.sbysid and sbys.scbj='0'
        left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj='0'
        left join matridx_jcsj zllb on zllb.csid=wlgl.lb and zllb.scbj='0'
        left join igams_htmx htmx on htmx.htmxid=hwxx.htmxid and htmx.scbj='0'
        left join igams_htgl htgl on htgl.htid=htmx.htid and htgl.scbj='0'
        left join igams_gysxx gys on gys.gysid=htgl.gys and gys.scbj!='1'
        left join igams_qgmx qgmx on qgmx.qgmxid=hwxx.qgmxid and qgmx.scbj='0'
        left join igams_qggl qggl on qggl.qgid=qgmx.qgid and qggl.scbj='0'
        left join matridx_xtyh xtyh on xtyh.yhid=qggl.sqr and xtyh.scbj='0'
        left join matridx_xtyh ysr on ysr.yhid=sbys.ysr and ysr.scbj='0'
        left join matridx_xtyh glry on glry.yhid=sbys.glry and glry.scbj='0'
        left join matridx_jgxx jgxx on jgxx.jgid=qggl.sqbm
        left join matridx_jcsj jcsj on jcsj.csid=qggl.ssyfxm and jcsj.scbj='0'
        left join matridx_jcsj sblx on sblx.csid=sbys.sblx and sblx.scbj='0'
        left join igams_dhxx dhxx on dhxx.dhid=hwxx.dhid and dhxx.scbj='0' and dhxx.zt='80'
        <where>
            hwxx.scbj='0' and hwxx.lbcskz='3'
            <include refid="selectWhere"></include>
            <if test="wlbm != null and wlbm != ''">
                and wlgl.wlbm ILIKE '%'|| #{wlbm} ||'%'
            </if>
            <if test="wlmc != null and wlmc != ''">
                and wlgl.wlmc  ILIKE '%'|| #{wlmc} ||'%'
            </if>
            <if test="sqrmc != null and sqrmc != ''">
                and xtyh.zsxm ILIKE '%'|| #{sqrmc} ||'%'
            </if>
            <if test="sqbmmc != null and sqbmmc != ''">
                and jgxx.jgmc ILIKE '%'|| #{sqbmmc} ||'%'
            </if>
            <if test="htnbbh != null and htnbbh != ''">
                and htgl.htnbbh ILIKE '%'|| #{htnbbh} ||'%'
            </if>
            <if test="djh != null and djh != ''">
                and qggl.djh  ILIKE '%'|| #{djh} ||'%'
            </if>
            <if test="gdzcbh != null and gdzcbh != ''">
                and sbys.gdzcbh  ILIKE '%'|| #{gdzcbh} ||'%'
            </if>
            <if test="sbccbh != null and sbccbh != ''">
                and sbys.sbccbh  ILIKE '%'|| #{sbccbh} ||'%'
            </if>
            <if test="sydd != null and sydd != ''">
                and sbys.sydd  ILIKE '%'|| #{sydd} ||'%'
            </if>
            <if test="scs != null and scs != ''">
                and wlgl.scs  ILIKE '%'|| #{scs} ||'%'
            </if>
            <if test="gysmc != null and gysmc != ''">
                and gys.gysmc ILIKE '%'|| #{gysmc} ||'%'
            </if>
            <if test="dhdh != null and dhdh != ''">
                and dhxx.dhdh ILIKE '%'|| #{dhdh} ||'%'
            </if>
            <if test = "zts != null and zts.length > 0 "  >
                and sbys.zt in
                <foreach collection="zts" separator="," open="(" close=") "
                         item="item" index="index">
                    #{item}
                </foreach>
            </if>
            <if test = "ssyfxms != null and ssyfxms.length > 0 "  >
                and qggl.ssyfxm in
                <foreach collection="ssyfxms" separator="," open="(" close=") "
                         item="item" index="index">
                    #{item}
                </foreach>
            </if>
            <if test = "ysjgs != null and ysjgs.length > 0 "  >
                and sbys.ysjg in
                <foreach collection="ysjgs" separator="," open="(" close=") "
                         item="item" index="index">
                    #{item}
                </foreach>
            </if>
            <if test="dhrqstart != null and dhrqstart != ''">
                and to_char(dhxx.dhrq,'yyyy-mm-dd hh24:mi:ss') &gt;= #{dhrqstart}
            </if>
            <if test="dhrqend != null and dhrqend != ''">
                and to_char(dhxx.dhrq,'yyyy-mm-dd hh24:mi:ss') &lt;= #{dhrqend}
            </if>
            <if test="ysrqstart != null and ysrqstart != ''">
                and to_char(sbys.ysrq,'yyyy-mm-dd hh24:mi:ss') &gt;= #{ysrqstart}
            </if>
            <if test="ysrqend != null and ysrqend != ''">
                and to_char(sbys.ysrq,'yyyy-mm-dd hh24:mi:ss') &lt;= #{ysrqend}
            </if>
        </where>
    </select>


    <select id="getDtoById" resultType="SbysDto" parameterType="String">
         select sbys.sbysid,hwxx.hwid,sbys.gdzcbh,sbys.yssl,sbys.sbccbh,sbys.sydd,sbys.ysjg,sbys.ysrq,sbys.zt,sbys.bxsj,
        wlgl.wlbm,wlgl.wlmc,wlgl.scs,wlgl.gg as ggxh,htgl.htnbbh,htgl.gys,gys.gysmc,gys.dh,qggl.sqr,qggl.sqbm,qggl.djh,qggl.ssyfxm,xtyh.zsxm sqrmc,jgxx.jgmc sqbmmc,jcsj.csmc ssyfxmmc,
        dhxx.dhrq,sbys.sbysdh,yh.zsxm lrry,sbys.sfgz,htmx.sfgdzc,wlgl.wlid
        ,sbys.ysbbh,sbys.ygdzcbh,sbys.pkzt,sbys.glry,sbys.xsybm,sbys.ysr,sbys.ysdd,sbys.bz,sbys.bzqk,sbys.wgqk,sbys.jyqk,sbys.zxdnr
        ,sbys.sbcs,sbys.yqgnyz,sbys.sjcs,sbys.sjcc,sbys.sjwzxhbmx,sbys.sjclhjs,sbys.xnyz,sbys.ysjl,sbys.tzzt,sbys.byzq,sbys.xcbysj
        ,sbys.jlzq,sbys.xcjlsj,sbys.yzzq,sbys.xcyzsj,sbys.sfjl,sbys.sfyz,sbys.bmsbfzr,sbys.qwfs,sbys.qyrq,sbys.xlh,sbys.gzsj,sbys.dzwz,sbys.glry,ysr.zsxm ysrmc,glry.zsxm glrymc,sbys.sblx,sblx.csmc sblxmc
        ,sbys.sbbh,sbys.ccrq,xsyr.zsxm xsyrmc,sbys.xsyr
        from igams_hwxx hwxx
        left join igams_sbys sbys on hwxx.sbysid=sbys.sbysid and sbys.scbj='0'
        left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj='0'
        left join matridx_jcsj zllb on zllb.csid=wlgl.lb and zllb.scbj='0'
        left join igams_htmx htmx on htmx.htmxid=hwxx.htmxid and htmx.scbj='0'
        left join igams_htgl htgl on htgl.htid=htmx.htid and htgl.scbj='0'
        left join igams_gysxx gys on gys.gysid=htgl.gys and gys.scbj!='1'
        left join igams_qgmx qgmx on qgmx.qgmxid=hwxx.qgmxid and qgmx.scbj='0'
        left join igams_qggl qggl on qggl.qgid=qgmx.qgid and qggl.scbj='0'
        left join matridx_xtyh xtyh on xtyh.yhid=sbys.lrry and xtyh.scbj='0'
        left join matridx_xtyh xsyr on xsyr.yhid=sbys.xsyr and xsyr.scbj='0'
        left join matridx_xtyh yh on yh.yhid=qggl.sqr and xtyh.scbj='0'
        left join matridx_xtyh ysr on ysr.yhid=sbys.ysr and ysr.scbj='0'
        left join matridx_xtyh glry on glry.yhid=sbys.glry and glry.scbj='0'
        left join matridx_jcsj sblx on sblx.csid=sbys.sblx and sblx.scbj='0'
        left join matridx_jgxx jgxx on jgxx.jgid=qggl.sqbm
        left join matridx_jcsj jcsj on jcsj.csid=qggl.ssyfxm and jcsj.scbj='0'
        left join igams_dhxx dhxx on dhxx.dhid=hwxx.dhid and dhxx.scbj='0' and dhxx.zt='80'
        <where>
            hwxx.scbj='0' and hwxx.hwid=#{hwid}
        </where>
    </select>


    <select id="getDto" resultType="SbysDto" parameterType="SbysDto">
        select sbys.sbysid,hwxx.hwid,sbys.gdzcbh,sbys.yssl,sbys.sbccbh,sbys.sydd,sbys.ysjg,sbys.ysrq,sbys.zt,sbys.bxsj,
        wlgl.wlbm,wlgl.wlmc,wlgl.scs,wlgl.gg,htgl.htnbbh,sbys.gys,gys.gysmc,gys.dh,qggl.sqr,qggl.sqbm,qggl.djh,qggl.ssyfxm,xtyh.zsxm sqrmc,jgxx.jgmc sqbmmc,jcsj.csmc ssyfxmmc,
        dhxx.dhrq,sbys.sbysdh,sbys.sfgz,htmx.sfgdzc
        ,sbys.ysbbh,sbys.ygdzcbh,sbys.pkzt,sbys.glry,sbys.xsybm,sbys.ysr,sbys.ysdd,sbys.bz,sbys.bzqk,sbys.wgqk,sbys.jyqk,sbys.zxdnr
        ,sbys.sbcs,sbys.yqgnyz,sbys.sjcs,sbys.sjcc,sbys.sjwzxhbmx,sbys.sjclhjs,sbys.xnyz,sbys.ysjl,sbys.tzzt,sbys.byzq,sbys.xcbysj
        ,sbys.jlzq,sbys.xcjlsj,sbys.yzzq,sbys.xcyzsj,sbys.sfjl,sbys.sfyz,sbys.bmsbfzr,sbys.qwfs,sbys.qyrq,sbys.xlh,sbys.gzsj,sbys.dzwz,sbys.glry,ysr.zsxm ysrmc,glry.zsxm glrymc,sbys.sblx,sblx.csmc sblxmc
        ,sbys.sbbh,sbys.ccrq,sbys.sbmc,sbys.ggxh,sbys.sccj,sbys.sccjlxfs,sbys.sbzt,sbys.xsybm,xsybm.jgmc xsybmmc,sbbmfzr.zsxm sbbmfzrmc,xsyr.zsxm xsyrmc,sbys.xsyr

        from igams_sbys sbys
        left join igams_hwxx hwxx on hwxx.sbysid=sbys.sbysid and hwxx.scbj='0' AND hwxx.lrsj = (
        SELECT MAX(lrsj)
        FROM igams_hwxx
        WHERE scbj ='0' and sbysid = sbys.sbysid
        )
        left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj='0'
        left join matridx_jcsj zllb on zllb.csid=wlgl.lb and zllb.scbj='0'
        left join igams_htmx htmx on htmx.htmxid=hwxx.htmxid and htmx.scbj='0'
        left join igams_htgl htgl on htgl.htid=htmx.htid and htgl.scbj='0'
        left join igams_gysxx gys on gys.gysid=sbys.gys and gys.scbj!='1'
        left join igams_qgmx qgmx on qgmx.qgmxid=hwxx.qgmxid and qgmx.scbj='0'
        left join igams_qggl qggl on qggl.qgid=qgmx.qgid and qggl.scbj='0'
        left join matridx_xtyh xsyr on xsyr.yhid=sbys.xsyr and xsyr.scbj='0'
        left join matridx_xtyh xtyh on xtyh.yhid=qggl.sqr and xtyh.scbj='0'
        left join matridx_xtyh ysr on ysr.yhid=sbys.ysr and ysr.scbj='0'
        left join matridx_xtyh glry on glry.yhid=sbys.glry and glry.scbj='0'
        left join matridx_jcsj sblx on sblx.csid=sbys.sblx and sblx.scbj='0'
        left join matridx_jgxx jgxx on jgxx.jgid=qggl.sqbm
        left join matridx_jcsj jcsj on jcsj.csid=qggl.ssyfxm and jcsj.scbj='0'
        left join igams_dhxx dhxx on dhxx.dhid=hwxx.dhid and dhxx.scbj='0' and dhxx.zt='80'
        LEFT JOIN matridx_jgxx xsybm ON xsybm.jgid = sbys.xsybm
        left join matridx_xtyh sbbmfzr on sbbmfzr.yhid=sbys.bmsbfzr and sbbmfzr.scbj='0'
        <where>
            sbys.scbj='0' and sbys.sbysid=#{sbysid}
        </where>
    </select>


    <insert id="insert" parameterType="SbysDto">
        insert into igams_sbys(sbysid,hwid
        <if test="sbysdh != null and sbysdh != ''">
            ,sbysdh
        </if>
        <if test="gdzcbh != null and gdzcbh != ''">
            ,gdzcbh
        </if>
        <if test="yssl != null and yssl != ''">
            ,yssl
        </if>
        <if test="sbccbh != null and sbccbh != ''">
            ,sbccbh
        </if>
        <if test="sydd != null and sydd != ''">
            ,sydd
        </if>
        <if test="ysjg != null and ysjg != ''">
            ,ysjg
        </if>
        <if test="ysrq != null and ysrq != ''">
            ,ysrq
        </if>
        <if test="bxsj != null and bxsj != ''">
            ,bxsj
        </if>
        <if test="zt != null and zt != ''">
            ,zt
        </if>
        <if test="sfgz != null and sfgz != ''">
            ,sfgz
        </if>
        <if test="gys != null and gys != ''">
            ,gys
        </if>
        <if test="sblx != null and sblx != ''">
            ,sblx
        </if>
        <if test="sccj != null and sccj != ''">
            ,sccj
        </if>
        <if test="je != null and je != ''">
            ,je
        </if>
        <if test="dzwz != null and dzwz != ''">
            ,dzwz
        </if>
        <if test="xlh != null and xlh != ''">
            ,xlh
        </if>
        <if test="qgmxid != null and qgmxid != ''">
            ,qgmxid
        </if>
        <if test="glry != null and glry != ''">
            ,glry
        </if>
        <if test="ggxh != null and ggxh != ''">
            ,ggxh
        </if>
        <if test="sbmc != null and sbmc != ''">
            ,sbmc
        </if>
        <if test="gzsj != null and gzsj != ''">
            ,gzsj
        </if>
        <if test="xsybm != null and xsybm != ''">
            ,xsybm
        </if>
        <if test="sbzt != null and sbzt != ''">
            ,sbzt
        </if>
        <if test="ysbbh != null and ysbbh != ''">
        ,ysbbh
        </if>
        <if test="ygdzcbh != null and ygdzcbh != ''">
        ,ygdzcbh
        </if>
        <if test="pkzt != null and pkzt != ''">
        ,pkzt
        </if>

        <if test="sbbh != null and sbbh != ''">
        ,sbbh
        </if>
        <if test="ysr != null and ysr != ''">
        ,ysr
        </if>
        <if test="ysdd != null and ysdd != ''">
        ,ysdd
        </if>
        <if test="bz != null and bz != ''">
        ,bz
        </if>
        <if test="bzqk != null and bzqk != ''">
        ,bzqk
        </if>
        <if test="wgqk != null and wgqk != ''">
        ,wgqk
        </if>
        <if test="jyqk != null and jyqk != ''">
        ,jyqk
        </if>
        <if test="zxdnr != null and zxdnr != ''">
        ,zxdnr
        </if>
        <if test="sbcs != null and sbcs != ''">
        ,sbcs
        </if>
        <if test="yqgnyz != null and yqgnyz != ''">
        ,yqgnyz
        </if>
        <if test="sjcs != null and sjcs != ''">
        ,sjcs
        </if>
        <if test="sjcc != null and sjcc != ''">
        ,sjcc
        </if>
        <if test="sjwzxhbmx != null and sjwzxhbmx != ''">
        ,sjwzxhbmx
        </if>
        <if test="sjclhjs != null and sjclhjs != ''">
        ,sjclhjs
        </if>
        <if test="xnyz != null and xnyz != ''">
        ,xnyz
        </if>
        <if test="ysjl != null and ysjl != ''">
        ,ysjl
        </if>
        <if test="tzzt != null and tzzt != ''">
        ,tzzt
        </if>
        <if test="byzq != null and byzq != ''">
        ,byzq
        </if>
        <if test="xcbysj != null and xcbysj != ''">
        ,xcbysj
        </if>
        <if test="jlzq != null and jlzq != ''">
        ,jlzq
        </if>
        <if test="xcjlsj != null and xcjlsj != ''">
        ,xcjlsj
        </if>
        <if test="yzzq != null and yzzq != ''">
        ,yzzq
        </if>
        <if test="xcyzsj != null and xcyzsj != ''">
        ,xcyzsj
        </if>
        <if test="sfjl != null and sfjl != ''">
        ,sfjl
        </if>
        <if test="sfyz != null and sfyz != ''">
        ,sfyz
        </if>
        <if test="bmsbfzr != null and bmsbfzr != ''">
        ,bmsbfzr
        </if>
        <if test="qwfs != null and qwfs != ''">
        ,qwfs
        </if>
        <if test="qyrq != null and qyrq != ''">
        ,qyrq
        </if>
        <if test="shzt != null and shzt != ''">
        ,shzt
        </if>
        <if test="lsid != null and lsid != ''">
        ,lsid
        </if>
        <if test="xzllmxid != null and xzllmxid != ''">
        ,xzllmxid
        </if>
        <if test="ccrq != null and ccrq != ''">
            ,ccrq
        </if>
        <if test="jlbh != null and jlbh != ''">
            ,jlbh
        </if>
        <if test="xzllid!=null and xzllid !=''">
            ,xzllid
        </if>
        <if test="sccjlxfs!=null and sccjlxfs !=''">
            ,sccjlxfs
        </if>
        <if test="xsyr!=null and xsyr !=''">
            ,xsyr
        </if>
        ,lrry,lrsj,scbj)
        values(#{sbysid},#{hwid}
        <if test="sbysdh != null and sbysdh != ''">
            ,#{sbysdh}
        </if>
        <if test="gdzcbh != null and gdzcbh != ''">
            ,#{gdzcbh}
        </if>
        <if test="yssl != null and yssl != ''">
            ,cast(#{yssl} as numeric)
        </if>
        <if test="sbccbh != null and sbccbh != ''">
            ,#{sbccbh}
        </if>
        <if test="sydd != null and sydd != ''">
            ,#{sydd}
        </if>
        <if test="ysjg != null and ysjg != ''">
            ,#{ysjg}
        </if>
        <if test="ysrq != null and ysrq != ''">
            ,cast (#{ysrq} as date )
        </if>
        <if test="bxsj != null and bxsj != ''">
            ,#{bxsj}
        </if>
        <if test="zt != null and zt != ''">
            ,#{zt}
        </if>
        <if test="sfgz != null and sfgz != ''">
            ,#{sfgz}
        </if>
        <if test="gys != null and gys != ''">
            ,#{gys}
        </if>
        <if test="sblx != null and sblx != ''">
            ,#{sblx}
        </if>
        <if test="sccj != null and sccj != ''">
            ,#{sccj}
        </if>
        <if test="je != null and je != ''">
            ,cast (#{je} as numeric)
        </if>
        <if test="dzwz != null and dzwz != ''">
            ,#{dzwz}
        </if>
        <if test="xlh != null and xlh != ''">
            ,#{xlh}
        </if>
        <if test="qgmxid != null and qgmxid != ''">
            ,#{qgmxid}
        </if>
        <if test="glry != null and glry != ''">
            ,#{glry}
        </if>
        <if test="ggxh != null and ggxh != ''">
            ,#{ggxh}
        </if>
        <if test="sbmc != null and sbmc != ''">
            ,#{sbmc}
        </if>
        <if test="gzsj != null and gzsj != ''">
            ,cast (#{gzsj} as date )
        </if>
        <if test="xsybm != null and xsybm != ''">
            ,#{xsybm}
        </if>
        <if test="sbzt != null and sbzt != ''">
            ,#{sbzt}
        </if>
        <if test="ysbbh != null and ysbbh != ''">
            ,#{ysbbh}
        </if>
        <if test="ygdzcbh != null and ygdzcbh != ''">
            ,#{ygdzcbh}
        </if>
        <if test="pkzt != null and pkzt != ''">
            ,#{pkzt}
        </if>
        <if test="sbbh != null and sbbh != ''">
            ,#{sbbh}
        </if>
        <if test="ysr != null and ysr != ''">
            ,#{ysr}
        </if>
        <if test="ysdd != null and ysdd != ''">
            ,#{ysdd}
        </if>
        <if test="bz != null and bz != ''">
            ,#{bz}
        </if>
        <if test="bzqk != null and bzqk != ''">
            ,#{bzqk}
        </if>
        <if test="wgqk != null and wgqk != ''">
            ,#{wgqk}
        </if>
        <if test="jyqk != null and jyqk != ''">
            ,#{jyqk}
        </if>
        <if test="zxdnr != null and zxdnr != ''">
            ,#{zxdnr}
        </if>
        <if test="sbcs != null and sbcs != ''">
            ,#{sbcs}
        </if>
        <if test="yqgnyz != null and yqgnyz != ''">
            ,#{yqgnyz}
        </if>
        <if test="sjcs != null and sjcs != ''">
            ,#{sjcs}
        </if>
        <if test="sjcc != null and sjcc != ''">
            ,#{sjcc}
        </if>
        <if test="sjwzxhbmx != null and sjwzxhbmx != ''">
            ,#{sjwzxhbmx}
        </if>
        <if test="sjclhjs != null and sjclhjs != ''">
            ,#{sjclhjs}
        </if>
        <if test="xnyz != null and xnyz != ''">
            ,#{xnyz}
        </if>
        <if test="ysjl != null and ysjl != ''">
            ,#{ysjl}
        </if>
        <if test="tzzt != null and tzzt != ''">
            ,#{tzzt}
        </if>
        <if test="byzq != null and byzq != ''">
            ,cast(#{byzq} as numeric)
        </if>
        <if test="xcbysj != null and xcbysj != ''">
            ,cast(#{xcbysj} as date)
        </if>
        <if test="jlzq != null and jlzq != ''">
            ,cast(#{jlzq} as numeric)
        </if>
        <if test="xcjlsj != null and xcjlsj != ''">
            ,cast(#{xcjlsj} as date)
        </if>
        <if test="yzzq != null and yzzq != ''">
            ,cast(#{yzzq} as numeric)
        </if>
        <if test="xcyzsj != null and xcyzsj != ''">
            ,cast(#{xcyzsj} as date)
        </if>
        <if test="sfjl != null and sfjl != ''">
            ,#{sfjl}
        </if>
        <if test="sfyz != null and sfyz != ''">
            ,#{sfyz}
        </if>
        <if test="bmsbfzr != null and bmsbfzr != ''">
            ,#{bmsbfzr}
        </if>
        <if test="qwfs != null and qwfs != ''">
            ,#{qwfs}
        </if>
        <if test="qyrq != null and qyrq != ''">
            ,cast(#{qyrq} as date)
        </if>
        <if test="shzt != null and shzt != ''">
            ,#{shzt}
        </if>
        <if test="lsid != null and lsid != ''">
            ,#{lsid}
        </if>
        <if test="xzllmxid != null and xzllmxid != ''">
            ,#{xzllmxid}
        </if>
        <if test="ccrq != null and ccrq != ''">
            ,cast (#{ccrq} as date )
        </if>
        <if test="jlbh != null and jlbh != ''">
            ,#{jlbh}
        </if>
        <if test="xzllid != null and xzllid != ''">
            ,#{xzllid}
        </if>
        <if test="sccjlxfs != null and sccjlxfs != ''">
            ,#{sccjlxfs}
        </if>
        <if test="xsyr != null and xsyr != ''">
            ,#{xsyr}
        </if>
        ,#{lrry},LOCALTIMESTAMP,'0')
    </insert>

    <update id="updatePageEvent" parameterType="SbysDto">
        update igams_sbys
        <set>
            xgry=#{xgry}
            ,xgsj=LOCALTIMESTAMP
            <if test="sbysdh != null and sbysdh != ''">
                ,sbysdh=#{sbysdh}
            </if>
            <if test="gdzcbh != null and gdzcbh != ''">
                ,gdzcbh=#{gdzcbh}
            </if>
            <if test="yssl != null and yssl != ''">
                ,yssl=cast(#{yssl} as numeric)
            </if>
            <if test="sbccbh != null and sbccbh != ''">
                ,sbccbh=#{sbccbh}
            </if>
            <if test="sydd != null and sydd != ''">
                ,sydd=#{sydd}
            </if>
            <if test="ysjg != null and ysjg != ''">
                ,ysjg=#{ysjg}
            </if>
            <if test="ysrq != null and ysrq != ''">
                ,ysrq=cast (#{ysrq} as date )
            </if>
            <if test="bxsj != null and bxsj != ''">
                ,bxsj=#{bxsj}
            </if>
            <if test="bxsj == null or bxsj == ''">
                ,bxsj=null
            </if>
            <if test="zt != null and zt != ''">
                ,zt=#{zt}
            </if>
            <if test="sfgz != null and sfgz != ''">
                ,sfgz=#{sfgz}
            </if>
            <if test="gys != null and gys != ''">
                ,gys=#{gys}
            </if>
            <if test="sblx != null and sblx != ''">
                ,sblx=#{sblx}
            </if>
            <if test="sccj != null and sccj != ''">
                ,sccj=#{sccj}
            </if>
            <if test="je != null and je != ''">
                ,je=cast (#{je} as numeric)
            </if>
            <if test="dzwz != null and dzwz != ''">
                ,dzwz=#{dzwz}
            </if>
            <if test="xlh != null and xlh != ''">
                ,xlh=#{xlh}
            </if>
            <if test="qgmxid != null and qgmxid != ''">
                ,qgmxid=#{qgmxid}
            </if>
            <if test="glry != null and glry != ''">
                ,glry=#{glry}
            </if>
            <if test="glry == null or glry == ''">
                ,glry=null
            </if>
            <if test="ggxh != null and ggxh != ''">
                ,ggxh=#{ggxh}
            </if>
            <if test="sbmc != null and sbmc != ''">
                ,sbmc=#{sbmc}
            </if>
            <if test="gzsj != null and gzsj != ''">
                ,gzsj=cast (#{gzsj} as date )
            </if>
            <if test="xsyr != null and xsyr != ''">
                ,xsyr=#{xsyr}
            </if>
            <if test="ysbbh != null and ysbbh != ''">
                ,ysbbh=#{ysbbh}
            </if>
            <if test="ygdzcbh != null and ygdzcbh != ''">
                ,ygdzcbh=#{ygdzcbh}
            </if>
            <if test="sbzt != null and sbzt != ''">
                ,sbzt=#{sbzt}
            </if>
            <if test="lysj != null and lysj != ''">
                ,lysj=cast (#{lysj} as timestamp )
            </if>
            <if test="xsybm != null and xsybm != ''">
                ,xsybm=#{xsybm}
            </if>
            <if test="pkzt != null and pkzt != ''">
                ,pkzt=#{pkzt}
            </if>
            <if test="pkzt != null and pkzt != ''">
                ,pkzt = #{pkzt}
            </if>
            <if test="ysr != null and ysr != ''">
                ,ysr=#{ysr}
            </if>
            <if test="ysr == null or ysr == ''">
                ,ysr=null
            </if>
            <if test="ysdd != null and ysdd != ''">
                ,ysdd=#{ysdd}
            </if>
            <if test="ysdd == null or ysdd == ''">
                ,ysdd=null
            </if>
            <if test="bz != null and bz != ''">
                ,bz=#{bz}
            </if>
            <if test="bz == null or bz == ''">
                ,bz=null
            </if>
            <if test="bzqk != null and bzqk != ''">
                ,bzqk=#{bzqk}
            </if>
            <if test="bzqk == null or bzqk == ''">
                ,bzqk=null
            </if>
            <if test="wgqk != null and wgqk != ''">
                ,wgqk=#{wgqk}
            </if>
            <if test="wgqk == null or wgqk == ''">
                ,wgqk=null
            </if>
            <if test="jyqk != null and jyqk != ''">
                ,jyqk=#{jyqk}
            </if>
            <if test="jyqk == null or jyqk == ''">
                ,jyqk=null
            </if>
            <if test="zxdnr != null and zxdnr != ''">
                ,zxdnr=#{zxdnr}
            </if>
            <if test="sbcs != null and sbcs != ''">
                ,sbcs=#{sbcs}
            </if>
            <if test="yqgnyz != null and yqgnyz != ''">
                ,yqgnyz=#{yqgnyz}
            </if>
            <if test="sjcs != null and sjcs != ''">
                ,sjcs=#{sjcs}
            </if>
            <if test="sjcc != null and sjcc != ''">
                ,sjcc=#{sjcc}
            </if>
            <if test="sjwzxhbmx != null and sjwzxhbmx != ''">
                ,sjwzxhbmx=#{sjwzxhbmx}
            </if>
            <if test="sjclhjs != null and sjclhjs != ''">
                ,sjclhjs=#{sjclhjs}
            </if>
            <if test="xnyz != null and xnyz != ''">
                ,xnyz=#{xnyz}
            </if>
            <if test="ysjl != null and ysjl != ''">
                ,ysjl=#{ysjl}
            </if>
            <if test="tzzt != null and tzzt != ''">
                ,tzzt=#{tzzt}
            </if>
            <if test="byzq != null and byzq != ''">
                ,byzq=cast(#{byzq} as numeric)
            </if>
            <if test="byzq == null or byzq == ''">
                ,byzq=null
            </if>
            <if test="xcbysj != null and xcbysj != ''">
                ,xcbysj=cast(#{xcbysj} as date)
            </if>
            <if test="xcbysj == null or xcbysj == ''">
                ,xcbysj=null
            </if>
            <if test="jlzq != null and jlzq != ''">
                ,jlzq=cast(#{jlzq} as numeric)
            </if>
            <if test="jlzq == null or jlzq == ''">
                ,jlzq=null
            </if>
            <if test="xcjlsj != null and xcjlsj != ''">
                ,xcjlsj=cast(#{xcjlsj} as date)
            </if>
            <if test="xcjlsj == null or xcjlsj == ''">
                ,xcjlsj=null
            </if>
            <if test="yzzq != null and yzzq != ''">
                ,yzzq=cast(#{yzzq} as numeric)
            </if>
            <if test="yzzq == null or yzzq == ''">
                ,yzzq= null
            </if>
            <if test="xcyzsj != null and xcyzsj != ''">
                ,xcyzsj=cast(#{xcyzsj} as date)
            </if>
            <if test="xcyzsj == null or xcyzsj == ''">
                ,xcyzsj=null
            </if>
            <if test="sfjl != null and sfjl != ''">
                ,sfjl=#{sfjl}
            </if>
            <if test="sfyz != null and sfyz != ''">
                ,sfyz=#{sfyz}
            </if>
            <if test="bmsbfzr != null and bmsbfzr != ''">
                ,bmsbfzr=#{bmsbfzr}
            </if>
            <if test="qwfs != null and qwfs != ''">
                ,qwfs=#{qwfs}
            </if>
            <if test="qwfs == null or qwfs == ''">
                ,qwfs=null
            </if>
            <if test="qyrq != null and qyrq != ''">
                ,qyrq=cast(#{qyrq} as date)
            </if>
            <if test="qyrq == null or qyrq == ''">
                ,qyrq=null
            </if>
            <if test="shzt != null and shzt != ''">
                ,shzt=#{shzt}
            </if>
            <if test="sbbh != null and sbbh != ''">
                ,sbbh=#{sbbh}
            </if>
            <if test="sbbh == null or sbbh == ''">
                ,sbbh=null
            </if>
            <if test="ccrq != null and ccrq != ''">
                ,ccrq=cast(#{ccrq} as date)
            </if>
            <if test="ccrq == null or ccrq == ''">
                ,ccrq=null
            </if>
            <if test="sccjlxfs != null and sccjlxfs != ''">
                ,sccjlxfs=#{sccjlxfs}
            </if>
            <if test="sccjlxfs == null or sccjlxfs == ''">
                ,sccjlxfs=null
            </if>
        </set>
        <where>
            sbysid=#{sbysid}
        </where>
    </update>
    <update id="update" parameterType="SbysDto">
        update igams_sbys
        <set>
            xgry=#{xgry}
            ,xgsj=LOCALTIMESTAMP
            <if test="sbysdh != null and sbysdh != ''">
                ,sbysdh=#{sbysdh}
            </if>
            <if test="gdzcbh != null and gdzcbh != ''">
                ,gdzcbh=#{gdzcbh}
            </if>
            <if test="yssl != null and yssl != ''">
                ,yssl=cast(#{yssl} as numeric)
            </if>
            <if test="sbccbh != null and sbccbh != ''">
                ,sbccbh=#{sbccbh}
            </if>
            <if test="sydd != null and sydd != ''">
                ,sydd=#{sydd}
            </if>
            <if test="ysjg != null and ysjg != ''">
                ,ysjg=#{ysjg}
            </if>
            <if test="ysrq != null and ysrq != ''">
                ,ysrq=cast (#{ysrq} as date )
            </if>
            <if test="bxsj != null and bxsj != ''">
                ,bxsj=#{bxsj}
            </if>
            <if test="zt != null and zt != ''">
                ,zt=#{zt}
            </if>
            <if test="sfgz != null and sfgz != ''">
                ,sfgz=#{sfgz}
            </if>
            <if test="gys != null and gys != ''">
                ,gys=#{gys}
            </if>
            <if test="sblx != null and sblx != ''">
                ,sblx=#{sblx}
            </if>
            <if test="sccj != null and sccj != ''">
                ,sccj=#{sccj}
            </if>
            <if test="je != null and je != ''">
                ,je=cast (#{je} as numeric)
            </if>
            <if test="dzwz != null and dzwz != ''">
                ,dzwz=#{dzwz}
            </if>
            <if test="xlh != null and xlh != ''">
                ,xlh=#{xlh}
            </if>
            <if test="qgmxid != null and qgmxid != ''">
                ,qgmxid=#{qgmxid}
            </if>
            <if test="glry != null and glry != ''">
                ,glry=#{glry}
            </if>
            <if test="ggxh != null and ggxh != ''">
                ,ggxh=#{ggxh}
            </if>
            <if test="sbmc != null and sbmc != ''">
                ,sbmc=#{sbmc}
            </if>
            <if test="gzsj != null and gzsj != ''">
                ,gzsj=cast (#{gzsj} as date )
            </if>
            <if test="xsyr != null and xsyr != ''">
                ,xsyr=#{xsyr}
            </if>
            <if test="ygdzcbh != null and ygdzcbh != ''">
                ,ygdzcbh=#{ygdzcbh}
            </if>
            <if test="sbzt != null and sbzt != ''">
                ,sbzt=#{sbzt}
            </if>
            <if test="lysj != null and lysj != ''">
                ,lysj=cast (#{lysj} as timestamp )
            </if>
            <if test="xsybm != null and xsybm != ''">
                ,xsybm=#{xsybm}
            </if>
            <if test="pkzt != null and pkzt != ''">
                ,pkzt=#{pkzt}
            </if>
            <if test="ysbbh != null and ysbbh != ''">
                ,ysbbh= #{ysbbh}
            </if>
            <if test="sbbh != null and sbbh != ''">
                ,sbbh=#{sbbh}
            </if>
            <if test="ysr != null and ysr != ''">
                ,ysr=#{ysr}
            </if>
            <if test="ysdd != null and ysdd != ''">
                ,ysdd=#{ysdd}
            </if>
            <if test="bz != null and bz != ''">
                ,bz=#{bz}
            </if>
            <if test="bzqk != null and bzqk != ''">
                ,bzqk=#{bzqk}
            </if>
            <if test="wgqk != null and wgqk != ''">
                ,wgqk=#{wgqk}
            </if>
            <if test="jyqk != null and jyqk != ''">
                ,jyqk=#{jyqk}
            </if>
            <if test="zxdnr != null and zxdnr != ''">
                ,zxdnr=#{zxdnr}
            </if>
            <if test="sbcs != null and sbcs != ''">
                ,sbcs=#{sbcs}
            </if>
            <if test="yqgnyz != null and yqgnyz != ''">
                ,yqgnyz=#{yqgnyz}
            </if>
            <if test="sjcs != null and sjcs != ''">
                ,sjcs=#{sjcs}
            </if>
            <if test="sjcc != null and sjcc != ''">
                ,sjcc=#{sjcc}
            </if>
            <if test="sjwzxhbmx != null and sjwzxhbmx != ''">
                ,sjwzxhbmx=#{sjwzxhbmx}
            </if>
            <if test="sjclhjs != null and sjclhjs != ''">
                ,sjclhjs=#{sjclhjs}
            </if>
            <if test="xnyz != null and xnyz != ''">
                ,xnyz=#{xnyz}
            </if>
            <if test="ysjl != null and ysjl != ''">
                ,ysjl=#{ysjl}
            </if>
            <if test="tzzt != null and tzzt != ''">
                ,tzzt=#{tzzt}
            </if>
            <if test="byzq != null and byzq != ''">
                ,byzq=cast(#{byzq} as numeric)
            </if>
            <if test="xcbysj != null and xcbysj != ''">
                ,xcbysj=cast(#{xcbysj} as date)
            </if>
            <if test="jlzq != null and jlzq != ''">
                ,jlzq=cast(#{jlzq} as numeric)
            </if>
            <if test="xcjlsj != null and xcjlsj != ''">
                ,xcjlsj=cast(#{xcjlsj} as date)
            </if>
            <if test="yzzq != null and yzzq != ''">
                ,yzzq=cast(#{yzzq} as numeric)
            </if>
            <if test="xcyzsj != null and xcyzsj != ''">
                ,xcyzsj=cast(#{xcyzsj} as date)
            </if>
            <if test="sfjl != null and sfjl != ''">
                ,sfjl=#{sfjl}
            </if>
            <if test="sfyz != null and sfyz != ''">
                ,sfyz=#{sfyz}
            </if>
            <if test="bmsbfzr != null and bmsbfzr != ''">
                <if test="bmsbfzr=='1'.toString()">
                    ,bmsbfzr=null
                </if>
                <if test="bmsbfzr!='1'.toString()">
                    ,bmsbfzr=#{bmsbfzr}
                </if>
            </if>
            <if test="qwfs != null and qwfs != ''">
                ,qwfs=#{qwfs}
            </if>
            <if test="qyrq != null and qyrq != ''">
                ,qyrq=cast(#{qyrq} as date)
            </if>
            <if test="byrq != null and byrq != ''">
                ,byrq=cast(#{byrq} as date)
            </if>
            <if test="shzt != null and shzt != ''">
                ,shzt=#{shzt}
            </if>
            <if test="lsid != null and lsid != ''">
                ,lsid=#{lsid}
            </if>
            <if test="xzllmxid != null and xzllmxid != ''">
                ,xzllmxid=#{xzllmxid}
            </if>
            <if test="czflag!=null and czflag!='' and czflag=='1'.toString()">
                ,sydd=null
                ,xsyr=null
                ,xsybm=null
            </if>
            <if test="ysbzt != null and ysbzt != ''">
                ,ysbzt=#{ysbzt}
            </if>
        </set>
        <where>
        <if test="sbysid !=null and sbysid!=''">
            sbysid=#{sbysid}
        </if>
        <if test="xzllid !=null and xzllid!=''">
            xzllid=#{xzllid}
        </if>
        <if test="ids!=null and ids.size>0">
            sbysid in
            <foreach collection="ids" separator="," open="(" close=")" item="item" index="index">
                #{item}
            </foreach>
        </if>
        </where>
    </update>

    <update id="discard" parameterType="SbysDto">
        update igams_sbys
        <set>
            scbj='2',xgry=#{scry},xgsj=LOCALTIMESTAMP
        </set>
        <where>
            sbysid in
            <foreach collection="ids" separator="," open="(" close=")" item="item" index="index">
                #{item}
            </foreach>
        </where>
    </update>

    <update id="delete" parameterType="SbysDto">
        update igams_sbys
        <set>
            scbj='1',scry=#{scry},scsj=LOCALTIMESTAMP
        </set>
        <where>
            sbysid in
            <foreach collection="ids" separator="," open="(" close=")" item="item" index="index">
                #{item}
            </foreach>
        </where>
    </update>
    <update id="updateSbzts" parameterType="SbysDto">
        update igams_sbys
        <set>
            sbzt=#{sbzt}
            <if test="shzt != null and shzt != ''">
                ,shzt=#{shzt}
            </if>
            <if test="sydd != null and sydd != ''">
                ,sydd=#{sydd}
            </if>,xgry=#{xgry},xgsj=LOCALTIMESTAMP
        </set>
        <where>
            sbysid in
            <foreach collection="ids" separator="," open="(" close=")" item="item" index="index">
                #{item}
            </foreach>
        </where>
    </update>

    <update id="updateTzs" parameterType="List">
        update igams_sbys sbys
        set
        tzzt=tmp.tzzt
        ,sbzt=case when (tmp.sbzt is not null and tmp.sbzt != '') then tmp.sbzt else sbys.sbzt end
        ,ysbzt=case when (tmp.ysbzt is not null and tmp.ysbzt != '') then tmp.ysbzt else sbys.ysbzt end
        ,xsybm=case when (tmp.xsybm is not null and tmp.xsybm != '') then tmp.xsybm else sbys.xsybm end
        ,bmsbfzr=case when (tmp.bmsbfzr is not null and tmp.bmsbfzr != '') then tmp.bmsbfzr else sbys.bmsbfzr end
        ,xgry=tmp.xgry,xgsj=LOCALTIMESTAMP
        from(
        <foreach collection="list" separator="union"  item="item" index="index">
            select #{item.tzzt} tzzt,#{item.sbzt} sbzt,#{item.ysbzt} ysbzt,#{item.xsybm} xsybm,#{item.bmsbfzr} bmsbfzr,#{item.xgry} xgry,#{item.sbysid} sbysid
        </foreach>
        )tmp
        where
        sbys.sbysid=tmp.sbysid
    </update>

    <update id="updateTzsWithNull" parameterType="List">
        update igams_sbys sbys
        set
        tzzt=case when (coalesce(tmp.counthw,0)&gt;1 or tmp.tkbj ='1') then '1' else '0' end
        ,bmsbfzr=case when coalesce(tmp.counthw,0)&gt;1 then bmsbfzr else null end
        ,xcbysj=case when coalesce(tmp.counthw,0)&gt;1 then xcbysj else null end
        ,byzq=case when coalesce(tmp.counthw,0)&gt;1 then byzq else null end
        ,sbzt=ysbzt
        ,xsybm=case when coalesce(tmp.counthw,0)&gt;1 then xsybm else null end
        ,xgry=tmp.xgry,xgsj=LOCALTIMESTAMP
        from(
        <foreach collection="list" separator="union"  item="item" index="index">
            select #{item.tkbj} tkbj,#{item.xgry} xgry,#{item.sbysid} sbysid,(select count(hwid)  from igams_hwxx where scbj='0' and sbysid = #{item.sbysid}) counthw
        </foreach>
        )tmp
        where
        sbys.sbysid=tmp.sbysid
    </update>
    <select id="getPagedAuditDevice" parameterType="SbysDto" resultType="SbysDto">
        select sbys.sbysid,hwxx.hwid,sbys.gdzcbh,sbys.yssl,sbys.sbccbh,sbys.sydd,sbys.ysjg,sbys.ysrq,sbys.zt,sbys.bxsj,
        wlgl.wlbm,wlgl.wlmc,wlgl.scs,htgl.htnbbh,htgl.gys,gys.gysmc,gys.dh,qggl.sqr,qggl.sqbm,qggl.djh,qggl.ssyfxm,xtyh.zsxm sqrmc,jgxx.jgmc sqbmmc,jcsj.csmc ssyfxmmc,
        dhxx.dhrq,sbys.sbysdh,sbys.shzt,sbys.sfgz
        from igams_sbys sbys
        left join igams_hwxx hwxx on hwxx.sbysid=sbys.sbysid and hwxx.scbj='0' AND hwxx.lrsj = (
        SELECT MAX(lrsj)
        FROM igams_hwxx
        WHERE scbj ='0' and sbysid = sbys.sbysid
        )
        left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj='0'
        left join matridx_jcsj zllb on zllb.csid=wlgl.lb and zllb.scbj='0'
        left join igams_htmx htmx on htmx.htmxid=hwxx.htmxid and htmx.scbj='0'
        left join igams_htgl htgl on htgl.htid=htmx.htid and htgl.scbj='0'
        left join igams_gysxx gys on gys.gysid=htgl.gys and gys.scbj!='1'
        left join igams_qgmx qgmx on qgmx.qgmxid=hwxx.qgmxid and qgmx.scbj='0'
        left join igams_qggl qggl on qggl.qgid=qgmx.qgid and qggl.scbj='0'
        left join matridx_xtyh xtyh on xtyh.yhid=qggl.sqr and xtyh.scbj='0'
        left join matridx_jgxx jgxx on jgxx.jgid=qggl.sqbm
        left join matridx_jcsj jcsj on jcsj.csid=qggl.ssyfxm and jcsj.scbj='0'
        left join igams_dhxx dhxx on dhxx.dhid=hwxx.dhid and dhxx.scbj='0' and dhxx.zt='80'
        <where>
            sbys.scbj='0'
            <if test="wlbm != null and wlbm != ''">
                and wlgl.wlbm ILIKE '%'|| #{wlbm} ||'%'
            </if>
            <if test="wlmc != null and wlmc != ''">
                and wlgl.wlmc  ILIKE '%'|| #{wlmc} ||'%'
            </if>
            <if test="sqrmc != null and sqrmc != ''">
                and xtyh.zsxm ILIKE '%'|| #{sqrmc} ||'%'
            </if>
            <if test="sqbmmc != null and sqbmmc != ''">
                and jgxx.jgmc ILIKE '%'|| #{sqbmmc} ||'%'
            </if>
            <if test="htnbbh != null and htnbbh != ''">
                and htgl.htnbbh ILIKE '%'|| #{htnbbh} ||'%'
            </if>
            <if test="djh != null and djh != ''">
                and qggl.djh  ILIKE '%'|| #{djh} ||'%'
            </if>
            <if test="gdzcbh != null and gdzcbh != ''">
                and sbys.gdzcbh  ILIKE '%'|| #{gdzcbh} ||'%'
            </if>
            <if test="sbccbh != null and sbccbh != ''">
                and sbys.sbccbh  ILIKE '%'|| #{sbccbh} ||'%'
            </if>
            <if test="sydd != null and sydd != ''">
                and sbys.sydd  ILIKE '%'|| #{sydd} ||'%'
            </if>
            <if test="scs != null and scs != ''">
                and wlgl.scs  ILIKE '%'|| #{scs} ||'%'
            </if>
            <if test="gysmc != null and gysmc != ''">
                and gys.gysmc ILIKE '%'|| #{gysmc} ||'%'
            </if>
        </where>
    </select>
    <!-- 审核列表-->
    <select id="getAuditListDevice" parameterType="List" resultType="SbysDto">
        select sbys.sbysid,hwxx.hwid,sbys.gdzcbh,sbys.yssl,sbys.sbccbh,sbys.sydd,sbys.ysjg,sbys.ysrq,sbys.zt,sbys.bxsj,
        wlgl.wlbm,wlgl.wlmc,wlgl.scs,htgl.htnbbh,htgl.gys,gys.gysmc,gys.dh,qggl.sqr,qggl.sqbm,qggl.djh,qggl.ssyfxm,xtyh.zsxm sqrmc,jgxx.jgmc sqbmmc,jcsj.csmc ssyfxmmc,
        dhxx.dhrq,shxx_sqsj,shxx_gwmc,shxx_lrryxm,shxx_shsj,shxx_sftg,shxx_shxxid,shxx_shyj,sbys.sbysdh,sbys.sfgz
        from
        <foreach collection="list" separator="union" open="(" close=") "
                 item="item" index="index">
            select #{item.sbysid} sbysid,#{item.shxx_shxxid} shxx_shxxid,#{item.shxx_sqsj} shxx_sqsj,#{item.sqr} sqr,
            #{item.shxx_lrryxm} shxx_lrryxm,#{item.shxx_shsj} shxx_shsj,
            #{item.shxx_sftg} shxx_sftg,#{item.shxx_shyj} shxx_shyj,#{item.shxx_gwmc} shxx_gwmc,#{index} rownum
        </foreach>
        tmp
        left join igams_sbys sbys on sbys.sbysid = tmp.sbysid
        left join igams_hwxx hwxx on hwxx.sbysid=sbys.sbysid and hwxx.scbj='0' AND hwxx.lrsj = (
        SELECT MAX(lrsj)
        FROM igams_hwxx
        WHERE scbj ='0' and sbysid = sbys.sbysid
        )
        left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj='0'
        left join matridx_jcsj zllb on zllb.csid=wlgl.lb and zllb.scbj='0'
        left join igams_htmx htmx on htmx.htmxid=hwxx.htmxid and htmx.scbj='0'
        left join igams_htgl htgl on htgl.htid=htmx.htid and htgl.scbj='0'
        left join igams_gysxx gys on gys.gysid=htgl.gys and gys.scbj!='1'
        left join igams_qgmx qgmx on qgmx.qgmxid=hwxx.qgmxid and qgmx.scbj='0'
        left join igams_qggl qggl on qggl.qgid=qgmx.qgid and qggl.scbj='0'
        left join matridx_xtyh xtyh on xtyh.yhid=qggl.sqr and xtyh.scbj='0'
        left join matridx_jgxx jgxx on jgxx.jgid=qggl.sqbm
        left join matridx_jcsj jcsj on jcsj.csid=qggl.ssyfxm and jcsj.scbj='0'
        left join igams_dhxx dhxx on dhxx.dhid=hwxx.dhid and dhxx.scbj='0'   and dhxx.zt='80'
        order by tmp.rownum
    </select>

    <select id="getDtoList" parameterType="SbysDto" resultType="SbysDto">
        select sbys.sbysid,hwxx.hwid,sbys.gdzcbh,sbys.yssl,sbys.sbccbh,sbys.sydd,sbys.ysjg,sbys.ysrq,sbys.zt,sbys.bxsj,
        wlgl.wlbm,wlgl.wlmc,wlgl.scs,htgl.htnbbh,htgl.gys,gys.gysmc,gys.dh,qggl.sqr,qggl.sqbm,qggl.djh,qggl.ssyfxm,xtyh.zsxm sqrmc,jgxx.jgmc sqbmmc,jcsj.csmc ssyfxmmc,
        dhxx.dhrq,rkgl.zt rkzt,sbys.sbysdh,sbys.sfgz,sbys.sbzt,sbys.ysbzt
        from igams_sbys sbys
        left join igams_hwxx hwxx on hwxx.sbysid=sbys.sbysid and hwxx.scbj='0' AND hwxx.lrsj = (
        SELECT MAX(lrsj)
        FROM igams_hwxx
        WHERE scbj ='0' and sbysid = sbys.sbysid
        )
        left join igams_rkgl rkgl on hwxx.rkid=rkgl.rkid and rkgl.scbj='0'
        left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj='0'
        left join matridx_jcsj zllb on zllb.csid=wlgl.lb and zllb.scbj='0'
        left join igams_htmx htmx on htmx.htmxid=hwxx.htmxid and htmx.scbj='0'
        left join igams_htgl htgl on htgl.htid=htmx.htid and htgl.scbj='0'
        left join igams_gysxx gys on gys.gysid=htgl.gys and gys.scbj!='1'
        left join igams_qgmx qgmx on qgmx.qgmxid=hwxx.qgmxid and qgmx.scbj='0'
        left join igams_qggl qggl on qggl.qgid=qgmx.qgid and qggl.scbj='0'
        left join matridx_xtyh xtyh on xtyh.yhid=qggl.sqr and xtyh.scbj='0'
        left join matridx_jgxx jgxx on jgxx.jgid=qggl.sqbm
        left join matridx_jcsj jcsj on jcsj.csid=qggl.ssyfxm and jcsj.scbj='0'
        left join igams_dhxx dhxx on dhxx.dhid=hwxx.dhid and dhxx.scbj='0' and dhxx.zt='80'
        <where>
            sbys.scbj='0'
            <if test="ids != null and ids.size > 0">
                and sbys.sbysid in
                <foreach collection="ids" separator="," open="(" close=")" item="item" index="index">
                    #{item}
                </foreach>
            </if>
        </where>
    </select>

    <select id="getSbysdh" parameterType="String" resultType="String">
        SELECT lpad(cast((CAST(coalesce(MAX(substring(sbysdh,13)),'0') AS numeric) + 1) as VARCHAR), 3, '0') sbysdh
        FROM igams_sbys
        <where>
            scbj = '0' AND sbysdh like #{sbysdh}||'%'
        </where>
    </select>
    <select id="getDtoByGdzcbh" parameterType="SbysDto" resultType="String">
        SELECT
        sbys.gdzcbh
        FROM
        igams_sbys sbys
        LEFT JOIN igams_hwxx hwxx on hwxx.sbysid = sbys.sbysid AND hwxx.scbj ='0' AND hwxx.lrsj = (
        SELECT MAX(lrsj)
        FROM igams_hwxx
        WHERE scbj ='0' and sbysid = sbys.sbysid
        )
        WHERE
        (sbys.gdzcbh = #{gdzcbh} or sbys.sbbh = #{sbbh}) and sbys.gdzcbh!='' and sbys.gdzcbh is not null and sbys.sbbh!='' and sbys.sbbh is not null
        AND sbys.scbj = '0' AND sbys.tzzt='1'
        <if test="sbysid != null and sbysid != ''">
            AND sbys.sbysid !=#{sbysid}
        </if>
    </select>
    <select id="getPagedEquipmentList" parameterType="SbysDto" resultType="SbysDto">
        SELECT
        sbys.sbysid,
        sbys.gdzcbh,
        sbys.sbmc,
        sbys.ggxh,
        sbys.xlh,
        sbys.gys,
        gys.gysmc gysmc,
        sbys.sccj,
        sbys.sydd,
        sbys.xsyr,
        xsyr.zsxm xsyrmc,
        sbys.xsybm,
        xsybm.jgmc xsybmmc,
        to_char( sbys.lysj, 'yyyy-mm-dd hh24:mi:ss' ) lysj,
        sbys.sbzt,
        sbys.pkzt,
        sbys.sbysdh,
        hwxx.qgmxid,
        sbys.lrry,
        lrry.zsxm lrrymc,
        to_char( sbys.lrsj, 'yyyy-mm-dd hh24:mi:ss' ) lrsj,
        sbys.ysbbh,
        sblx.csmc sblxmc,
        sbys.ygdzcbh,
        sbys.gzsj,
        glry.zsxm glrymc,
        sbys.dzwz,
        sbys.sbccbh,
        xtyh.zsxm xgry,
        to_char( sbys.xgsj, 'yyyy-mm-dd hh24:mi:ss' ) xgsj,
        sbys.sfjl,
        sbys.sfyz,
        sbys.xcbysj,
        sbys.xcjlsj,
        sbys.xcyzsj,
        sbys.zt,
        sbys.yzzq,
        sbys.qyrq,
        qggl.qgid,
        qggl.djh,
        sbys.bz,
        sbys.sccjlxfs,
        sbys.sbbh,
        sbys.lsid,
        sbbmfzr.zsxm sbbmfzrmc,
        sbys.shzt,
        sbys.sbysid _key,
        sbys.pdzt
        FROM
        igams_sbys sbys
        LEFT JOIN igams_gysxx gys ON gys.gysid = sbys.gys and gys.scbj!='1'
        LEFT JOIN matridx_xtyh xsyr ON xsyr.yhid = sbys.xsyr and xsyr.scbj='0'
        LEFT JOIN matridx_jgxx xsybm ON xsybm.jgid = sbys.xsybm
        LEFT JOIN matridx_xtyh lrry ON lrry.yhid = sbys.lrry and lrry.scbj='0'
        LEFT JOIN matridx_jcsj sblx ON sblx.csid = sbys.sblx and sblx.scbj='0'
        LEFT JOIN matridx_xtyh glry ON glry.yhid = sbys.glry and glry.scbj='0'
        LEFT JOIN matridx_xtyh xtyh ON xtyh.yhid = sbys.xgry and xtyh.scbj='0'
        left join matridx_xtyh sbbmfzr on sbbmfzr.yhid=sbys.bmsbfzr and sbbmfzr.scbj='0'
        left join matridx_xtyh ysr on ysr.yhid=sbys.ysr and ysr.scbj='0'
        left join igams_hwxx hwxx on hwxx.sbysid=sbys.sbysid and hwxx.scbj='0' AND hwxx.lrsj = (
        SELECT MAX(lrsj)
        FROM igams_hwxx
        WHERE scbj ='0' and sbysid = sbys.sbysid
        )
        left join igams_qgmx qgmx on qgmx.qgmxid=hwxx.qgmxid and qgmx.scbj='0'
        left join igams_qggl qggl on qggl.qgid=qgmx.qgid
        left join igams_htmx htmx on htmx.htmxid=hwxx.htmxid and htmx.scbj='0'
        <where>
            sbys.zt='80'  and sbys.scbj='0'
        <include refid="selectWhere"></include>
        </where>
    </select>
    <select id="getDtoEquipmentList" parameterType="SbysDto" resultType="SbysDto">
        SELECT
        sbys.sbysid,
        sbys.gdzcbh,
        sbys.sbmc,
        sbys.ggxh,
        sbys.xlh,
        sbys.gys,
        gys.gysmc gysmc,
        sbys.sccj,
        sbys.sydd,
        sbys.xsyr,
        xsyr.zsxm xsyrmc,
        sbys.xsybm,
        xsybm.jgmc xsybmmc,
        to_char( sbys.lysj, 'yyyy-mm-dd hh24:mi:ss' ) lysj,
        sbys.sbzt,
        sbys.pkzt,
        sbys.sbysdh,
        hwxx.qgmxid,
        sbys.lrry,
        lrry.zsxm lrrymc,
        to_char( sbys.lrsj, 'yyyy-mm-dd hh24:mi:ss' ) lrsj,
        sbys.ysbbh,
        sblx.csmc sblxmc,
        sbys.ygdzcbh,
        sbys.gzsj,
        glry.zsxm glrymc,
        sbys.dzwz,
        sbys.sbccbh,
        xtyh.zsxm xgry,
        to_char( sbys.xgsj, 'yyyy-mm-dd hh24:mi:ss' ) xgsj,
        sbys.sfjl,
        sbys.sfyz,
        sbys.xcbysj,
        sbys.xcjlsj,
        sbys.xcyzsj,
        sbys.zt,
        sbys.yzzq,
        sbys.qyrq,
        qggl.qgid,
        qggl.djh,
        sbys.bz,
        sbys.sccjlxfs,
        sbys.sbbh,
        sbbmfzr.zsxm sbbmfzrmc
        FROM
        igams_sbys sbys
        LEFT JOIN igams_gysxx gys ON gys.gysid = sbys.gys and gys.scbj!='1'
        LEFT JOIN matridx_xtyh xsyr ON xsyr.yhid = sbys.xsyr and xsyr.scbj='0'
        LEFT JOIN matridx_jgxx xsybm ON xsybm.jgid = sbys.xsybm
        LEFT JOIN matridx_xtyh lrry ON lrry.yhid = sbys.lrry and lrry.scbj='0'
        LEFT JOIN matridx_jcsj sblx ON sblx.csid = sbys.sblx and sblx.scbj='0'
        LEFT JOIN matridx_xtyh glry ON glry.yhid = sbys.glry and glry.scbj='0'
        LEFT JOIN matridx_xtyh xtyh ON xtyh.yhid = sbys.xgry and xtyh.scbj='0'
        left join matridx_xtyh sbbmfzr on sbbmfzr.yhid=sbys.bmsbfzr and sbbmfzr.scbj='0'
        left join matridx_xtyh ysr on ysr.yhid=sbys.ysr and ysr.scbj='0'
        left join igams_hwxx hwxx on hwxx.sbysid=sbys.sbysid and hwxx.scbj='0' AND hwxx.lrsj = (
        SELECT MAX(lrsj)
        FROM igams_hwxx
        WHERE scbj ='0' and sbysid = sbys.sbysid
        )
        left join igams_qgmx qgmx on qgmx.qgmxid=hwxx.qgmxid and qgmx.scbj='0'
        left join igams_qggl qggl on qggl.qgid=qgmx.qgid
        left join igams_htmx htmx on htmx.htmxid=hwxx.htmxid and htmx.scbj='0'
        <where>
            sbys.scbj='0' and sbys.sbzt='1'
            <if test="xsyrbj!=null and xsyrbj!='' and xsyrbj=='0'.toString()">
                and sbys.xsyr!='' and sbys.xsyr is not null
            </if>
        </where>
    </select>
    <select id="getDepartmentList"  resultType="SbysDto">
        SELECT
        sbys.xsybm,
        xsybm.jgmc xsybmmc
        FROM
        igams_sbys sbys
        LEFT JOIN matridx_jgxx xsybm ON xsybm.jgid = sbys.xsybm
          <where>
            sbys.scbj='0' and sbys.xsybm is not null and xsybm.jgmc is not null
            group by sbys.xsybm,xsybm.jgmc
        </where>
    </select>
    <select id="getSbysDtoById"  parameterType="String" resultType="SbysDto">
        SELECT
        sbys.sbysid,
        sbys.gdzcbh,
        sbys.sbmc,
        sbys.ggxh,
        sbys.xlh,
        sbys.gys,
        gys.gysmc gysmc,
        sbys.sccj,
        sbys.sydd,
        sbys.xsyr,
        xsyr.zsxm xsyrmc,
        sbys.xsybm,
        xsybm.jgmc xsybmmc,
        to_char( sbys.lysj, 'yyyy-mm-dd' ) lysj,
        sbys.sbzt,sbys.ysbzt,
        sbys.pkzt,
        sbys.sbysdh,
        hwxx.qgmxid,
        sbys.lrry,
        lrry.zsxm lrrymc,
        to_char( sbys.lrsj, 'yyyy-mm-dd hh24:mi:ss' ) lrsj,
        sbys.ysbbh,
        sblx.csmc sblxmc,
        sbys.ygdzcbh,
        sbys.gzsj,
        glry.zsxm glrymc,
        sbys.dzwz,
        sbys.sbccbh,
        xtyh.zsxm xgry,
        to_char( sbys.xgsj, 'yyyy-mm-dd hh24:mi:ss' ) xgsj,
        sbys.sfjl,
        sbys.sfyz,
        sbys.xcbysj,
        sbys.xcjlsj,
        sbys.xcyzsj,
        sbys.zt,
        sbys.yzzq,
        sbys.qyrq,
        qggl.qgid,
        qggl.djh,
        sbys.bz,
        sbys.sccjlxfs,
        sbys.sbbh,
        sbys.glry,
        sbbmfzr.zsxm sbbmfzrmc,
        gys.dh,
        sbys.bxsj,
        sbys.ysrq,
        ysr.zsxm ysrmc,
        sbys.ysdd,
        case when sbys.sfgz='1' then '是' else '否' end sfgzmc,
        sbys.byzq,sbys.byrq,
        sbys.jlzq,
        sbys.jlrq,
        sbys.xcjlsj,
        sbys.yzrq,
        sbys.bzqk,
        sbys.wgqk,
        sbys.jyqk,
        sbys.zxdnr,
        sbys.sjcc,
        sbys.sjcs,
        sbys.sjwzxhbmx,
        sbys.sjclhjs,
        sbys.xnyz,
        sbys.ysjl,
        sbys.qwfs,
        sbys.yqgnyz,
        sbys.sbcs,sbys.shzt,
        sbys.jlbh,sbys.sblx,sbys.ccrq,sbys.sfgz,sbys.ysjg,sbys.ysr,sblx.cskz1 sblxcskz1,sbys.pdzt
        FROM
        igams_sbys sbys
        LEFT JOIN igams_gysxx gys ON gys.gysid = sbys.gys and gys.scbj!='1'
        LEFT JOIN matridx_xtyh xsyr ON xsyr.yhid = sbys.xsyr and xsyr.scbj='0'
        LEFT JOIN matridx_jgxx xsybm ON xsybm.jgid = sbys.xsybm
        LEFT JOIN matridx_xtyh lrry ON lrry.yhid = sbys.lrry and lrry.scbj='0'
        LEFT JOIN matridx_jcsj sblx ON sblx.csid = sbys.sblx and sblx.scbj='0'
        LEFT JOIN matridx_xtyh glry ON glry.yhid = sbys.glry and glry.scbj='0'
        LEFT JOIN matridx_xtyh xtyh ON xtyh.yhid = sbys.xgry and xtyh.scbj='0'
        left join igams_hwxx hwxx on hwxx.sbysid=sbys.sbysid and hwxx.scbj='0' AND hwxx.lrsj = (
        SELECT MAX(lrsj)
        FROM igams_hwxx
        WHERE scbj ='0' and sbysid = sbys.sbysid
        )
        left join igams_qgmx qgmx on qgmx.qgmxid=hwxx.qgmxid and qgmx.scbj='0'
        left join igams_qggl qggl on qggl.qgid=qgmx.qgid
        left join matridx_xtyh sbbmfzr on sbbmfzr.yhid=sbys.bmsbfzr and sbbmfzr.scbj='0'
        left join matridx_xtyh ysr on ysr.yhid=sbys.ysr and ysr.scbj='0'
        <where>
            sbys.sbysid=#{sbysid}
        </where>
    </select>
    <update id="updateList" parameterType="list">
        <if test="list !=null and list.size > 0">
            update igams_sbys sbys
            set shzt=tmp.shzt,
            lsid=tmp.lsid,
            sbzt=tmp.sbzt
            from(
            <foreach collection="list" separator="union" open="(" close=") " item="item" index="index">
                select #{item.shzt} shzt,#{item.lsid} lsid,#{item.sbysid} sbysid,#{item.sbzt} sbzt
            </foreach>
            )
            tmp
            where
            sbys.sbysid=tmp.sbysid
        </if>
    </update>
    <update id="updateListZt" parameterType="list">
        <if test="list !=null and list.size > 0">
            update igams_sbys sbys
            set shzt=tmp.shzt,
            sbzt=tmp.sbzt
            from(
            <foreach collection="list" separator="union" open="(" close=") " item="item" index="index">
                select #{item.shzt} shzt,#{item.sbysid} sbysid,#{item.sbzt} sbzt
            </foreach>
            )
            tmp
            where
            sbys.sbysid=tmp.sbysid
        </if>
    </update>
    <!-- 导出 -->
    <select id="getCountForSearchExp" parameterType="SbysDto"
            resultType="java.lang.Integer">
        select count(sbys.sbysid)
        FROM
        igams_sbys sbys
        LEFT JOIN igams_gysxx gys ON gys.gysid = sbys.gys and gys.scbj!='1'
        LEFT JOIN matridx_xtyh xsyr ON xsyr.yhid = sbys.xsyr and xsyr.scbj='0'
        LEFT JOIN matridx_jgxx xsybm ON xsybm.jgid = sbys.xsybm
        LEFT JOIN matridx_xtyh lrry ON lrry.yhid = sbys.lrry and lrry.scbj='0'
        LEFT JOIN matridx_jcsj sblx ON sblx.csid = sbys.sblx and sblx.scbj='0'
        LEFT JOIN matridx_xtyh glry ON glry.yhid = sbys.glry and glry.scbj='0'
        LEFT JOIN matridx_xtyh xtyh ON xtyh.yhid = sbys.xgry and xtyh.scbj='0'
        left join matridx_xtyh sbbmfzr on sbbmfzr.yhid=sbys.bmsbfzr and sbbmfzr.scbj='0'
        left join matridx_xtyh ysr on ysr.yhid=sbys.ysr and ysr.scbj='0'
        left join igams_hwxx hwxx on hwxx.sbysid=sbys.sbysid and hwxx.scbj='0' AND hwxx.lrsj = (
        SELECT MAX(lrsj)
        FROM igams_hwxx
        WHERE scbj ='0' and sbysid = sbys.sbysid
        )
        left join igams_qgmx qgmx on qgmx.qgmxid=hwxx.qgmxid and qgmx.scbj='0'
        left join igams_qggl qggl on qggl.qgid=qgmx.qgid
        left join igams_htmx htmx on htmx.htmxid=hwxx.htmxid and htmx.scbj='0'
        <where>
            sbys.zt='80'  and sbys.scbj='0'
            <include refid="selectWhere"></include>
        </where>
    </select>

    <select id="getListForSearchExp" parameterType="SbysDto" resultType="SbysDto">
        select sbys.sbysid ${sqlParam}
        FROM
        igams_sbys sbys
        LEFT JOIN igams_gysxx gys ON gys.gysid = sbys.gys and gys.scbj!='1'
        LEFT JOIN matridx_xtyh xsyr ON xsyr.yhid = sbys.xsyr and xsyr.scbj='0'
        LEFT JOIN matridx_jgxx xsybm ON xsybm.jgid = sbys.xsybm
        LEFT JOIN matridx_xtyh lrry ON lrry.yhid = sbys.lrry and lrry.scbj='0'
        LEFT JOIN matridx_jcsj sblx ON sblx.csid = sbys.sblx and sblx.scbj='0'
        LEFT JOIN matridx_xtyh glry ON glry.yhid = sbys.glry and glry.scbj='0'
        LEFT JOIN matridx_xtyh xtyh ON xtyh.yhid = sbys.xgry and xtyh.scbj='0'
        left join matridx_xtyh sbbmfzr on sbbmfzr.yhid=sbys.bmsbfzr and sbbmfzr.scbj='0'
        left join matridx_xtyh ysr on ysr.yhid=sbys.ysr and ysr.scbj='0'
        left join igams_hwxx hwxx on hwxx.sbysid=sbys.sbysid and hwxx.scbj='0' AND hwxx.lrsj = (
        SELECT MAX(lrsj)
        FROM igams_hwxx
        WHERE scbj ='0' and sbysid = sbys.sbysid
        )
        left join igams_qgmx qgmx on qgmx.qgmxid=hwxx.qgmxid and qgmx.scbj='0'
        left join igams_qggl qggl on qggl.qgid=qgmx.qgid
        left join igams_htmx htmx on htmx.htmxid=hwxx.htmxid and htmx.scbj='0'
        <where>
            sbys.zt='80'  and sbys.scbj='0'
            <include refid="selectWhere"></include>
        </where>
        order by
        <if test="sortName != null and sortName != ''">
            ${sortName} ${sortOrder}
        </if>
        <if test="sortLastName != null and sortLastName != ''">
            ,${sortLastName} ${sortLastOrder}
        </if>
        LIMIT #{pageSize} OFFSET #{pageStart}
    </select>

    <select id="getListForSelectExp" parameterType="SbysDto" resultType="SbysDto">
        select sbys.sbysid ${sqlParam} from (
        <foreach item="item" index="index" collection="ids"
                 separator=" union all ">
            select #{item,jdbcType=VARCHAR} sbysid,#{index} ordernum
        </foreach>
        ) tmp
        left join igams_sbys sbys on sbys.sbysid=tmp.sbysid
        LEFT JOIN igams_gysxx gys ON gys.gysid = sbys.gys and gys.scbj!='1'
        LEFT JOIN matridx_xtyh xsyr ON xsyr.yhid = sbys.xsyr and xsyr.scbj='0'
        LEFT JOIN matridx_jgxx xsybm ON xsybm.jgid = sbys.xsybm
        LEFT JOIN matridx_xtyh lrry ON lrry.yhid = sbys.lrry and lrry.scbj='0'
        LEFT JOIN matridx_jcsj sblx ON sblx.csid = sbys.sblx and sblx.scbj='0'
        LEFT JOIN matridx_xtyh glry ON glry.yhid = sbys.glry and glry.scbj='0'
        LEFT JOIN matridx_xtyh xtyh ON xtyh.yhid = sbys.xgry and xtyh.scbj='0'
        left join matridx_xtyh sbbmfzr on sbbmfzr.yhid=sbys.bmsbfzr and sbbmfzr.scbj='0'
        left join matridx_xtyh ysr on ysr.yhid=sbys.ysr and ysr.scbj='0'
        left join igams_hwxx hwxx on hwxx.sbysid=sbys.sbysid and hwxx.scbj='0' AND hwxx.lrsj = (
        SELECT MAX(lrsj)
        FROM igams_hwxx
        WHERE scbj ='0' and sbysid = sbys.sbysid
        )
        left join igams_qgmx qgmx on qgmx.qgmxid=hwxx.qgmxid and qgmx.scbj='0'
        left join igams_qggl qggl on qggl.qgid=qgmx.qgid
        left join igams_htmx htmx on htmx.htmxid=hwxx.htmxid and htmx.scbj='0'
        order by tmp.ordernum
    </select>
    <update id="scrapOrSold" parameterType="SbysDto">
        update  igams_sbys
        set
        <if test="lx!='' and lx!=null and lx=='scrap'.toString()">
            sbzt='2'
        </if>
        <if test="lx!='' and lx!=null and lx=='sold'.toString()">
            sbzt='3'
        </if>
        <if test="lx!='' and lx!=null and lx=='inactive'.toString()">
            sbzt='0',xsyr=null,xsybm=null
        </if>
        where sbysid in
        <if test="ids !=null and ids.size > 0">
            <foreach collection="ids" open="(" close=")" separator="," item="item">
                #{item}
            </foreach>
        </if>
    </update>
    <select id="getSbysSerial" parameterType="String" resultType="String">
        SELECT lpad(cast((CAST(coalesce(MAX(substring(jlbh,LENGTH(jlbh)-1,LENGTH(jlbh))),'0') AS numeric) + 1) as VARCHAR), 2, '0') serial
        FROM igams_sbys
        <where>
            scbj != '1' AND jlbh like #{prefix}||'%'
        </where>
    </select>
    <select id="getSbysDtoList" parameterType="SbysDto" resultType="SbysDto">
        SELECT
        sbys.sbysid,
        sbys.gdzcbh,
        sbys.sbmc,
        sbys.ggxh,
        sbys.xlh,
        sbys.gys,
        gys.gysmc gysmc,
        sbys.sccj,
        sbys.sydd,
        sbys.xsyr,
        xsyr.zsxm xsyrmc,
        sbys.xsybm,
        xsybm.jgmc xsybmmc,
        to_char( sbys.lysj, 'yyyy-mm-dd hh24:mi:ss' ) lysj,
        sbys.sbzt,
        sbys.pkzt,
        sbys.sbysdh,
        hwxx.qgmxid,
        sbys.lrry,
        lrry.zsxm lrrymc,
        to_char( sbys.lrsj, 'yyyy-mm-dd hh24:mi:ss' ) lrsj,
        sbys.ysbbh,
        sblx.csmc sblxmc,
        sbys.ygdzcbh,
        sbys.gzsj,
        glry.zsxm glrymc,
        sbys.dzwz,
        sbys.sbccbh,
        xtyh.zsxm xgry,
        to_char( sbys.xgsj, 'yyyy-mm-dd hh24:mi:ss' ) xgsj,
        sbys.sfjl,
        sbys.sfyz,
        sbys.xcbysj,
        sbys.xcyzsj,
        sbys.zt,
        sbys.yzzq,
        sbys.qyrq,
        qggl.qgid,
        qggl.djh,
        sbys.bz,
        sbys.sccjlxfs,
        sbys.sbbh,
        sbys.glry,
        sbbmfzr.zsxm sbbmfzrmc,
        gys.dh,
        sbys.bxsj,
        sbys.ysrq,
        ysr.zsxm ysrmc,
        sbys.ysdd,
        case when sbys.sfgz='1' then '是' else '否' end sfgz,
        sbys.byzq,sbys.byrq,
        sbys.jlzq,
        sbys.jlrq,
        sbys.xcjlsj,
        sbys.yzrq,
        sbys.bzqk,
        sbys.wgqk,
        sbys.jyqk,
        sbys.zxdnr,
        sbys.sjcc,
        sbys.sjcs,
        sbys.sjwzxhbmx,
        sbys.sjclhjs,
        sbys.xnyz,
        sbys.ysjl,
        sbys.qwfs,
        sbys.yqgnyz,
        sbys.sbcs,sbys.shzt,
        sbys.jlbh,wlgl.wlbm,wlgl.wlmc,hwxx.scph
        FROM
        igams_sbys sbys
        LEFT JOIN igams_gysxx gys ON gys.gysid = sbys.gys and gys.scbj!='1'
        LEFT JOIN matridx_xtyh xsyr ON xsyr.yhid = sbys.xsyr and xsyr.scbj='0'
        LEFT JOIN matridx_jgxx xsybm ON xsybm.jgid = sbys.xsybm
        LEFT JOIN matridx_xtyh lrry ON lrry.yhid = sbys.lrry and lrry.scbj='0'
        LEFT JOIN matridx_jcsj sblx ON sblx.csid = sbys.sblx and sblx.scbj='0'
        LEFT JOIN matridx_xtyh glry ON glry.yhid = sbys.glry and glry.scbj='0'
        LEFT JOIN matridx_xtyh xtyh ON xtyh.yhid = sbys.xgry and xtyh.scbj='0'
        left join matridx_xtyh sbbmfzr on sbbmfzr.yhid=sbys.bmsbfzr and sbbmfzr.scbj='0'
        left join matridx_xtyh ysr on ysr.yhid=sbys.ysr and ysr.scbj='0'
        left join igams_hwxx hwxx on hwxx.sbysid=sbys.sbysid and hwxx.scbj='0' AND hwxx.lrsj = (
        SELECT MAX(lrsj)
        FROM igams_hwxx
        WHERE scbj ='0' and sbysid = sbys.sbysid
        )
        left join igams_qgmx qgmx on qgmx.qgmxid=hwxx.qgmxid and qgmx.scbj='0'
        left join igams_qggl qggl on qggl.qgid=qgmx.qgid
        left join igams_wlgl wlgl on wlgl.wlid=hwxx.wlid and wlgl.scbj='0'
        <where>
            sbys.scbj='0'
            <if test="ids!=null and ids.size>0">
            and sbys.sbysid in
                <foreach collection="ids" open="(" close=")" separator="," item="item">
                    #{item}
                </foreach>
            </if>
            <if test="qgid!=null and qgid!=''">
                and qgmx.qgid =#{qgid}
            </if>
        </where>
    </select>
     <select id="getPagedDeviceInfoForJl" resultType="SbysDto" parameterType="SbysDto">
        SELECT
        sbjl.sbjlid,sbys.sbysid,sbys.sbmc,sbys.sbbh,sbys.ggxh,sbys.xlh,sqbm.jgmc sqbmmc,
        sbjl.jlrq,sbys.gdzcbh,sbys.sbccbh
        FROM
        igams_sbjl sbjl
        LEFT JOIN igams_sbys sbys ON sbys.sbysid = sbjl.sbysid
        AND sbys.scbj = '0'
        LEFT JOIN igams_hwxx hwxx ON hwxx.sbysid = sbys.sbysid
        AND hwxx.scbj = '0' AND hwxx.lrsj = (
         SELECT MAX(lrsj)
         FROM igams_hwxx
         WHERE scbj ='0' and sbysid = sbys.sbysid
         )
        LEFT JOIN matridx_jgxx sqbm ON sqbm.jgid = sbjl.sqbm
        <where>
            sbjl.scbj='0'
            <if test="entire != null and entire != ''">
                and (
                sbys.sbbh ILIKE '%' ||#{entire}||'%'
                or sbys.sbmc ILIKE '%' ||#{entire}||'%'
                or sbys.gdzcbh ILIKE '%' ||#{entire}||'%'
                or sbys.sbccbh ILIKE '%' ||#{entire}||'%'
                or sbys.xlh ILIKE '%' ||#{entire}||'%'
                )
            </if>
            <if test="sbbh!=null and sbbh!=''">
                and sbys.sbbh ILIKE '%' ||#{sbbh}||'%'
            </if>
            <if test="sbmc!=null and sbmc!=''">
                and sbys.sbmc ILIKE '%' ||#{sbmc}||'%'
            </if>
            <if test="gdzcbh!=null and gdzcbh!=''">
                and sbys.gdzcbh ILIKE '%' ||#{gdzcbh}||'%'
            </if>
            <if test="sbccbh!=null and sbccbh!=''">
                and sbys.sbccbh ILIKE '%' ||#{sbccbh}||'%'
            </if>
            <if test="xlh!=null and xlh!=''">
                and sbys.xlh ILIKE '%' ||#{xlh}||'%'
            </if>
        </where>
    </select>
    <select id="getPagedDeviceInfoYZ" resultType="SbysDto" parameterType="SbysDto">
        SELECT
        sbyz.sbyzid,sbys.sbysid,sbys.sbmc,sbys.sbbh,sbys.ggxh,sbys.xlh,sqbm.jgmc sqbmmc,sbyz.yzrq,
        sbys.gdzcbh,sbys.sbccbh
        FROM
        igams_sbyz sbyz
        LEFT JOIN igams_sbys sbys ON sbys.sbysid = sbyz.sbysid
        AND sbys.scbj = '0'
        LEFT JOIN matridx_jgxx sqbm ON sqbm.jgid = sbyz.sqbm
        <where>
            sbyz.scbj='0'
            <if test="entire != null and entire != ''">
                and (
                sbys.sbbh ILIKE '%' ||#{entire}||'%'
                or sbys.sbmc ILIKE '%' ||#{entire}||'%'
                or sbys.gdzcbh ILIKE '%' ||#{entire}||'%'
                or sbys.sbccbh ILIKE '%' ||#{entire}||'%'
                or sbys.xlh ILIKE '%' ||#{entire}||'%'
                )
            </if>
            <if test="sbbh!=null and sbbh!=''">
                and sbys.sbbh ILIKE '%' ||#{sbbh}||'%'
            </if>
            <if test="sbmc!=null and sbmc!=''">
                and sbys.sbmc ILIKE '%' ||#{sbmc}||'%'
            </if>
            <if test="gdzcbh!=null and gdzcbh!=''">
                and sbys.gdzcbh ILIKE '%' ||#{gdzcbh}||'%'
            </if>
            <if test="sbccbh!=null and sbccbh!=''">
                and sbys.sbccbh ILIKE '%' ||#{sbccbh}||'%'
            </if>
            <if test="xlh!=null and xlh!=''">
                and sbys.xlh ILIKE '%' ||#{xlh}||'%'
            </if>
        </where>
    </select>
    <update id="updateForWlid" parameterType="SbysDto">
        update igams_sbys
        set
        xgry=#{xgry}
        ,xgsj=LOCALTIMESTAMP
        <if test="sbmc != null and sbmc != ''">
            ,sbmc=#{sbmc}
        </if>
        <if test="ggxh != null and ggxh != ''">
            ,ggxh=#{ggxh}
        </if>
        where sbysid in (SELECT
            sbys.sbysid
            FROM
            igams_sbys sbys
            LEFT JOIN igams_hwxx hwxx on sbys.sbysid = hwxx.hwid AND hwxx.lrsj = (
            SELECT MAX(lrsj)
            FROM igams_hwxx
            WHERE scbj ='0' and sbysid = sbys.sbysid
            )
            WHERE
            hwxx.wlid = #{wlid})
    </update>
    <select id="selectAdministrators" parameterType="SbysDto" resultType="SbysDto">
        select sbys.glry,xtyh.yhm
        from igams_sbys sbys
        left join matridx_xtyh xtyh on xtyh.yhid=sbys.glry
        where
        sbys.scbj='0' and sbys.sbzt='01' and sbys.glry is not null
        <if test="dsrwFlag !=null and dsrwFlag!='' and dsrwFlag=='sbjl'.toString()">
            and cast((select date_part('day', current_timestamp - to_char(sbys.xcjlsj,'yyyy-mm-dd hh24:mi:ss')::timestamp)) as numeric )&lt;=14
        </if>
        <if test="dsrwFlag !=null and dsrwFlag!='' and dsrwFlag=='sbyz'.toString()">
            and cast((select date_part('day', current_timestamp - to_char(sbys.xcyzsj,'yyyy-mm-dd hh24:mi:ss')::timestamp)) as numeric )&lt;=14
        </if>
        <if test="dsrwFlag !=null and dsrwFlag!='' and dsrwFlag=='sbwx'.toString()">
            and cast((select date_part('day', current_timestamp - to_char(sbys.xcbysj,'yyyy-mm-dd hh24:mi:ss')::timestamp)) as numeric )&lt;=14
        </if>
        group by glry,xtyh.yhm
    </select>
    <select id="selectLeaders" parameterType="SbysDto" resultType="SbysDto">
        select sbys.bmsbfzr,xtyh.yhm
        from igams_sbys sbys
        left join matridx_xtyh xtyh on xtyh.yhid=sbys.bmsbfzr
        where
        sbys.scbj='0' and sbys.sbzt='01' and sbys.bmsbfzr is not null
        <if test="dsrwFlag !=null and dsrwFlag!='' and dsrwFlag=='sbjl'.toString()">
            and cast((select date_part('day', current_timestamp - to_char(sbys.xcjlsj,'yyyy-mm-dd hh24:mi:ss')::timestamp)) as numeric )&lt;=14
        </if>
        <if test="dsrwFlag !=null and dsrwFlag!='' and dsrwFlag=='sbyz'.toString()">
            and cast((select date_part('day', current_timestamp - to_char(sbys.xcyzsj,'yyyy-mm-dd hh24:mi:ss')::timestamp)) as numeric )&lt;=14
        </if>
        <if test="dsrwFlag !=null and dsrwFlag!='' and dsrwFlag=='sbwx'.toString()">
            and cast((select date_part('day', current_timestamp - to_char(sbys.xcbysj,'yyyy-mm-dd hh24:mi:ss')::timestamp)) as numeric )&lt;=14
        </if>
        group by bmsbfzr,xtyh.yhm
    </select>

    <update id="updatePdztToNull" parameterType="SbysDto">
        update  igams_sbys
        set  xgry=#{xgry},xgsj=LOCALTIMESTAMP,pdzt=null
        where sbysid in
        <if test="ids !=null and ids.size > 0">
            <foreach collection="ids" open="(" close=")" separator="," item="item">
                #{item}
            </foreach>
        </if>
    </update>

    <select id="getListForInventory" resultType="SbysDto" parameterType="SbysDto">
        select tab.*,xtyh.yhm,xtyh.ddid,yhssjg.jgid as bmid from (select string_agg (distinct  sbysid, ',' ) sbysid,bmsbfzr
        FROM igams_sbys
        where scbj='0' and tzzt='1' and sbzt != '02' and sbzt != '04' and sbzt != '03' and bmsbfzr is not null
        <if test="ids !=null and ids.size > 0">
           and sbysid in
            <foreach collection="ids" open="(" close=")" separator="," item="item">
                #{item}
            </foreach>
        </if>
        group by bmsbfzr) tab
        left join matridx_xtyh xtyh on xtyh.yhid = tab.bmsbfzr and xtyh.scbj='0'
        left join matridx_yhssjg yhssjg on yhssjg.yhid = tab.bmsbfzr
    </select>

    <update id="updateForInventory" parameterType="list">
        <if test="list !=null and list.size > 0">
            update igams_sbys sbys
            set pdzt=tmp.pdzt
            from(
            <foreach collection="list" separator="union" open="(" close=") " item="item" index="index">
                select #{item.pdzt} pdzt,#{item.sbysid} sbysid
            </foreach>
            )
            tmp
            where
            sbys.sbysid=tmp.sbysid
        </if>
    </update>
</mapper>
