<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.matridx.igams.production.dao.post.ILysbjlDao" >
	<sql id="SEARCH_TERMS">
		<if test="jlrymc != null and jlrymc != ''">
			and xtyh_jlry.zsxm ILIKE '%'||#{jlrymc}||'%'
		</if>
		<if test="jlsjstart != null and jlsjstart != ''">
			and to_char(lysbjl.jlsj,'yyyy-mm-dd') &gt;= #{jlsjstart}
		</if>
		<if test="jlsjend != null and jlsjend != ''">
			and to_char(lysbjl.jlsj,'yyyy-mm-dd') &lt;= #{jlsjend}
		</if>
		<if test = "bhlbs != null and bhlbs.length > 0 "  >
			and lysbjl.sbid in
			<foreach collection="bhlbs" separator="," open="(" close=") "
					 item="item" index="index">
				#{item}
			</foreach>
		</if>
		<if test = "bhlbmcs != null and bhlbmcs.length > 0 "  >
			and lysbjl.sbid in
			<foreach collection="bhlbmcs" separator="," open="(" close=") "
					 item="item" index="index">
				#{item}
			</foreach>
		</if>
		<if test="wdzt != null and wdzt == '0' .toString">
			and cast(coalesce(lysbjl.wd) as numeric) &gt;= cast(coalesce(bhlb.cskz1) as numeric) and cast(coalesce(lysbjl.wd) as numeric) &lt;= cast(coalesce(bhlb.cskz2) as numeric)
		</if>
		<if test="wdzt != null and wdzt == '1' .toString">
			and cast(coalesce(lysbjl.wd) as numeric) &lt; cast(coalesce(bhlb.cskz1) as numeric)
		</if>
		<if test="wdzt != null and wdzt == '2' .toString">
			and cast(coalesce(lysbjl.wd) as numeric) &gt; cast(coalesce(bhlb.cskz2) as numeric)
		</if>
	</sql>
    <select id="getPagedDtoList" parameterType="LysbjlDto" resultType="LysbjlDto">
	  SELECT
		sbjlid,
		lysbjl.sbid,
		jlry,
		to_char( jlsj, 'yyyy-mm-dd hh24:mi:ss' ) jlsj,
		wd,
		lysbjl.bz,
		lysbjl.sd,
		xtyh_jlry.zsxm jlrymc,
		bhlb.csmc bhlbmc,
		bhlb.csdm bhlbdm,
		bhlb.cskz1 zdwd,
		bhlb.cskz2 zgwd
	FROM
		igams_lysbjl lysbjl
		LEFT JOIN matridx_xtyh xtyh_jlry ON xtyh_jlry.yhid = lysbjl.jlry
		left join matridx_jcsj bhlb on bhlb.csid=lysbjl.sbid
		<where>
			<include refid="SEARCH_TERMS"></include>
		</where>
    </select>
	<select id="getDtoById" parameterType="LysbjlDto" resultType="LysbjlDto">
		SELECT
		sbjlid,
		lysbjl.sbid,
		jlry,
		to_char( jlsj, 'yyyy-mm-dd hh24:mi:ss' ) jlsj,
		wd,
		lysbjl.bz,
		lysbjl.sd,
		xtyh_jlry.zsxm jlrymc,
		bhlb.csmc bhlbmc,
		bhlb.csdm bhlbdm,
		bhlb.cskz1 zdwd,
		bhlb.cskz2 zgwd
		FROM
		igams_lysbjl lysbjl
		LEFT JOIN matridx_xtyh xtyh_jlry ON xtyh_jlry.yhid = lysbjl.jlry
		left join matridx_jcsj bhlb on bhlb.csid=lysbjl.sbid
	<where>
		lysbjl.sbjlid=#{sbjlid}
	</where>
    </select>
	<insert id="insert" parameterType="LysbjlDto">
		insert into igams_lysbjl(sbjlid,sbid,jlsj,jlry,wd,bz,sd)
		values (#{sbjlid},#{sbid},cast(#{jlsj} as TIMESTAMP),#{jlry},#{wd},#{bz},#{sd})
	</insert>
	<update id="update" parameterType="LysbjlDto">
		update igams_lysbjl set jlsj = cast(#{jlsj} as TIMESTAMP),wd = #{wd},sbid = #{sbid},sd = #{sd},bz = #{bz} where sbjlid = #{sbjlid}
	</update>
	<delete id="delete" parameterType="LysbjlDto">
		delete from igams_lysbjl where sbjlid in
		<foreach collection="ids" separator="," open="(" close=") "
				 item="item" index="index">
			#{item}
		</foreach>
	</delete>
	<select id="getDtoListGroup" parameterType="LysbjlDto" resultType="LysbjlDto">
		SELECT
		bhlb.csmc sbmc,bhlb.csdm sbbh,lysbjl.sbid
		FROM
			igams_lysbjl lysbjl
				LEFT JOIN matridx_jcsj bhlb on bhlb.csid = lysbjl.sbid
		<where>
			<include refid="SEARCH_TERMS"></include>
		</where>
		GROUP BY sbid,bhlb.csmc,bhlb.csdm
	</select>
	<select id="getDtoList" parameterType="LysbjlDto" resultType="LysbjlDto">
		SELECT
		bhlb.csmc sbmc,bhlb.csdm sbbh,lysbjl.sbid,lysbjl.wd,lysbjl.sd,lysbjl.jlsj,bhlb.cskz1 zdwd,
		bhlb.cskz2 zgwd
		FROM
		igams_lysbjl lysbjl
		LEFT JOIN matridx_jcsj bhlb on bhlb.csid = lysbjl.sbid
		<where>
			<include refid="SEARCH_TERMS"></include>
		</where>
		ORDER BY lysbjl.jlsj
	</select>
</mapper>