<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>审批详情</title>
    <script type="text/javascript" src="/js/common/record/record_view.js" charset="utf-8"></script>
</head>
<body>
<form class="form-horizontal sl_all_form" method="post">
    <div class="body-content tab-content">
        <div role="tabpanel" class="tab-pane fade active in" aria-labelledby="profile-tab">
            <div class="panel panel-default">
                <div class="panel-body">
                    <!-- 正常 -->
                    <div class="row" th:if="${map!=null && map.formcomponentvalue!=null && map.formcomponentvalue.size()>0}">
                        <div class="col-md-12 col-sm-12" th:each="formcom:${map.formcomponentvalue}" th:if="${formcom.get('componentType')!='TableField' && formcom.get('componentType')!='DDAttachment' && formcom.get('componentType')!='DDPhotoField' && formcom.get('componentType')!='RelateField'}">
                            <div class="form-group">
                                <label class="col-md-2 col-sm-2 control-label" th:text="${formcom.get('name')}">
                                </label>
                                <div class="col-md-10 col-xs-10 padding_t7">
                                    <span th:text="${formcom.get('value') != null ? formcom.get('value') : ''}" ></span>
                                </div>
                            </div>
                        </div>
                        <!-- 文件 -->
                        <div class="col-md-12 col-sm-12" th:each="dDAttachment:${map.formcomponentvalue}" th:if="${dDAttachment.get('componentType')=='DDAttachment' || dDAttachment.get('componentType')=='DDPhotoField'}">
                            <div class="form-group">
                                <label for="" class="col-sm-2 col-md-2 col-xs-2 control-label"
                                      th:text="${dDAttachment != null ? (dDAttachment.get('name') != null ? dDAttachment.get('name') : '') : ''}"></label>
                                <div id="t_fjcfbDto" th:if="${dDAttachment!=null}"
                                     th:each="mapItem, mapItemStat : ${dDAttachment.get('value')}">
                                    <div class="col-sm-10 col-xs-10 col-md-10" style="padding-top: 6px;">
                                        <!-- 找到文件附件区块 -->
                                        <div class="file-item"
                                             style="margin-top: 10px;display: flex; align-items: center; gap: 15px; padding: 8px 12px; background: #f8f9fa; border-radius: 4px; transition: all 0.3s;"
                                             onmouseover="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'"
                                             onmouseout="this.style.boxShadow='none'"
                                             th:onclick="yl([[${mapItem.get('fjid')}]], [[${mapItem.get('fileName')}]])">
                                            <span style="color: #666; flex-grow: 1;" th:text="${mapItem != null ? (mapItem.get('fileName') != null ? mapItem.get('fileName') : '') : ''}"></span>
                                            <div class="file-actions" style="display: flex; gap: 10px;">
                                                <a title="下载"
                                                   style="color: #1890ff; text-decoration: none;"
                                                th:onclick="xz([[${mapItem.get('fjid')}]]);event.stopPropagation()">
                                                <span class="glyphicon glyphicon-save"></span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <label for="" class="col-sm-2 col-md-2 col-xs-2 control-label"></label>
                                </div>
                            </div>
                        </div>
                        <!-- table -->
                        <div th:each="formcom2:${map.formcomponentvalue}" th:if="${formcom2.get('componentType')=='TableField'}">
                            <div class="row">
                                <div class="col-md-12 col-sm-12">
                                    <div class="form-group">
                                        <label class="col-md-2 col-sm-2 control-label" th:text="${formcom2.get('name') != null ? formcom2.get('name') : ''}"></label>
                                    </div>
                                    <div class="col-md-10 col-xs-10 padding_t7">
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                            <table class="table table-bordered">
                                <thead>
                                <tr th:if="${formcom2.get('value') != null && !formcom2.get('value').isEmpty() && formcom2.get('value')[0] != null && !formcom2.get('value')[0].isEmpty()}">
                                    <th th:each="item : ${formcom2.get('value')[0]}" th:text="${item.get('label') != null ? item.get('label') : ''}"></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="innerList : ${formcom2.get('value')}" th:if="${innerList != null}">
                                    <td th:each="mapItem : ${innerList}" th:if="${mapItem != null}">
                                        <span th:text="${mapItem.get('value') != null ? mapItem.get('value') : ''}"></span>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- 找到关联审批单区块 -->
                        <div class="col-md-12 col-sm-12" th:each="relateField:${map.formcomponentvalue}" th:if="${relateField.get('componentType')=='RelateField'}">
                            <div class="form-group">
                                <label class="col-md-2 col-sm-2 control-label" th:text="${relateField.get('name')}"></label>
                                <div id="glspd" th:if="${relateField!=null}"
                                     th:each="mapItem, mapItemStat : ${relateField.get('extValue')}">
                                    <div class="col-md-10 col-xs-10 padding_t7">
                                        <div class="approval-item" style="display: flex; align-items: center; gap: 10px; padding: 8px 12px; background: #f8f9fa; border-radius: 4px; transition: all 0.3s;"
                                             onmouseover="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'"
                                             onmouseout="this.style.boxShadow='none'"
                                             th:onclick="view([[${mapItem.get('procInstId')}]], [[${mapItem.get('value')}]])">
                                            <span class="glyphicon glyphicon-file" style="color: #1890ff;"></span>
                                            <a title="查看"
                                               style="color: #333; text-decoration: none; flex-grow: 1;
                                                    transition: opacity 0.3s;"
                                               onmouseover="this.style.opacity='0.7'"
                                               onmouseout="this.style.opacity='1'">
                                                <span th:text="${mapItem != null ? mapItem.get('value') : ''}"></span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 审核记录 -->
                    <div class="row" th:if="${map!=null && map.operationrecords!=null && map.operationrecords.size()>0}">
                        <div class="col-md-12">
                            <h4 style="margin-bottom: 20px; color: #666;">操作记录:</h4>
                            <div class="operation-record-container" style="background: #f8f9fa; border-radius: 8px; padding: 15px;">
                                <div class="col-md-12 col-sm-12" th:each="operat:${map.operationrecords}" th:if="${operat!=null}">
                                    <div class="record-item" style="background: white; border-radius: 6px; padding: 15px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                        <div class="row">
                                            <div class="col-md-3" style="border-right: 1px solid #eee;">
                                                <div style="color: #888; margin-bottom: 8px;">
                                                    <span th:text="${operat.get('date')}" style="font-size: 13px;"></span>
                                                </div>
                                                <div style="color: #333; font-weight: 500;">
                                                    <span th:text="${operat.get('userId')}"></span>
                                                    <span th:if="${operat.result} != null and ${operat.result} != ''"
                                                          th:text="'('+${operat.result}+')'"
                                                          th:style="${operat.result} == '同意' ? 'color: #52c41a;' :
                                                                   (${operat.result} == '拒绝' ? 'color: #ff4d4f;' : 'color: #666;')
                                                                   + ' font-size: 13px;'">
                                                    </span>
                                                </div>
                                                <div th:if="${operat.get('showName')}" style="margin-top: 8px;">
                                                    <span th:text="${operat.get('showName')}"
                                                          style="display: inline-block; padding: 3px 8px; background: #e8f4ff;
                                                                 border-radius: 4px; color: #1890ff; font-size: 12px;"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-9" style="padding-left: 25px;">
                                                <div th:if="${operat.get('remark')!=null}"
                                                     style="color: #444; line-height: 1.6; margin-bottom: 10px;">
                                                    <span th:text="${operat.get('remark')}"></span>
                                                </div>
                                                <div class="col-md-12 col-xs-12" th:if="${operat.get('images')!=null && operat.get('images').size()>0}" th:each="imgs, imgsStat : ${operat.get('images')}">
                                                    <div class="file-item"
                                                         style="margin-top: 10px;display: flex; align-items: center; gap: 15px; padding: 8px 12px; background: #f8f9fa; border-radius: 4px; transition: all 0.3s;"
                                                         onmouseover="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'"
                                                         onmouseout="this.style.boxShadow='none'"
                                                         th:onclick="yl([[${imgs.get('fjid')}]], [[${imgs.get('fileName')}]])">
                                                        <span style="color: #666; flex-grow: 1;" th:text="${imgs != null ? (imgs.get('fileName') != null ? imgs.get('fileName') : '') : ''}"></span>
                                                        <div class="file-actions" style="display: flex; gap: 10px;">
                                                            <a title="下载"
                                                               style="color: #1890ff; text-decoration: none;"
                                                            th:onclick="xz([[${imgs.get('fjid')}]]);event.stopPropagation()">
                                                            <span class="glyphicon glyphicon-save"></span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-12 col-xs-12" th:if="${operat.get('attachments')!=null && operat.get('attachments').size()>0}" th:each="atts, attsStat : ${operat.get('attachments')}">
                                                    <div class="file-item"
                                                         style="margin-top: 10px;display: flex; align-items: center; gap: 15px; padding: 8px 12px; background: #f8f9fa; border-radius: 4px; transition: all 0.3s;"
                                                         onmouseover="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'"
                                                         onmouseout="this.style.boxShadow='none'"
                                                         th:onclick="yl([[${atts.get('fjid')}]], [[${atts.get('fileName')}]])">
                                                        <span style="color: #666; flex-grow: 1;" th:text="${atts != null ? (atts.get('fileName') != null ? atts.get('fileName') : '') : ''}"></span>
                                                        <div class="file-actions" style="display: flex; gap: 10px;">
                                                            <a title="下载"
                                                               style="color: #1890ff; text-decoration: none;"
                                                               th:onclick="xz([[${atts.get('fjid')}]]);event.stopPropagation()">
                                                                <span class="glyphicon glyphicon-save"></span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 抄送人展示 -->
                    <div class="row" th:if="${map!=null && map.ccuserids!=null && map.ccuserids.size()>0}" style="margin-top: 20px;">
                        <div class="col-md-12">
                            <div class="cc-container" style="background: #f8f9fa; border-radius: 8px; padding: 15px;">
                                <h5 style="color: #666; margin-bottom: 12px;">抄送人：</h5>
                                <div class="cc-list" style="background: white; padding: 10px; border-radius: 4px;">
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                        <span th:each="ccuser : ${map.ccuserids}"
                                              style="display: inline-block;
                                                     padding: 4px 12px;
                                                     background: #e8f4ff;
                                                     border-radius: 15px;
                                                     color: #1890ff;
                                                     font-size: 13px;
                                                     border: 1px solid #91d5ff;
                                                     transition: all 0.3s;"
                                              onmouseover="this.style.boxShadow='0 2px 8px rgba(24,144,255,0.2)'"
                                              onmouseout="this.style.boxShadow='none'">
                                            <span th:text="${ccuser}"></span>
                                            <span class="glyphicon glyphicon-user" style="margin-left: 6px; font-size: 12px;"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
</body>
</html>