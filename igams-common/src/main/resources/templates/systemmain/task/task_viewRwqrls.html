<!DOCTYPE html>
<html lang="zh-cn">
	<head>
	<style type="text/css">
		th{
			font-weight:bold;
			text-align: left;
		}
	</style>
	</head>
	<body>
	   <form id="ajaxForm"  namespace="/task" class="form-horizontal sl_all_form" method="post" theme="simple" data-bs-toggle="validation">
			<input type="hidden" name="urlprefix" id ="urlprefix" th:value="${urlprefix}">
		   <div class="modal-body form-horizontal clearfix">
			   <div class="col-sm-10 col-sm-offset-1 col-xs-12" th:if="${gzlcglDtos != null and gzlcglDtos.size() > 0}" th:each="gzlcglDto:${gzlcglDtos}">
				   <table th:class="'table table-bordered table_sh table_' + ${(gzlcglDto.sftg eq '1')?'tg':(gzlcglDto.sftg eq null?'tj':'wtg')}">
					   <thead>
					   <tr class="active">
						   <th width="40%">
							   <span th:text="${(gzlcglDto.sftg ne null?'确认人：':'申请人：') + (gzlcglDto.zsxm eq null?'':gzlcglDto.zsxm)}" th:title="${gzlcglDto.zsxm}" ></span>
						   </th>
						   <th width="60%">
								<span th:title="${gzlcglDto.shsj}" th:if="${gzlcglDto.shsj}" th:text="${'确认时间：'+gzlcglDto.fshsj}"/></span>
								<span th:title="${gzlcglDto.sqsj}" th:if="${gzlcglDto.sqsj}" th:text="${'申请时间：'+gzlcglDto.fsqsj}"/></span>
							   <span th:class="'pull-right col'+${(gzlcglDto.sftg eq '1')?'1':(gzlcglDto.sftg eq null?'4':'2')}" th:text="${(gzlcglDto.sftg eq '1')?'通过':(gzlcglDto.sftg eq null?'申请':'不通过')}"></span>
						   </th>
					   </tr>
					   </thead>
					   <tbody>
					   <tr>
						   <td colspan="3" th:if="${gzlcglDto.sftg ne null}" style="white-space:normal;padding: 5px!important">
							   <b>审核意见：</b><span>[(${gzlcglDto.shyj})]</span>
						   </td>
						   <td colspan="3" th:if="${gzlcglDto.sftg eq null}" style="padding: 5px!important">
							   <b>提交</b>
						   </td>
					   </tr>
					   <tr th:if="${gzlcglDto.fjcfbList != null && gzlcglDto.fjcfbList.size() >0}">
						   <td colspan="3" style="white-space:normal;padding: 5px!important">
							   <div th:each="fjcfbDto:${gzlcglDto.fjcfbList}" th:id="${fjcfbDto.fjid}" >
								   <div class="col-sm-12">
									   <label for="" th:text="${fjcfbDtoStat.index+1}+."></label>
									   <a title="下载" th:onclick="xz([[${fjcfbDto.fjid}]]);" >
										   <span th:text="${fjcfbDto.wjm}" style="width: 80%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: inline-block;vertical-align: top;"></span>
										   <span class="glyphicon glyphicon glyphicon-save"></span>
									   </a>&nbsp;&nbsp;
									   <a title="预览" class="f_button"  th:onclick="view([[${fjcfbDto.fjid}]],[[${fjcfbDto.wjm}]]);">
										   <span  class="glyphicon glyphicon-eye-open"></span>
									   </a>&nbsp;&nbsp;
									   <!--<a title="删除" class="f_button"  th:onclick="del([[${fjcfbDto.fjid}]],[[${fjcfbDto.wjlj}]]);">
										   <span class="glyphicon glyphicon-remove"></span>
									   </a>-->
								   </div>
							   </div>
						   </td>
					   </tr>
					   </tbody>
				   </table>
			   </div>
		   </div>
	   </form>
	</body>
	<script type="text/javascript">
		function xz(fjid){
			jQuery('<form action="'+$("#ajaxForm #urlprefix").val()+'/common/file/downloadFile" method="POST">' +  // action请求路径及推送方法
		            '<input type="text" name="fjid" value="'+fjid+'"/>' + 
		            '<input type="text" name="access_token" value="'+$("#ac_tk").val()+'"/>' + 
		        '</form>')
		    .appendTo('body').submit().remove();
		}
		
		function view(fjid,wjm){
			var begin=wjm.lastIndexOf(".");
			var end=wjm.length;
			var type=wjm.substring(begin,end);
			if(type.toLowerCase()==".jpg" || type.toLowerCase()==".jpeg" || type.toLowerCase()==".jfif"){
				var url=$("#ajaxForm #urlprefix").val()+"/ws/pripreview/?fjid="+fjid
				$.showDialog(url,'图片预览',PdfMaterConfig);
			}else if(type.toLowerCase()==".pdf"){
				var url= $("#ajaxForm #urlprefix").val()+"/common/file/pdfPreview?fjid=" + fjid;
	            $.showDialog(url,'文件预览',PdfMaterConfig);
			}else {
				$.alert("暂不支持其他文件的预览，敬请期待！");
			}
		};
		var PdfMaterConfig = {
				width		: "800px",
				height		: "500px",
				offAtOnce	: true,  
				buttons		: {
					cancel : {
						label : "关 闭",
						className : "btn-default"
					}
				}
			};
		function del(fjid,wjlj){
			$.confirm('您确定要删除所选择的记录吗？',function(result){
    			if(result){
    				jQuery.ajaxSetup({async:false});
    				var url= $("#ajaxForm #urlprefix").val()+"/common/file/delFile";
    				jQuery.post(url,{fjid:fjid,wjlj:wjlj,"access_token":$("#ac_tk").val()},function(responseText){
    					setTimeout(function(){
    						if(responseText["status"] == 'success'){
    							$.success(responseText["message"],function() {
    								$("#"+fjid).remove();
    							});
    						}else if(responseText["status"] == "fail"){
    							$.error(responseText["message"],function() {
    							});
    						} else{
    							$.alert(responseText["message"],function() {
    							});
    						}
    					},1);
    				},'json');
    				jQuery.ajaxSetup({async:true});
    			}
    		});
		}
	</script>
</html>